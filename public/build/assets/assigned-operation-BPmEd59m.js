import{_ as de}from"./AppAutocomplete-BddWbecx.js";import{_ as K}from"./Filters-B-AcXERl.js";import{c as ue}from"./commonFunction-DmSA9djT.js";import{u as ce}from"./leadStore-Dcb0uB7g.js";import{u as me}from"./rolePermission-DVUNoWaB.js";import{u as pe}from"./user-CmCEUi5Y.js";import fe from"./EditNewUserDrawer-BaemLKPz.js";import{S as k}from"./sweetalert2-z6gKu1nJ.js";import{i as F}from"./index-BYE2E23O.js";import{a6 as M,r as l,H as _e,w as Q,o as i,c as h,b as t,d as m,e as a,v as u,f as C,n as q,z as y,a9 as I,F as D,x as c,i as ve,R as ge,U as he}from"./main-BADZmGzY.js";import{g as ye}from"./helpers-DGBpgzAb.js";import{_ as be}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{a as G,b as J,V as B}from"./VCard-BMcYqK4c.js";import{V as b}from"./VCardText-DpRShg84.js";import{V as w,a as V}from"./VRow-D2_yjpKw.js";import{V as X}from"./VDivider-Dlzz5Gif.js";import{a as Ve}from"./VSelect-C1SS_ZqB.js";import{V as xe}from"./VDataTableServer-jhOd5HdN.js";import{V as Y}from"./VChip-Cm4E8fkC.js";import{V as we}from"./VTextField-CPDcYvV-.js";import{V as Ue}from"./VBadge-BN5PucO9.js";import"./VInput-Bt4jOYU7.js";import"./index-M4AAPadW.js";import"./index-CWxjtjo1.js";import"./forwardRefs-D3j0TLhE.js";import"./filter-AyVZ7QHP.js";import"./VList-C1NZgyeR.js";import"./ssrBoot-Mt929TXd.js";import"./VAvatar-BEEmQOUP.js";import"./VImg-KML9Z82w.js";import"./VMenu-8-lIYCIn.js";import"./dialog-transition-BHECC9gm.js";import"./scopeId-BIg2yWZu.js";import"./VCheckboxBtn-CVbHPjf1.js";import"./AppDateTimePicker-D7PsRTgM.js";import"./AppSelect-N8xse3dI.js";import"./AppTextField-BNeJXgDa.js";import"./validators-C_hVgKmW.js";import"./AppDrawerHeaderSection-BwgMUXN1.js";import"./VSpacer-BqonUa-I.js";/* empty css              */import"./auth-CjhLxmO5.js";import"./vue3-perfect-scrollbar.esm-B9AoUEe-.js";import"./VNavigationDrawer-rm8-3mhr.js";import"./VForm-NhQaZf3T.js";import"./VFileInput-Bn_Yzh_5.js";import"./VCheckbox-DuCNCa9q.js";import"./VDataTable-DoL6YIB_.js";import"./VPagination-D64DIkS1.js";import"./VTable-CU9xN2Lm.js";const N=L=>(ge("data-v-d1fd44a9"),L=L(),he(),L),Ce={key:0},Le=N(()=>m("div",{class:"text-h6 text-white mb-1"},"Total Leads Available",-1)),Se={class:"text-h4 text-white"},ke=N(()=>m("div",{class:"text-h6 text-white mb-1"},"Total Leads Assigned",-1)),Be={class:"text-h4 text-white"},Te=N(()=>m("div",{class:"text-h6 text-white mb-1"},"Remaining Leads",-1)),Ae={class:"text-h4 text-white"},Ee={key:0},Fe={class:"d-flex align-center justify-space-between my-1 country-lead-item pa-2"},Ie={key:1,class:"text-grey"},De={__name:"assigned-operation",setup(L){const Z=M(()=>"calc(100vh - 200px)"),ee=pe();me();const U=ue();l(!1);const p=l([]),O=l(0),R=l(10),T=l(1);l(),l();const P=l("");l(null),l(null);const x=l(null);l(null),l(),l(),l(null);const d=l(!1);l([]);const $=l(!1),te=l(null);l(!1),l(null),l(null),l(ye()==="admin");const A=l([]),f=l(null),_=l(null),E=l(1);l([]);const z=ce(),v=l(0),g=l(null),S=l(null),j=M(()=>p.value.reduce((s,o)=>s+(parseInt(o.assigned_number_of_leads)||0),0)),ae=s=>{console.log(s);const o=p.value.findIndex(r=>r.id===s.id);o!==-1&&p.value.splice(o,1,s)},le=async()=>{d.value=!0;try{const s=await ee.fetchUsers(T.value,P.value,"Counsellor",null,null,null,null,null,_.value);p.value=s.data,O.value=s.total}catch(s){console.error("Error fetching users:",s)}finally{d.value=!1}},se=[{title:"Branch",key:"branch.name"},{title:"Name",key:"full_name"},{title:"Email",key:"email"},{title:"Current Lead",key:"current_lead",width:"200px"},{title:"Assigned Number of Leads",key:"assigned_number_of_leads",align:"center"}],oe=async(s,o)=>{try{const r=parseInt(o);if(r===0){s.assigned_number_of_leads=0;return}if(p.value.reduce((n,W)=>W.id!==s.id?n+(parseInt(W.assigned_number_of_leads)||0):n,0)+r>v.value){k.fire({title:"Warning!",text:`Total assigned leads cannot exceed ${v.value}`,icon:"warning",confirmButtonText:"OK"}),s.assigned_number_of_leads=0;return}s.assigned_number_of_leads=r}catch(r){console.error("Error updating assigned leads:",r),k.fire("Error!","Failed to update assigned leads","error")}},H=async()=>{d.value=!0;try{const s=await z.fetchLeadCount(x.value,f.value);if(v.value=s.total||0,v.value===0){k.fire("Warning!","No unassigned leads found for the selected country","warning");return}E.value=2}catch(s){console.error("Error fetching leads:",s),k.fire("Error!","Failed to fetch leads","error")}finally{d.value=!1}},re=()=>{setTimeout(()=>{location.reload()},3e3)},ne=async()=>{d.value=!0;try{const s=p.value.map(r=>({user_id:r.id,assigned_leads:r.assigned_number_of_leads||0})).filter(r=>r.assigned_leads>0);(await z.saveAssignedLeads(s,x.value,f.value)).status?(F("Leads assigned successfully",{type:"success",position:"top-right",theme:"colored"}),re()):F("Failed to save assigned leads",{type:"error",position:"top-right",theme:"colored"})}catch(s){console.error("Error saving assigned leads:",s),F("Failed to save assigned leads",{type:"error",position:"top-right",theme:"colored"})}finally{d.value=!1}};_e(async()=>{await U.getAllCountries(),await ie()}),Q([P,_],()=>{le()});const ie=async()=>{d.value=!0;try{await U.getBranches(),A.value=U.branches}catch(s){console.error("Error fetching branches:",s)}finally{d.value=!1}};return Q([g,S,x,f],()=>{_.value=null,p.value.forEach(s=>{s.assigned_number_of_leads=0}),E.value=1}),(s,o)=>{const r=de;return i(),h(D,null,[t(fe,{isDrawerOpen:$.value,editedUser:te.value,branches:A.value,"onUpdate:isDrawerOpen":o[0]||(o[0]=e=>$.value=e),onUserUpdated:ae},null,8,["isDrawerOpen","editedUser","branches"]),m("section",null,[t(B,{class:"mb-6"},{default:a(()=>[m("div",null,[t(G,null,{default:a(()=>[t(J,null,{default:a(()=>[u("Select Lead Location")]),_:1})]),_:1}),t(b,null,{default:a(()=>[t(w,null,{default:a(()=>[t(K,{"selected-lead-type":g.value,onUpdateLeadType:o[1]||(o[1]=e=>g.value=e),"country-label":"Lead Country","branch-label":"Lead Branch (Optional)"},null,8,["selected-lead-type"])]),_:1}),g.value==="social"?(i(),C(w,{key:0},{default:a(()=>[t(V,{cols:"12",md:"4"},{default:a(()=>[t(r,{modelValue:x.value,"onUpdate:modelValue":o[2]||(o[2]=e=>x.value=e),items:q(U).allCountries,"item-title":e=>e.name,"item-value":e=>e.id,label:"Select Country",placeholder:"Select Country",clearable:"",class:"slide-in"},null,8,["modelValue","items","item-title","item-value"])]),_:1}),t(V,{cols:"12",md:"4"},{default:a(()=>[t(r,{modelValue:f.value,"onUpdate:modelValue":o[3]||(o[3]=e=>f.value=e),items:q(U).branches,"item-title":e=>e.name,"item-value":e=>e.id,label:"Select Branch",placeholder:"Select Branch",clearable:"",class:"slide-in"},null,8,["modelValue","items","item-title","item-value"])]),_:1})]),_:1})):y("",!0),g.value==="event"?(i(),C(w,{key:1},{default:a(()=>[t(K,{"selected-event":S.value,"selected-branch":f.value,onUpdateEvent:o[4]||(o[4]=e=>S.value=e),onUpdateBranch:o[5]||(o[5]=e=>f.value=e),"branch-label":"Lead Branch"},null,8,["selected-event","selected-branch"])]),_:1})):y("",!0),t(w,{class:"mt-4"},{default:a(()=>[t(V,{cols:"12",class:"text-center"},{default:a(()=>[g.value==="event"?(i(),C(I,{key:0,color:"primary",disabled:!S.value,loading:d.value,onClick:H},{default:a(()=>[u(" Continue ")]),_:1},8,["disabled","loading"])):y("",!0),g.value==="social"?(i(),C(I,{key:1,color:"primary",disabled:!x.value,loading:d.value,onClick:H},{default:a(()=>[u(" Continue ")]),_:1},8,["disabled","loading"])):y("",!0)]),_:1})]),_:1})]),_:1})]),E.value===2&&v.value>0?(i(),h("div",Ce,[t(X,{class:"my-4"}),t(G,null,{default:a(()=>[t(J,null,{default:a(()=>[u("Assign Leads to Counsellors(To complete this step, select a branch)")]),_:1})]),_:1}),t(b,null,{default:a(()=>[t(w,null,{default:a(()=>[t(V,{cols:"12",md:"4"},{default:a(()=>[t(Ve,{modelValue:_.value,"onUpdate:modelValue":o[6]||(o[6]=e=>_.value=e),items:A.value,"item-title":"name","item-value":"id",label:"Select Branch"},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1}),_.value?(i(),h(D,{key:0},[t(b,{class:"text-end mb-4"},{default:a(()=>[t(I,{color:"primary",loading:d.value,onClick:ne},{default:a(()=>[u(" Save Assigned Leads ")]),_:1},8,["loading"])]),_:1}),_.value?(i(),C(b,{key:0},{default:a(()=>[t(w,null,{default:a(()=>[t(V,{cols:"12",md:"4"},{default:a(()=>[t(B,{class:"bg-primary"},{default:a(()=>[t(b,{class:"text-center"},{default:a(()=>[Le,m("div",Se,c(v.value),1)]),_:1})]),_:1})]),_:1}),t(V,{cols:"12",md:"4"},{default:a(()=>[t(B,{class:"bg-success"},{default:a(()=>[t(b,{class:"text-center"},{default:a(()=>[ke,m("div",Be,c(j.value),1)]),_:1})]),_:1})]),_:1}),t(V,{cols:"12",md:"4"},{default:a(()=>[t(B,{class:"bg-info"},{default:a(()=>[t(b,{class:"text-center"},{default:a(()=>[Te,m("div",Ae,c(v.value-j.value),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):y("",!0),t(xe,{"items-per-page":R.value,"onUpdate:itemsPerPage":o[7]||(o[7]=e=>R.value=e),page:T.value,"onUpdate:page":o[8]||(o[8]=e=>T.value=e),items:p.value,"items-length":O.value,headers:se,class:"text-no-wrap",height:Z.value},{"item.branch.name":a(({item:e})=>{var n;return[u(c(((n=e.branch)==null?void 0:n.branch_name_with_country)||"N/A"),1)]}),"item.full_name":a(({item:e})=>[u(c(e.full_name),1)]),"item.email":a(({item:e})=>[u(c(e.email),1)]),"item.current_lead":a(({item:e})=>[e.lead_counts?(i(),h("div",Ee,[m("div",Fe,[t(Y,{size:"small",color:"error",variant:"elevated",class:"mr-2"},{default:a(()=>[u(" Total: "+c(e.lead_counts.lead_count_all),1)]),_:2},1024)]),t(X,{class:"my-1"}),(i(!0),h(D,null,ve(e.lead_counts.lead_by_country,n=>(i(),h("div",{key:n.country_id,class:"d-flex align-center justify-space-between my-1 country-lead-item pa-2"},[t(Y,{size:"small",color:"primary",variant:"elevated",class:"mr-2"},{default:a(()=>[u(c(n.country_name),1)]),_:2},1024),t(Ue,{content:n.count,color:"success",class:"count-badge"},null,8,["content"])]))),128))])):(i(),h("span",Ie,"0"))]),"item.role":a(({item:e})=>[u(c(e.role),1)]),"item.assigned_number_of_leads":a(({item:e})=>[t(we,{modelValue:e.assigned_number_of_leads,"onUpdate:modelValue":[n=>e.assigned_number_of_leads=n,n=>oe(e,n)],type:"number",min:"0",density:"compact",variant:"outlined","hide-details":"",class:"w-20",placeholder:"Enter number"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["items-per-page","page","items","items-length","height"])],64)):y("",!0)])):y("",!0)]),_:1})])],64)}}},Et=be(De,[["__scopeId","data-v-d1fd44a9"]]);export{Et as default};
