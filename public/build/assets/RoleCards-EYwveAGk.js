import{_ as Q}from"./AppTextField-IXOudmAp.js";import{_ as X}from"./DialogCloseBtn-D5iRjMM9.js";import{u as K}from"./rolePermission-BuKT4AOY.js";import{V as F}from"./VCard-W6-ISte3.js";import{V as E}from"./VCardText-CUKtcGdo.js";import{V as G}from"./VForm-BG69z5M8.js";import{V as I}from"./VTable-0XJWTTNE.js";import{V as P}from"./VCheckbox-B_jxJzOv.js";import{r as f,H as M,a5 as T,w as U,o as m,f as z,e as t,b as e,d as l,x as g,n as b,c as v,F as x,i as $,a7 as N,v as R,a as J,a1 as W,a3 as S}from"./main-DSNTdqfI.js";import{V as Y}from"./VDialog-BpwMyPt2.js";import{a as j,V as q}from"./VRow-BJPEDC92.js";import{V as Z}from"./VSpacer-BrkdUHa4.js";const ee={class:"text-h4 text-center mb-2"},le=l("p",{class:"text-body-1 text-center mb-6"}," Set Role Permissions ",-1),se=l("h5",{class:"text-h5 my-6"}," Role Permissions ",-1),te={class:"text-h6"},oe={class:"d-flex justify-end"},ae={class:"d-flex justify-end"},ne={class:"d-flex justify-end"},ie={class:"d-flex justify-end"},de=l("h5",{class:"text-h5 my-6"}," Custom Permissions ",-1),re={class:"text-h6"},ue={colspan:"4"},ce={class:"d-flex justify-end"},me={class:"d-flex align-center justify-center gap-4"},fe={__name:"AddEditRoleDialog",props:{rolePermissions:{type:Object,required:!1,default:()=>({id:"",name:"",permissions:[]})},isDialogVisible:{type:Boolean,required:!0}},emits:["update:isDialogVisible","update:rolePermissions"],setup(O,{emit:k}){const V=K(),o=f([]),c=f([]);M(async()=>{await V.getAllPermission(),o.value=V.permissions,o.value.forEach(s=>{c.value=[...new Set([...c.value,...Object.keys(s.custom_permissions||{})])]})});const r=O,y=k,_=f(!1),i=f(""),w=f(null),h=f(),n=T(()=>{let s=0;return o.value.forEach(d=>{Object.entries(d).forEach(([u,C])=>{u!=="name"&&C&&s++}),Object.values(d.custom_permissions||{}).forEach(u=>{u&&s++})}),s}),A=T(()=>n.value>0&&n.value<o.value.length*(4+c.value.length));U(_,s=>{o.value=o.value.map(d=>({...d,read:s,edit:s,create:s,delete:s,custom_permissions:Object.fromEntries(Object.entries(d.custom_permissions||{}).map(([u])=>[u,s]))}))}),U(A,()=>{A.value||(_.value=!1)}),U(o,()=>{n.value===o.value.length*(4+c.value.length)&&(_.value=!0)},{deep:!0}),U(r,()=>{r.rolePermissions&&r.rolePermissions.permissions.length&&(i.value=r.rolePermissions.name,w.value=r.rolePermissions.id,o.value=o.value.map(s=>{var u;const d=(u=r.rolePermissions)==null?void 0:u.permissions.find(C=>C.name===s.name);return d?{...s,...d,custom_permissions:{...s.custom_permissions,...d.custom_permissions||{}}}:s}))});const H=async()=>{var d;const s={id:w.value,name:i.value,permissions:o.value};try{await V.setRolePermission(s),y("update:rolePermissions",s),y("update:isDialogVisible",!1),_.value=!1,(d=h.value)==null||d.reset()}catch(u){console.error("Failed to save role permissions:",u)}},B=()=>{var s;y("update:isDialogVisible",!1),_.value=!1,(s=h.value)==null||s.reset()};return(s,d)=>{const u=X,C=Q;return m(),z(Y,{width:s.$vuetify.display.smAndDown?"auto":900,"model-value":r.isDialogVisible,"onUpdate:modelValue":B},{default:t(()=>[e(u,{onClick:B}),e(F,{class:"pa-sm-10 pa-2"},{default:t(()=>[e(E,null,{default:t(()=>[l("h4",ee,g(r.rolePermissions.name?"Edit":"Add New")+" Role ",1),le,e(b(G),{ref_key:"refPermissionForm",ref:h},{default:t(()=>[e(C,{modelValue:i.value,"onUpdate:modelValue":d[0]||(d[0]=a=>i.value=a),label:"Role Name",placeholder:"Enter Role Name"},null,8,["modelValue"]),se,e(I,{class:"permission-table text-no-wrap mb-6"},{default:t(()=>[(m(!0),v(x,null,$(o.value,a=>(m(),v("tr",{key:a.name},[l("td",null,[l("h6",te,g(a.name),1)]),l("td",null,[l("div",oe,[e(P,{modelValue:a.read,"onUpdate:modelValue":p=>a.read=p,label:"Read"},null,8,["modelValue","onUpdate:modelValue"])])]),l("td",null,[l("div",ae,[e(P,{modelValue:a.create,"onUpdate:modelValue":p=>a.create=p,label:"Create"},null,8,["modelValue","onUpdate:modelValue"])])]),l("td",null,[l("div",ne,[e(P,{modelValue:a.edit,"onUpdate:modelValue":p=>a.edit=p,label:"Edit"},null,8,["modelValue","onUpdate:modelValue"])])]),l("td",null,[l("div",ie,[e(P,{modelValue:a.delete,"onUpdate:modelValue":p=>a.delete=p,label:"Delete"},null,8,["modelValue","onUpdate:modelValue"])])])]))),128))]),_:1}),de,e(I,{class:"permission-table text-no-wrap mb-6"},{default:t(()=>[(m(!0),v(x,null,$(o.value,a=>(m(),v(x,{key:a.name},[(m(!0),v(x,null,$(a.custom_permissions,(p,D)=>(m(),v("tr",{key:D},[l("td",null,[l("h6",re,g(a.name)+" "+g(D),1)]),l("td",ue,[l("div",ce,[e(P,{modelValue:a.custom_permissions[D],"onUpdate:modelValue":L=>a.custom_permissions[D]=L},null,8,["modelValue","onUpdate:modelValue"])])])]))),128))],64))),128))]),_:1}),l("div",me,[e(N,{onClick:H},{default:t(()=>[R(" Submit ")]),_:1}),e(N,{color:"secondary",variant:"tonal",onClick:B},{default:t(()=>[R(" Cancel ")]),_:1})])]),_:1},512)]),_:1})]),_:1})]),_:1},8,["width","model-value"])}}},_e="/build/assets/girl-using-mobile-CKXBkoEQ.png",pe={class:"text-body-1"},ve={class:"d-flex justify-space-between align-center"},Ve={class:"text-h5"},he={class:"d-flex align-center"},be=["onClick"],ge=["src"],xe=l("div",{class:"text-end"},[R(" Add new role,"),l("br"),R(" if it doesn't exist. ")],-1),Be={__name:"RoleCards",setup(O){const k=f([]),V=K(),o=f(!1),c=f(),r=f(!1);M(async()=>{await V.getAllRoles(),k.value=V.roles});const y=(_,i)=>{o.value=!0,c.value=_,c.value.id=i};return(_,i)=>{const w=J("IconBtn"),h=fe;return m(),v(x,null,[e(q,null,{default:t(()=>[(m(!0),v(x,null,$(b(k),n=>(m(),z(j,{key:n.role,cols:"12",sm:"6",lg:"4"},{default:t(()=>[e(F,null,{default:t(()=>[e(E,{class:"d-flex align-center pb-4"},{default:t(()=>[l("div",pe," Total "+g(n.details.user_count)+" users ",1),e(Z)]),_:2},1024),e(E,null,{default:t(()=>[l("div",ve,[l("div",null,[l("h5",Ve,g(n.role.toUpperCase()),1),l("div",he,[l("a",{href:"javascript:void(0)",onClick:A=>y(n.details,n.id)}," Edit Role ",8,be)])]),e(w,null,{default:t(()=>[e(W,{icon:"tabler-copy",class:"text-high-emphasis"})]),_:1})])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),e(j,{cols:"12",sm:"6",lg:"4"},{default:t(()=>[e(F,{class:"h-100",ripple:!1},{default:t(()=>[e(q,{"no-gutters":"",class:"h-100"},{default:t(()=>[e(j,{cols:"5",class:"d-flex flex-column justify-end align-center mt-5"},{default:t(()=>[l("img",{width:"85",src:b(_e)},null,8,ge)]),_:1}),e(j,{cols:"7"},{default:t(()=>[e(E,{class:"d-flex flex-column align-end justify-end gap-4"},{default:t(()=>[e(N,{size:"small",onClick:i[0]||(i[0]=n=>r.value=!0)},{default:t(()=>[R(" Add New Role ")]),_:1}),xe]),_:1})]),_:1})]),_:1})]),_:1}),e(h,{"is-dialog-visible":b(r),"onUpdate:isDialogVisible":i[1]||(i[1]=n=>S(r)?r.value=n:null)},null,8,["is-dialog-visible"])]),_:1})]),_:1}),e(h,{"is-dialog-visible":b(o),"onUpdate:isDialogVisible":i[2]||(i[2]=n=>S(o)?o.value=n:null),"role-permissions":b(c),"onUpdate:rolePermissions":i[3]||(i[3]=n=>S(c)?c.value=n:null)},null,8,["is-dialog-visible","role-permissions"])],64)}}};export{Be as _};
