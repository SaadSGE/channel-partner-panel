import{a as T,w as g}from"./index-Dz1rBMAR.js";import{ab as l}from"./main-BF6e-Eh1.js";const R=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,_=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,S=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function q(e,r){if(e==="__proto__"||e==="constructor"&&r&&typeof r=="object"&&"prototype"in r){A(e);return}return r}function A(e){console.warn(`[destr] Dropping "${e}" key to prevent prototype pollution.`)}function N(e,r={}){if(typeof e!="string")return e;const n=e.trim();if(e[0]==='"'&&e.endsWith('"')&&!e.includes("\\"))return n.slice(1,-1);if(n.length<=9){const s=n.toLowerCase();if(s==="true")return!0;if(s==="false")return!1;if(s==="undefined")return;if(s==="null")return null;if(s==="nan")return Number.NaN;if(s==="infinity")return Number.POSITIVE_INFINITY;if(s==="-infinity")return Number.NEGATIVE_INFINITY}if(!S.test(e)){if(r.strict)throw new SyntaxError("[destr] Invalid JSON");return e}try{if(R.test(e)||_.test(e)){if(r.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(e,q)}return JSON.parse(e)}catch(s){if(r.strict)throw s;return e}}class P extends Error{constructor(r,n){super(r,n),this.name="FetchError",n!=null&&n.cause&&!this.cause&&(this.cause=n.cause)}}function $(e){var c,a,o,y,f;const r=((c=e.error)==null?void 0:c.message)||((a=e.error)==null?void 0:a.toString())||"",n=((o=e.request)==null?void 0:o.method)||((y=e.options)==null?void 0:y.method)||"GET",s=((f=e.request)==null?void 0:f.url)||String(e.request)||"/",u=`[${n}] ${JSON.stringify(s)}`,p=e.response?`${e.response.status} ${e.response.statusText}`:"<no response>",h=`${u}: ${p}${r?` ${r}`:""}`,t=new P(h,e.error?{cause:e.error}:void 0);for(const i of["request","options","response"])Object.defineProperty(t,i,{get(){return e[i]}});for(const[i,d]of[["data","_data"],["status","status"],["statusCode","status"],["statusText","statusText"],["statusMessage","statusText"]])Object.defineProperty(t,i,{get(){return e.response&&e.response[d]}});return t}const j=new Set(Object.freeze(["PATCH","POST","PUT","DELETE"]));function b(e="GET"){return j.has(e.toUpperCase())}function I(e){if(e===void 0)return!1;const r=typeof e;return r==="string"||r==="number"||r==="boolean"||r===null?!0:r!=="object"?!1:Array.isArray(e)?!0:e.buffer?!1:e.constructor&&e.constructor.name==="Object"||typeof e.toJSON=="function"}const C=new Set(["image/svg","application/xml","application/xhtml","application/html"]),O=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function V(e=""){if(!e)return"json";const r=e.split(";").shift()||"";return O.test(r)?"json":C.has(r)||r.startsWith("text/")?"text":"blob"}function F(e,r,n=globalThis.Headers){const s={...r,...e};if(r!=null&&r.params&&(e!=null&&e.params)&&(s.params={...r==null?void 0:r.params,...e==null?void 0:e.params}),r!=null&&r.query&&(e!=null&&e.query)&&(s.query={...r==null?void 0:r.query,...e==null?void 0:e.query}),r!=null&&r.headers&&(e!=null&&e.headers)){s.headers=new n((r==null?void 0:r.headers)||{});for(const[u,p]of new n((e==null?void 0:e.headers)||{}))s.headers.set(u,p)}return s}const k=new Set([408,409,425,429,500,502,503,504]),B=new Set([101,204,205,304]);function m(e={}){const{fetch:r=globalThis.fetch,Headers:n=globalThis.Headers,AbortController:s=globalThis.AbortController}=e;async function u(t){const c=t.error&&t.error.name==="AbortError"&&!t.options.timeout||!1;if(t.options.retry!==!1&&!c){let o;typeof t.options.retry=="number"?o=t.options.retry:o=b(t.options.method)?0:1;const y=t.response&&t.response.status||500;if(o>0&&(Array.isArray(t.options.retryStatusCodes)?t.options.retryStatusCodes.includes(y):k.has(y))){const f=t.options.retryDelay||0;return f>0&&await new Promise(i=>setTimeout(i,f)),p(t.request,{...t.options,retry:o-1,timeout:t.options.timeout})}}const a=$(t);throw Error.captureStackTrace&&Error.captureStackTrace(a,p),a}const p=async function(c,a={}){var f;const o={request:c,options:F(a,e.defaults,n),response:void 0,error:void 0};if(o.options.method=(f=o.options.method)==null?void 0:f.toUpperCase(),o.options.onRequest&&await o.options.onRequest(o),typeof o.request=="string"&&(o.options.baseURL&&(o.request=T(o.request,o.options.baseURL)),(o.options.query||o.options.params)&&(o.request=g(o.request,{...o.options.params,...o.options.query}))),o.options.body&&b(o.options.method)&&(I(o.options.body)?(o.options.body=typeof o.options.body=="string"?o.options.body:JSON.stringify(o.options.body),o.options.headers=new n(o.options.headers||{}),o.options.headers.has("content-type")||o.options.headers.set("content-type","application/json"),o.options.headers.has("accept")||o.options.headers.set("accept","application/json")):("pipeTo"in o.options.body&&typeof o.options.body.pipeTo=="function"||typeof o.options.body.pipe=="function")&&("duplex"in o.options||(o.options.duplex="half"))),!o.options.signal&&o.options.timeout){const i=new s;setTimeout(()=>i.abort(),o.options.timeout),o.options.signal=i.signal}try{o.response=await r(o.request,o.options)}catch(i){return o.error=i,o.options.onRequestError&&await o.options.onRequestError(o),await u(o)}if(o.response.body&&!B.has(o.response.status)&&o.options.method!=="HEAD"){const i=(o.options.parseResponse?"json":o.options.responseType)||V(o.response.headers.get("content-type")||"");switch(i){case"json":{const d=await o.response.text(),w=o.options.parseResponse||N;o.response._data=w(d);break}case"stream":{o.response._data=o.response.body;break}default:o.response._data=await o.response[i]()}}return o.options.onResponse&&await o.options.onResponse(o),!o.options.ignoreResponseError&&o.response.status>=400&&o.response.status<600?(o.options.onResponseError&&await o.options.onResponseError(o),await u(o)):o.response},h=async function(c,a){return(await p(c,a))._data};return h.raw=p,h.native=(...t)=>r(...t),h.create=(t={})=>m({...e,defaults:{...e.defaults,...t}}),h}const E=function(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")}(),D=E.fetch||(()=>Promise.reject(new Error("[ofetch] global.fetch is not supported!"))),J=E.Headers,H=E.AbortController,U=m({fetch:D,Headers:J,AbortController:H});var L={VITE_APP_NAME:"Shabujglobal.org",VITE_REVERB_APP_KEY:"d1eop90n3fpgmkutltzq",VITE_REVERB_HOST:"localhost",VITE_REVERB_PORT:"8080",VITE_REVERB_SCHEME:"http",VITE_SERVER:"org",BASE_URL:"/build/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const G=U.create({baseURL:L.VITE_API_BASE_URL||"/api",async onRequest({options:e}){const r=l("accessToken").value;e.headers={...e.headers,Accept:"application/json"},r&&(e.headers={...e.headers,Authorization:`Bearer ${r}`})},async onResponseError({response:e}){e.status===401&&(l("accessToken").value=null,l("userData").value=null,window.location.href="/login")}});export{G as $};
