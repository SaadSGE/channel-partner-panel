import{u as ne}from"./studentStore-DF5vHptn.js";import{G as ye,U as _e,E as he,a as ge,b as ve}from"./UniversityEntry-DQlplSfj.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as P}from"./VCardText-8dkhgbZ8.js";import{b as L,V as H}from"./VCard-BgzrJPIe.js";import{V as be,a as J}from"./VRow-BJMIsl1C.js";import{V as K}from"./VTable-C7c1numM.js";import{o as u,f as b,e as t,b as e,d as a,v as d,x as f,R as le,U as oe,r as E,j as se,a6 as W,H as re,w as Ie,a9 as q,z as I,a2 as z,c as V,F as j,i as M,n as _,y as X,cH as we,k as ke,a4 as ee}from"./main-BRrswkNF.js";import{u as Ve}from"./fileStore-CQ2XxHQx.js";import{V as Ee,p as xe,a as Ue,b as De}from"./vue-filepond.esm-twLwsyUy.js";import{V as Ce}from"./index-3PBKY6bz.js";import{V as Se}from"./VAlert-CuLem3Ox.js";import{V as ze}from"./VDivider-qPOs2NiK.js";import{V as te}from"./VChip-CiE1uMP5.js";import{V as Pe}from"./VSpacer-Dqc0LZK-.js";import{V as He}from"./dialog-transition-DtWiuTBk.js";import{i as w}from"./index-0pKBX88w.js";import{a as C,V as $e,b as qe,c as S}from"./VWindowItem-BICWJbO4.js";import"./AppTextField-CaH-heS7.js";import"./VInput-CCaHoIxZ.js";import"./index-B3KzD0PN.js";import"./forwardRefs-D3j0TLhE.js";import"./VTextField-BciKVK3Y.js";import"./validators-94CN1vjU.js";import"./helpers-CJKAgAQ1.js";import"./AppAutocomplete-CQak0GV6.js";import"./VSelect-C5khPyk7.js";import"./VList-BCK3pY4K.js";import"./ssrBoot-DN0mDyup.js";import"./VAvatar-BrKuUmwI.js";import"./VImg-BGRr61oX.js";import"./VMenu-DZMmnyHj.js";import"./scopeId-52iFhkpa.js";import"./VCheckboxBtn-BsIn3M_g.js";import"./filter-BuOoE_HU.js";import"./AppSelect-CJMCnrZQ.js";import"./AppDateTimePicker-B3v7GwDi.js";import"./commonFunction-BOGtIzS4.js";import"./VRadioGroup-C7fmgIsz.js";/* empty css              */const $=r=>(le("data-v-f3718574"),r=r(),oe(),r),Le={class:"d-flex justify-space-between align-center"},Fe=$(()=>a("td",{class:"font-weight-bold"},"Email",-1)),Re=$(()=>a("td",{class:"font-weight-bold"},"Name",-1)),Te=$(()=>a("td",{class:"font-weight-bold"},"Phone",-1)),je=$(()=>a("td",{class:"font-weight-bold"},"Interested Course",-1)),Be=$(()=>a("td",{class:"font-weight-bold"},"Interested Country",-1)),Ne=$(()=>a("td",{class:"font-weight-bold"},"IELTS or English Test",-1)),Ae=$(()=>a("td",{class:"font-weight-bold"},"Current Educational Qualifications",-1)),Ge={__name:"LeadInfo",props:{lead:{type:Object,required:!0,default:()=>({email:"",name:"",phone:"",interested_course:"",interested_country:"",Ielts_or_english_test:"",current_educational_qualifications:""})}},setup(r){return(o,g)=>(u(),b(H,null,{default:t(()=>[e(P,null,{default:t(()=>[a("div",Le,[e(L,{class:"padding-bottom"},{default:t(()=>[d("Lead Information")]),_:1})]),e(be,null,{default:t(()=>[e(J,{cols:"12",md:"6"},{default:t(()=>[e(K,{density:"compact",class:"info-table custom-table"},{default:t(()=>[a("tbody",null,[a("tr",null,[Fe,a("td",null,f(r.lead.email||"-"),1)]),a("tr",null,[Re,a("td",null,f(r.lead.name||"-"),1)]),a("tr",null,[Te,a("td",null,f(r.lead.phone||"-"),1)]),a("tr",null,[je,a("td",null,f(r.lead.interested_course||"-"),1)])])]),_:1})]),_:1}),e(J,{cols:"12",md:"6"},{default:t(()=>[e(K,{density:"compact",class:"info-table custom-table"},{default:t(()=>[a("tbody",null,[a("tr",null,[Be,a("td",null,f(r.lead.interested_country||"-"),1)]),a("tr",null,[Ne,a("td",null,f(r.lead.ielts_or_english_test||"-"),1)]),a("tr",null,[Ae,a("td",null,f(r.lead.current_educational_qualifications||"-"),1)])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}},Oe=ae(Ge,[["__scopeId","data-v-f3718574"]]),Me=r=>(le("data-v-2f102ee7"),r=r(),oe(),r),We={class:"d-flex justify-space-between align-center mb-4"},Qe={class:"d-flex justify-end mt-2 mb-2"},Ye={key:1},Ze={class:"d-flex justify-space-between align-center"},Je={class:"d-flex align-center"},Ke={class:"text-body-1 font-weight-medium"},Xe=Me(()=>a("div",{class:"text-caption text-warning"},"Required document missing",-1)),et={key:0,class:"mt-4"},tt={class:"d-flex align-center"},nt={class:"text-body-1 font-weight-medium"},at={class:"text-caption text-medium-emphasis"},lt={class:"d-flex align-center"},ot={key:2},st={key:0,class:"d-flex align-center mb-4 current-file"},rt={class:"text-body-2"},it={__name:"StudentDocuments",props:{documents:{type:Array,required:!0,default:()=>[]},readonly:{type:Boolean,default:!1},zipLink:{type:String,default:""}},emits:["update:documents"],setup(r,{emit:o}){const g=r,p=o,F=Ve(),h=E(!1),c=E(!1),U=E(!1),x=E(""),D=E(new Set),y=E([]),O=se().params.id,B=Ee(De,Ue,xe),N={process:(l,s,n,v,G,pe,ct)=>{F.uploadFile(l,s).then(T=>{y.value.push({fieldName:l,fileId:T,file:s,path:F.getFilePath(T)}),c.value=!0,v(T)}).catch(T=>G(T))},revert:(l,s,n)=>{const v=y.value.findIndex(G=>G.fileId===l);v!==-1&&(F.removeFile(l),F.removeDocument(y.value[v].fieldName,y.value[v].path),y.value.splice(v,1),y.value.length===0&&(c.value=!1)),s()},load:(l,s,n,v,G,pe)=>{s(l)}},A=[{name:"passport",label:"Passport",required:!0},{name:"academic_letter",label:"Academic Reference Letter",required:!0},{name:"professional_letter",label:"Professional Reference Letter",required:!0},{name:"cv-resume",label:"CV/Resume",required:!0},{name:"sop",label:"SOP",required:!0},{name:"supporting_document",label:"Supporting Document",required:!1}],k=l=>g.documents.find(s=>s.document_name===l),m=W(()=>A.filter(l=>!k(l.name)&&l.required)),i=l=>D.value.has(l),R=()=>{c.value?me():h.value=!h.value,h.value||(c.value=!1)},Y=l=>{window.open(l,"_blank")},ie=l=>l.split("_").map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(" "),Z=l=>{switch(l){case"pdf":return"tabler-file-type-pdf";case"image":return"tabler-file-type-png";default:return"tabler-file"}},ue=W(()=>c.value?"Save Changes":"Edit Documents"),de=l=>{D.value.has(l)?(D.value.delete(l),D.value.size===0&&(c.value=!1)):(D.value.add(l),c.value=!0)},ce=ne(),me=async()=>{U.value=!0,x.value="";try{console.log("Files before processing:",y.value);const l=y.value.map(n=>({document_name:n.fieldName,path:n.path,missing:m.value.some(v=>v.name===n.fieldName)}));console.log("Document paths to be sent:",l);const s=await ce.updateDocuments(O,l);h.value=!1,y.value=[],c.value=!1,p("update:documents",s)}catch(l){console.error("Error in handleDocumentUpdate:",l),x.value="Failed to update documents. Please try again."}finally{U.value=!1}};re(()=>{}),Ie(h,l=>{l?y.value=[]:y.value=g.documents.map(s=>({fieldName:s.document_name,path:s.path,file:s.file_name}))});const fe=async()=>{if(g.zipLink)try{const s=await(await fetch(g.zipLink,{mode:"cors"})).blob(),n=document.createElement("a");n.href=URL.createObjectURL(s),n.target="_blank",n.download="documents.zip",document.body.appendChild(n),n.click(),document.body.removeChild(n)}catch{}else x.value="No ZIP file available for download."};return(l,s)=>(u(),b(H,null,{default:t(()=>[e(P,null,{default:t(()=>[a("div",We,[e(L,null,{default:t(()=>[d("Documents")]),_:1}),!r.readonly&&l.$can("edit","student")?(u(),b(q,{key:0,color:c.value?"success":"primary",onClick:R},{default:t(()=>[d(f(ue.value),1)]),_:1},8,["color"])):I("",!0)]),x.value&&l.$can("edit","student")?(u(),b(Se,{key:0,type:"error",class:"mb-4",closable:"","onClick:close":s[0]||(s[0]=n=>x.value="")},{default:t(()=>[d(f(x.value),1)]),_:1})):I("",!0),a("div",Qe,[e(q,{href:r.zipLink,color:"warning",target:"_blank",onClick:fe},{default:t(()=>[e(z,{size:"24",icon:"tabler-download"}),d(" Download All ")]),_:1},8,["href"])]),h.value?(u(),V("div",ot,[(u(),V(j,null,M(A,n=>e(H,{key:n.name,class:X(["mb-4",{"missing-document":!k(n.name)&&n.required}])},{default:t(()=>[e(L,{class:"d-flex align-center"},{default:t(()=>[d(f(n.label)+" ",1),n.required?(u(),b(te,{key:0,color:"warning",size:"small",class:X(["ms-2",{error:!k(n.name)}])},{default:t(()=>[d(" Required ")]),_:2},1032,["class"])):I("",!0)]),_:2},1024),e(P,null,{default:t(()=>[k(n.name)?(u(),V("div",st,[e(z,{icon:Z(k(n.name).file_type),size:"20",class:"me-2"},null,8,["icon"]),a("span",rt,f(k(n.name).file_name),1),e(Pe),e(q,{icon:"",variant:"text",color:"primary",size:"small",onClick:v=>Y(k(n.name).path),class:"ms-2"},{default:t(()=>[e(z,{icon:"tabler-eye",size:"20"})]),_:2},1032,["onClick"])])):I("",!0),e(_(B),{name:n.name,"allow-multiple":n.name==="supporting_document",server:N,files:y.value,allowRemove:"true","label-idle":"Drop files here or <span class='filepond--label-action'>Browse</span>"},null,8,["name","allow-multiple","files"])]),_:2},1024)]),_:2},1032,["class"])),64))])):(u(),V("div",Ye,[m.value.length>0?(u(),V(j,{key:0},[e(L,{class:"text-warning"},{default:t(()=>[d("Missing Required Documents")]),_:1}),(u(!0),V(j,null,M(m.value,n=>(u(),b(H,{key:n.name,class:"mb-4 missing-document-card"},{default:t(()=>[e(P,null,{default:t(()=>[a("div",Ze,[a("div",Je,[e(z,{icon:"tabler-file-alert",color:"warning",size:"24",class:"me-2"}),a("div",null,[a("span",Ke,f(n.label),1),Xe])]),r.readonly?I("",!0):(u(),b(q,{key:0,color:"warning",variant:"outlined",size:"small",onClick:v=>de(n.name)},{default:t(()=>[d(f(i(n.name)?"Cancel Upload":"Upload Document"),1)]),_:2},1032,["onClick"]))]),e(Ce,null,{default:t(()=>[i(n.name)?(u(),V("div",et,[e(_(B),{name:n.name,"allow-multiple":n.name==="supporting_document",server:N,files:null,allowRemove:"true","label-idle":"Drop files here or <span class='filepond--label-action'>Browse</span>"},null,8,["name","allow-multiple"])])):I("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),e(ze,{class:"my-4"})],64)):I("",!0),r.documents.length>0?(u(),V(j,{key:1},[e(L,null,{default:t(()=>[d("Uploaded Documents")]),_:1}),(u(!0),V(j,null,M(r.documents,n=>(u(),b(H,{key:n.file_name,class:"mb-4 document-card"},{default:t(()=>[e(P,{class:"d-flex justify-space-between align-center"},{default:t(()=>[a("div",tt,[e(z,{icon:Z(n.file_type),size:"24",class:"me-2"},null,8,["icon"]),a("div",null,[a("span",nt,f(ie(n.document_name)),1),a("div",at,f(n.file_name),1)])]),a("div",lt,[e(q,{icon:"",variant:"text",color:"primary",onClick:v=>Y(n.path),class:"me-2"},{default:t(()=>[e(z,{icon:"tabler-eye"})]),_:2},1032,["onClick"]),e(te,{color:n.file_type==="pdf"?"error":"primary",size:"small",class:"text-uppercase"},{default:t(()=>[d(f(n.file_type),1)]),_:2},1032,["color"])])]),_:2},1024)]),_:2},1024))),128))],64)):I("",!0),r.documents.length===0&&m.value.length===0?(u(),b(H,{key:2,class:"mb-4"},{default:t(()=>[e(P,{class:"text-center text-medium-emphasis"},{default:t(()=>[d(" No documents available ")]),_:1})]),_:1})):I("",!0)])),e(He,{modelValue:U.value,"onUpdate:modelValue":s[1]||(s[1]=n=>U.value=n),class:"align-center justify-center"},{default:t(()=>[e(we,{indeterminate:"",size:"64"})]),_:1},8,["modelValue"])]),_:1})]),_:1}))}},ut=ae(it,[["__scopeId","data-v-2f102ee7"]]),dt=a("div",null,"Student Details",-1),Kt={__name:"[id]",setup(r){const o=ne(),g=E("general-info"),p=E(!1),h=se().params.id,c=E({generalInfo:{first_name:"",last_name:"",email:"",mobile:"",date_of_birth:"",gender:"",passport_number:"",address:"",city:"",country:"",visa_refusal:"no"},universityEntry:[{country_id:"",intake_id:"",course_type:"",university_id:"",course_id:""}],educationalHistory:[{degree:"",institution:"",passingYear:"",result:""}],englishProficiency:[{proficiencyTitle:"",overallScore:"",reading:"",writing:"",speaking:"",listening:""}],employmentHistory:[{company_name:"",designation:"",year:""}],documents:[],lead:{email:"",name:"",phone:"",interested_course:"",interested_country:"",Ielts_or_english_test:"",current_educational_qualifications:""}}),U=W(()=>o.studentInfo.lead!==null),x=ke(),D=()=>{x.back()};re(async()=>{await y(h)});const y=async m=>{p.value=!0;try{await o.getStudentDetails(m),c.value={generalInfo:{first_name:o.studentInfo.generalInfo.student_first_name,last_name:o.studentInfo.generalInfo.student_last_name,email:o.studentInfo.generalInfo.student_email,mobile:o.studentInfo.generalInfo.student_whatsapp_number,date_of_birth:o.studentInfo.generalInfo.date_of_birth,gender:o.studentInfo.generalInfo.gender,passport_number:o.studentInfo.generalInfo.student_passport_no,address:o.studentInfo.generalInfo.student_address,city:o.studentInfo.generalInfo.student_city,country:o.studentInfo.generalInfo.student_country,visa_refusal:o.studentInfo.generalInfo.visa_refusal,zip_link:o.studentInfo.generalInfo.zip_link},universityEntry:o.studentInfo.interestedUniversity,educationalHistory:o.studentInfo.educationalHistory,englishProficiency:o.studentInfo.englishProficiency,employmentHistory:o.studentInfo.employmentHistory,documents:o.studentInfo.documentPaths,leadInfo:{email:o.studentInfo.lead.email,name:o.studentInfo.lead.name,phone:o.studentInfo.lead.phone,interested_course:o.studentInfo.lead.interested_course,interested_country:o.studentInfo.lead.interested_country,Ielts_or_english_test:o.studentInfo.lead.Ielts_or_english_test,current_educational_qualifications:o.studentInfo.lead.current_educational_qualifications}}}catch(i){console.error("Error fetching student details:",i)}finally{p.value=!1}},Q=async m=>{try{await o.updateGeneralInfo(h,m)}catch(i){console.error("Error updating general info:",i)}},O=async m=>{try{p.value=!0,await o.updateInterestedUniversity(h,m),w.success("University entry updated successfully",{position:"top-right",theme:"colored"})}catch(i){console.error("Error updating university entry:",i),w.error("Failed to update university entry",{position:"top-right",theme:"colored"})}finally{p.value=!1}},B=async m=>{try{p.value=!0,await o.updateEducationalHistory(h,m),w.success("Educational history updated successfully",{position:"top-right",theme:"colored"})}catch(i){console.error("Error updating educational history:",i),w.error("Failed to update educational history",{position:"top-right",theme:"colored"})}finally{p.value=!1}},N=async m=>{try{p.value=!0,await o.updateEnglishProficiency(h,m),w.success("English proficiency updated successfully",{position:"top-right",theme:"colored"})}catch(i){console.error("Error updating English proficiency:",i),w.error("Failed to update English proficiency",{position:"top-right",theme:"colored"})}finally{p.value=!1}},A=async m=>{try{p.value=!0,await o.updateEmploymentHistory(h,m),w.success("Employment history updated successfully",{position:"top-right",theme:"colored"})}catch(i){console.error("Error updating employment history:",i),w.error("Failed to update employment history",{position:"top-right",theme:"colored"})}finally{p.value=!1}},k=async m=>{try{p.value=!0,c.value.documents=m,w.success("Documents updated successfully",{position:"top-right",theme:"colored"})}catch(i){console.error("Error updating documents:",i),w.error("Failed to update documents",{position:"top-right",theme:"colored"})}finally{p.value=!1}};return(m,i)=>(u(),b(H,null,{default:t(()=>[e(L,{class:"d-flex justify-space-between align-center"},{default:t(()=>[dt,e(q,{color:"primary",onClick:D},{default:t(()=>[e(z,{icon:"tabler-arrow-left",class:"mr-2"}),d(" Back ")]),_:1})]),_:1}),e($e,{modelValue:_(g),"onUpdate:modelValue":i[0]||(i[0]=R=>ee(g)?g.value=R:null)},{default:t(()=>[e(C,{value:"general-info"},{default:t(()=>[d(" General Info ")]),_:1}),e(C,{value:"documents"},{default:t(()=>[d(" Documents ")]),_:1}),e(C,{value:"interested-university"},{default:t(()=>[d(" Interested University ")]),_:1}),e(C,{value:"educational-history"},{default:t(()=>[d(" Educational History ")]),_:1}),e(C,{value:"english-proficiency"},{default:t(()=>[d(" English Proficiency ")]),_:1}),e(C,{value:"employment-history"},{default:t(()=>[d(" Employment History ")]),_:1}),_(U)?(u(),b(C,{key:0,value:"lead-info"},{default:t(()=>[d(" Lead Information ")]),_:1})):I("",!0)]),_:1},8,["modelValue"]),e(P,null,{default:t(()=>[e(qe,{modelValue:_(g),"onUpdate:modelValue":i[1]||(i[1]=R=>ee(g)?g.value=R:null)},{default:t(()=>[e(S,{value:"general-info"},{default:t(()=>[e(ye,{"general-info":_(c).generalInfo,onUpdateGeneralInfo:Q,"is-edit":!0,readonly:!0},null,8,["general-info"])]),_:1}),e(S,{value:"interested-university"},{default:t(()=>[e(_e,{"university-entry":_(c).universityEntry,onUpdateUniversityEntry:O,readonly:!0,"is-edit":!0},null,8,["university-entry"])]),_:1}),e(S,{value:"educational-history"},{default:t(()=>[e(he,{"educational-history":_(c).educationalHistory,onUpdateEducationalHistory:B,readonly:!0,"is-edit":!0},null,8,["educational-history"])]),_:1}),e(S,{value:"english-proficiency"},{default:t(()=>[e(ge,{"english-proficiency":_(c).englishProficiency,onUpdateEnglishProficiency:N,readonly:!0,"is-edit":!0},null,8,["english-proficiency"])]),_:1}),e(S,{value:"employment-history"},{default:t(()=>[e(ve,{"employment-history":_(c).employmentHistory,onUpdateEmploymentHistory:A,readonly:!0,"is-edit":!0},null,8,["employment-history"])]),_:1}),e(S,{value:"documents"},{default:t(()=>[e(ut,{documents:_(c).documents,"is-edit":!0,"onUpdate:documents":k,"zip-link":_(c).generalInfo.zip_link},null,8,["documents","zip-link"])]),_:1}),_(U)?(u(),b(S,{key:0,value:"lead-info"},{default:t(()=>[e(Oe,{lead:_(o).studentInfo.lead},null,8,["lead"])]),_:1})):I("",!0)]),_:1},8,["modelValue"])]),_:1})]),_:1}))}};export{Kt as default};
