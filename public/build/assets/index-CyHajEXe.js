import{e as Y,l as fe,j as ve,r as ge}from"./helpers-Bzg9TCNL.js";import{r as n,w as Z,o as w,f as j,e as t,b as e,v as d,n as D,a9 as h,aK as _e,aL as q,bL as ye,H as he,c as B,z as E,a8 as Ve,d as i,a2 as P,x as y,F as we,i as Se,y as Ce}from"./main-Z3go8Xzc.js";import{r as be}from"./validators-DLm9bwa3.js";import{_ as xe}from"./AppAutocomplete-DVX6hFXO.js";import{V as z,b as O,c as ee,a as ke}from"./VCard-B6jmDFyP.js";import{V as N}from"./VCardText-Bjotn_eE.js";import{V as G}from"./VSpacer-DjAd7_Hm.js";import{V as te}from"./VDialog-BsSXCWXL.js";import{_ as Le}from"./TablePagination-QwDXvVnB.js";import{_ as Ne}from"./AppTextField-DC2x1dsw.js";import{_ as De}from"./AppSelect-CCci48xp.js";import{_ as Ue}from"./AppTextarea-PxDci0tT.js";import{_ as Ae}from"./Filters-Dvjt-72t.js";/* empty css                         */import{V as L,a as $e}from"./VRow-eo7qXlZG.js";import{V as Ie}from"./VForm-CRZr7ck4.js";import{V as Te}from"./VInput-KBboyctu.js";import{V as Q}from"./VDivider-SUUc1KGp.js";import{V as Fe}from"./VFileInput-CXYzYkcy.js";import{V as Be}from"./VDataTableServer-_bBsEW4-.js";import{V as Ee}from"./VChip-CISZQW4c.js";import{V as Pe}from"./VMenu-CiscxyXl.js";import{V as je,a as W,b as X}from"./VList-CuZQ3pYZ.js";import"./VSelect-DZ8I6LSD.js";import"./VTextField-B1_fIF9I.js";import"./forwardRefs-D3j0TLhE.js";import"./index-CJOm_KJi.js";import"./dialog-transition-6CoWjX9C.js";import"./scopeId-Brt4yQ2W.js";import"./VCheckboxBtn-GLY3abaH.js";import"./VAvatar-DFwpysqo.js";import"./VImg-DvovO2d-.js";import"./filter-CBgIupOh.js";/* empty css              */import"./VPagination-DvivjafL.js";import"./AppDateTimePicker-BWnOzNRI.js";import"./commonFunction-C4n_HNA0.js";import"./rolePermission-D2xSqWcF.js";import"./user-DCPorwEi.js";import"./index-BgvB69-2.js";import"./VDataTable-DjbBVbtI.js";import"./VTable-CvwxmxPq.js";import"./ssrBoot-CoAt9jNJ.js";const ze={__name:"ChangeStatusDialog",props:{showDialog:Boolean,leadId:Number,statusId:Number},emits:["updateStatus","closeDialog"],setup(p,{emit:c}){const s=p,m=c,r=n(null);Z(()=>s.showDialog,u=>{u&&(r.value=Y(s.statusId))});const g=()=>{m("closeDialog")},f=()=>{r.value!==null&&(m("updateStatus",{leadId:s.leadId,statusId:r.value}),g())};return(u,S)=>{const _=xe;return w(),j(te,{"model-value":s.showDialog,persistent:"",width:u.$vuetify.display.smAndDown?"auto":400,"onClick:outside":g},{default:t(()=>[e(z,null,{default:t(()=>[e(O,null,{default:t(()=>[d("Select New Status")]),_:1}),e(N,null,{default:t(()=>[e(_,{modelValue:r.value,"onUpdate:modelValue":S[0]||(S[0]=v=>r.value=v),items:D(fe),"item-title":v=>v.text,"item-value":v=>v.id,label:"Status",placeholder:"Select Status",rules:["requiredValidator"in u?u.requiredValidator:D(be)],clearable:""},null,8,["modelValue","items","item-title","item-value","rules"])]),_:1}),e(ee,null,{default:t(()=>[e(G),e(h,{color:"primary",onClick:f},{default:t(()=>[d("Update Status")]),_:1}),e(h,{text:"",onClick:g},{default:t(()=>[d("Cancel")]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value","width"])}}},Me=_e({id:"lead-store",state:()=>({errors:[],successMessage:""}),actions:{async getLeads(p=null,c=1,s=10,m="",r="",g="",f=null,u=null,S=null){try{return await q("/leads",{method:"GET",headers:{"Content-Type":"application/json"},params:{id:p,page:c,perPage:s,searchQuery:m,sortBy:r,orderBy:g,status:f,dateFrom:u,dateTo:S}})}catch(_){throw console.error("Error getting leads list:",_),this.errors=_.response?_.response.data.errors:["An unexpected error occurred"],_}},async updateLeadStatus(p,c){var s,m;try{console.log("Updating lead with data:",p,c);const r=await q(`/leads/${p}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:c});return console.log("Lead status updated successfully:",r),r.data}catch(r){throw console.error("Error updating lead status:",r),this.errors=((m=(s=r.response)==null?void 0:s.data)==null?void 0:m.errors)||["An unexpected error occurred"],r}},async addNote(p,c){console.log("Adding note with:",c);try{return(await q(`/leads/${p}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)})).data}catch(s){throw console.error("Error adding note:",s),this.errors=s.response?s.response.data.errors:["An unexpected error occurred"],s}}}}),qe={class:"me-3 d-flex gap-3"},Oe={class:"app-user-search-filter d-flex align-center flex-wrap gap-4"},Ge={style:{"inline-size":"15.625rem"}},He=i("span",null,"Upload Lead Excel/csv File",-1),Je={class:"form-padding mt-6"},Ke=i("p",{class:"text-muted"},"Only Excel/CSV file support",-1),Re=i("span",{class:"text-lg font-bold"},"Download Sample Excel/CSV File",-1),Qe={class:"d-flex flex-column ms-3"},We={class:"d-block font-weight-medium text-truncate text-high-emphasis"},Xe={class:"text-md"},Ye={style:{"list-style-type":"disc","padding-inline-start":"20px"}},Ze={style:{color:"#757575"}},et={style:{color:"#007acc"}},tt={style:{color:"orange"}},at=["onClick"],Kt={__name:"index",props:{userId:{type:String,default:null}},setup(p){const c=p,s=Me(),m=n([]),r=n(),g=n(!1),f=n(10),u=n(1),S=n(),_=n(),v=n(""),U=n(null),H=n(null),A=n(null),$=n(null),I=n(!1),J=n(null),M=n(!1),C=n(!1),x=n(""),k=n(!1),T=ye({}),ae=o=>{T[o]=!T[o]},le=[{title:"Name",key:"name"},{title:"Phone",key:"phone"},{title:"Email",key:"email"},{title:"Note",key:"notes"},{title:"Lead Date",key:"lead_date"},{title:"Branch Name",key:"branch"},{title:"Interested Course & Country",key:"course_country"},{title:"Status",key:"status"},{title:"Assigned Branch",key:"assigned_branch"},{title:"Assigned User",key:"assigned_user"},{title:"Actions",key:"actions",sortable:!1}];Z([v,U,A,$],()=>{F()}),he(async()=>{await F()});const K=()=>{M.value=!M.value},oe=()=>{},se=o=>{const l=o.target.files[0];console.log("Selected file:",l)},ne=()=>{},F=async()=>{g.value=!0;try{const o=await s.getLeads(c.userId,u.value,f.value,v.value,S.value,_.value,U.value,A.value,$.value);m.value=o.data,r.value=o.total}catch(o){console.error("Error fetching leads:",o)}finally{g.value=!1}},re=o=>{var l,b;S.value=(l=o.sortBy[0])==null?void 0:l.key,_.value=(b=o.sortBy[0])==null?void 0:b.order},de=(o,l)=>{J.value=o,H.value=l,I.value=!0},ie=async({leadId:o,statusId:l})=>{console.log(o,l);const b={status:l};await s.updateLeadStatus(o,b),console.log("Updated status"),await F(),I.value=!1},R=async o=>{try{C.value=!0,k.value=!0,console.log(x.value);const l={notes:x.value};await s.addNote(o,l),x.value="",C.value=!1}catch(l){console.error("Error adding note:",l)}finally{k.value=!1,F()}};return(o,l)=>{const b=Ue,ue=De,ce=Ne,pe=Le,me=ze;return w(),B("section",null,[e(z,{class:"mb-6"},{default:t(()=>[o.$can("filter","user")?(w(),j(ke,{key:0,class:"pb-4"},{default:t(()=>[e(O,null,{default:t(()=>[d("Filter")]),_:1})]),_:1})):E("",!0),o.$can("filter","user")?(w(),j(N,{key:1},{default:t(()=>[e(L,null,{default:t(()=>[e(Ae,{"selected-lead-status":U.value,onUpdateLeadStatus:l[0]||(l[0]=a=>U.value=a),"selected-dateFrom":A.value,"selected-dateTo":$.value,onUpdateDateFrom:l[1]||(l[1]=a=>A.value=a),onUpdateDateTo:l[2]||(l[2]=a=>$.value=a)},null,8,["selected-lead-status","selected-dateFrom","selected-dateTo"])]),_:1}),e(te,{modelValue:C.value,"onUpdate:modelValue":l[5]||(l[5]=a=>C.value=a),"max-width":"500px"},{default:t(()=>[e(z,null,{default:t(()=>[e(O,null,{default:t(()=>[d("Add a New Note")]),_:1}),e(N,null,{default:t(()=>[e(Ie,{onSubmit:Ve(R,["prevent"])},{default:t(()=>[e(Te,{class:"mt-2"},{default:t(()=>[d(" New Note ")]),_:1}),e(b,{modelValue:x.value,"onUpdate:modelValue":l[3]||(l[3]=a=>x.value=a),placeholder:"Add a new note",class:"mt-2"},null,8,["modelValue"])]),_:1})]),_:1}),e(ee,null,{default:t(()=>[e(G),e(h,{color:"primary",loading:k.value,disabled:k.value,onClick:R},{default:t(()=>[d(" Submit Note ")]),_:1},8,["loading","disabled"]),e(h,{disabled:k.value,onClick:l[4]||(l[4]=a=>C.value=!1)},{default:t(()=>[d(" Cancel ")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})):E("",!0),e(Q),e(N,{class:"d-flex flex-wrap gap-4"},{default:t(()=>[i("div",qe,[e(ue,{"model-value":f.value,items:[{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:100},{value:-1,title:"All"}],style:{"inline-size":"6.25rem"},"onUpdate:modelValue":l[6]||(l[6]=a=>f.value=parseInt(a,10))},null,8,["model-value"])]),e(G),i("div",Oe,[i("div",Ge,[e(ce,{modelValue:v.value,"onUpdate:modelValue":l[7]||(l[7]=a=>v.value=a),placeholder:"Search Lead"},null,8,["modelValue"])]),e(h,{"prepend-icon":"tabler-plus",onClick:K},{default:t(()=>[d(" Upload Lead ")]),_:1})]),M.value?(w(),j(z,{key:0,class:"mt-4 w-100 full-width-card"},{default:t(()=>[e(N,null,{default:t(()=>[e(L,{justify:"space-between",class:"align-center"},{default:t(()=>[He,e(h,{icon:"",onClick:K},{default:t(()=>[e(P,{icon:"tabler-x"})]),_:1})]),_:1}),i("div",Je,[e(L,{justify:"center",align:"center",class:"gap-4"},{default:t(()=>[e($e,{cols:"12",md:"6"},{default:t(()=>[e(Fe,{accept:".xlsx, .csv",label:"Upload Excel/CSV file",onChange:se,variant:"outlined",color:"purple-lighten-4"})]),_:1}),e(h,{"prepend-icon":"tabler-cloud-upload",onClick:ne,color:"purple-lighten-4"},{default:t(()=>[d(" Upload ")]),_:1})]),_:1}),e(L,{justify:"center",class:"mt-2"},{default:t(()=>[Ke]),_:1}),e(L,{justify:"center",align:"center",class:"mt-6 gap-2"},{default:t(()=>[Re,e(h,{"prepend-icon":"tabler-cloud-download",onClick:oe,class:"ml-4 font-bold"},{default:t(()=>[d(" Download ")]),_:1})]),_:1})])]),_:1})]),_:1})):E("",!0)]),_:1}),e(Q),e(Be,{"items-per-page":f.value,"onUpdate:itemsPerPage":l[10]||(l[10]=a=>f.value=a),page:u.value,"onUpdate:page":l[11]||(l[11]=a=>u.value=a),loading:g.value,"onUpdate:options":re,"items-length":r.value,headers:le,items:m.value,"item-value":"total",class:"text-no-wrap text-sm rounded-0"},{"item.course_country":t(({item:a})=>[i("div",Qe,[i("span",We,y(a.interested_course),1),i("span",Xe,y(a.interested_country),1)])]),"item.notes":t(({item:a})=>[i("ul",Ye,[(w(!0),B(we,null,Se(T[a.id]?a.notes:a.notes.slice(0,2),(V,lt)=>(w(),B("li",{key:V.id,class:"note",style:{"font-size":"1.1em","margin-block-end":"8px"}},[d(y(V.note)+" ( ",1),i("small",Ze,[i("span",et,y(V.created_by),1),d(", "),i("span",tt,y(V.created_at?new Date(V.created_at).toLocaleDateString():"N/A"),1)]),d(" ) ")]))),128))]),a.notes.length>2?(w(),B("p",{key:0,onClick:V=>ae(a.id),style:{color:"blue",cursor:"pointer","font-weight":"bold","padding-inline-start":"10px","text-decoration":"underline"}},y(T[a.id]?"Show Less":"Show More"),9,at)):E("",!0)]),"item.status":t(({item:a})=>[e(Ee,{color:("resolveLeadStatusColor"in o?o.resolveLeadStatusColor:D(ve))(a.status),class:Ce([`text-${("resolveStatusColor"in o?o.resolveStatusColor:D(ge))(a.status)}`,"font-weight-medium"]),size:"small"},{default:t(()=>[d(y(D(Y)(a.status)),1)]),_:2},1032,["color","class"])]),"item.assigned_branch":t(({item:a})=>[i("span",null,y(a.assigned_branch||"Not Assigned"),1)]),"item.assigned_user":t(({item:a})=>[i("span",null,y(a.assigned_user||"Not Assigned"),1)]),"item.actions":t(({item:a})=>[e(h,{icon:"",variant:"text",color:"medium-emphasis"},{default:t(()=>[e(P,{icon:"tabler-dots-vertical"}),e(Pe,{activator:"parent"},{default:t(()=>[e(je,null,{default:t(()=>[e(W,{onClick:V=>de(a.id,a.status)},{prepend:t(()=>[e(P,{icon:"tabler-analyze"})]),default:t(()=>[e(X,null,{default:t(()=>[d("Change Status")]),_:1})]),_:2},1032,["onClick"]),e(W,{onClick:l[8]||(l[8]=V=>C.value=!0)},{prepend:t(()=>[e(P,{icon:" tabler-clipboard-text"})]),default:t(()=>[e(X,null,{default:t(()=>[d("Add Note")]),_:1})]),_:1})]),_:2},1024)]),_:2},1024)]),_:2},1024)]),bottom:t(()=>[e(pe,{page:u.value,"onUpdate:page":l[9]||(l[9]=a=>u.value=a),"items-per-page":f.value,"total-items":r.value},null,8,["page","items-per-page","total-items"])]),_:1},8,["items-per-page","page","loading","items-length","items"])]),_:1}),e(me,{showDialog:I.value,leadId:J.value,statusId:H.value,onUpdateStatus:ie,onCloseDialog:l[12]||(l[12]=a=>I.value=!1)},null,8,["showDialog","leadId","statusId"])])}}};export{Kt as default};
