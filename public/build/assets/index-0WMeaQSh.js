import{r as de}from"./validators-C_hVgKmW.js";import{a6 as me,r as s,H as pe,w as ce,o as i,c as fe,b as l,d as D,e as r,v as u,a8 as ve,n as L,a9 as P,f as d,z as m,a2 as y,F as Ve}from"./main-BADZmGzY.js";import{_ as ge}from"./TablePagination-BI20AWgG.js";import{_ as ye}from"./AppTextField-BNeJXgDa.js";import{_ as Ue}from"./AppSelect-N8xse3dI.js";import{_ as we}from"./AppAutocomplete-BddWbecx.js";import{_ as _e}from"./Filters-B-AcXERl.js";import{c as be}from"./commonFunction-DmSA9djT.js";import{u as Ce}from"./rolePermission-DVUNoWaB.js";import{u as Se}from"./user-CmCEUi5Y.js";import ke from"./AddNewUserDrawer-KWDfIZ_o.js";import he from"./EditNewUserDrawer-BaemLKPz.js";import{S as n}from"./sweetalert2-z6gKu1nJ.js";import{g as $e}from"./helpers-DGBpgzAb.js";import{V as H,b as Q,c as Be,a as De}from"./VCard-BMcYqK4c.js";import{V as N}from"./VCardText-DpRShg84.js";import{V as Pe}from"./VForm-NhQaZf3T.js";import{V as Y}from"./VSpacer-BqonUa-I.js";import{V as xe}from"./VDialog-Cz-Jf7e_.js";import{V as Ee}from"./VRow-D2_yjpKw.js";import{V as j}from"./VDivider-Dlzz5Gif.js";import{V as Ae}from"./VDataTableServer-jhOd5HdN.js";import{V as Fe}from"./VMenu-8-lIYCIn.js";import{V as Te,a as x,b as E}from"./VList-C1NZgyeR.js";import{V as Ie}from"./VSwitch-BwxIw7z_.js";import"./VPagination-D64DIkS1.js";import"./VInput-Bt4jOYU7.js";import"./index-M4AAPadW.js";import"./index-CWxjtjo1.js";import"./forwardRefs-D3j0TLhE.js";import"./VTextField-CPDcYvV-.js";import"./VSelect-C1SS_ZqB.js";import"./dialog-transition-BHECC9gm.js";import"./scopeId-BIg2yWZu.js";import"./VCheckboxBtn-CVbHPjf1.js";import"./VAvatar-BEEmQOUP.js";import"./VImg-KML9Z82w.js";import"./VChip-Cm4E8fkC.js";import"./filter-AyVZ7QHP.js";import"./AppDateTimePicker-D7PsRTgM.js";import"./AppDrawerHeaderSection-BwgMUXN1.js";import"./auth-CjhLxmO5.js";import"./vue3-perfect-scrollbar.esm-B9AoUEe-.js";import"./VNavigationDrawer-rm8-3mhr.js";import"./ssrBoot-Mt929TXd.js";import"./VFileInput-Bn_Yzh_5.js";import"./VCheckbox-DuCNCa9q.js";/* empty css              */import"./VDataTable-DoL6YIB_.js";import"./VTable-CU9xN2Lm.js";const Le={class:"me-3 d-flex gap-3"},Ne={class:"app-user-search-filter d-flex align-center flex-wrap gap-4"},Oe={style:{"inline-size":"15.625rem"}},Lt={__name:"index",setup(Re){const G=me(()=>"calc(100vh - 200px)"),p=Se();Ce();const O=be(),A=s(!1),U=s([]),F=s(0),c=s(10),f=s(1),J=s(),K=s(),w=s(""),_=s(null),b=s(null),C=s(null),S=s(null);s(),s();const k=s(null),h=s(!1);s([]);const T=s(!1),R=s(null),v=s(!1),V=s(null),M=s(null),q=s($e()==="admin"),I=s([]),$=s(null),W=a=>{M.value=a,V.value=a.parent_id||"",v.value=!0},z=async()=>{if(!V.value)return;const a=await p.setParent(M.value.id,V.value);a.success?(B(),n.fire("Success!",a.message,"success"),v.value=!1):n.fire("Error!",a.message,"error")},X=a=>{const e=U.value.findIndex(o=>o.id===a.id);e!==-1&&U.value.splice(e,1,a)},Z=a=>{ee(a)},ee=a=>{R.value=a,T.value=!0},B=async()=>{h.value=!0;try{const a=await p.fetchUsers(f.value,w.value,_.value,b.value,k.value,C.value,S.value,"null",$.value);U.value=a.data,F.value=a.total}catch(a){console.error("Error fetching users:",a)}finally{h.value=!1}},te=async a=>{try{await B(),n.fire("Success!","User added successfully!","success")}catch(e){console.error("Error adding user:",e),n.fire("Error!","Failed to add user.","error")}},ae=async a=>{if((await n.fire({title:"Are you sure?",text:"Do you want to delete this user?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel"})).isConfirmed){const o=await p.deleteUser(a);o.success?n.fire("Deleted!",o.message,"success"):n.fire("Error!",o.message,"error")}},le=a=>{var e,o;J.value=(e=a.sortBy[0])==null?void 0:e.key,K.value=(o=a.sortBy[0])==null?void 0:o.order,B()},re=[{title:"Name",key:"full_name"},{title:"Company",key:"company_name_with_email"},{title:"Role",key:"role"},...q.value?[{title:"Parent",key:"parent.full_name"}]:[],{title:"Record Count",key:"record_count"},...q.value?[{title:"Status",key:"status",sortable:!1}]:[],{title:"Actions",key:"actions",sortable:!1}],se=async a=>{a.statusLoading=!0;try{(await p.updateUserStatus(a.id,a.status)).status?n.fire("Success!","User status updated successfully!","success"):(n.fire("Error!","Failed to update user status.","error"),a.status=a.status===1?0:1)}catch(e){console.error("Error updating user status:",e),n.fire("Error!","Failed to update user status.","error"),a.status=a.status===1?0:1}finally{a.statusLoading=!1}};pe(async()=>{oe()}),ce([w,_,b,k,C,S,$],()=>{B()});const oe=async()=>{h.value=!0;try{await O.getBranches(),I.value=O.branches}catch(a){console.error("Error fetching branches:",a)}finally{h.value=!1}};return(a,e)=>{const o=we,ne=Ue,ue=ye,ie=ge;return i(),fe(Ve,null,[l(he,{isDrawerOpen:T.value,editedUser:R.value,branches:I.value,"onUpdate:isDrawerOpen":e[0]||(e[0]=t=>T.value=t),onUserUpdated:X},null,8,["isDrawerOpen","editedUser","branches"]),D("section",null,[l(xe,{modelValue:v.value,"onUpdate:modelValue":e[3]||(e[3]=t=>v.value=t),"max-width":"500px"},{default:r(()=>[l(H,null,{default:r(()=>[l(Q,null,{default:r(()=>[u("Set Parent")]),_:1}),l(N,null,{default:r(()=>[l(Pe,{onSubmit:ve(z,["prevent"])},{default:r(()=>[l(o,{modelValue:V.value,"onUpdate:modelValue":e[1]||(e[1]=t=>V.value=t),items:L(p).parentUsers,"item-title":t=>t.name_with_email,"item-value":t=>t.id,label:"Parent",placeholder:"Select Parent",rules:["requiredValidator"in a?a.requiredValidator:L(de)]},null,8,["modelValue","items","item-title","item-value","rules"])]),_:1})]),_:1}),l(Be,null,{default:r(()=>[l(Y),l(P,{color:"primary",onClick:z},{default:r(()=>[u("Submit")]),_:1}),l(P,{onClick:e[2]||(e[2]=t=>v.value=!1)},{default:r(()=>[u("Cancel")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(H,{class:"mb-6"},{default:r(()=>[a.$can("filter","user")?(i(),d(De,{key:0,class:"pb-4"},{default:r(()=>[l(Q,null,{default:r(()=>[u("Filter")]),_:1})]),_:1})):m("",!0),a.$can("filter","user")?(i(),d(N,{key:1},{default:r(()=>[l(Ee,null,{default:r(()=>[l(_e,{"selected-role":_.value,onUpdateRole:e[4]||(e[4]=t=>_.value=t),"selected-parent":b.value,onUpdateParent:e[5]||(e[5]=t=>b.value=t),"selected-userStatus":k.value,onUpdateUserStatus:e[6]||(e[6]=t=>k.value=t),"selected-country":C.value,onUpdateCountry:e[7]||(e[7]=t=>C.value=t),"selected-mou":S.value,onUpdateMou:e[8]||(e[8]=t=>S.value=t),"selected-branch":$.value,onUpdateBranch:e[9]||(e[9]=t=>$.value=t)},null,8,["selected-role","selected-parent","selected-userStatus","selected-country","selected-mou","selected-branch"])]),_:1})]),_:1})):m("",!0),l(j),l(N,{class:"d-flex flex-wrap gap-4"},{default:r(()=>[D("div",Le,[l(ne,{"model-value":c.value,items:[{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:100},{value:-1,title:"All"}],style:{"inline-size":"6.25rem"},"onUpdate:modelValue":e[10]||(e[10]=t=>c.value=parseInt(t,10))},null,8,["model-value"])]),l(Y),D("div",Ne,[D("div",Oe,[l(ue,{modelValue:w.value,"onUpdate:modelValue":e[11]||(e[11]=t=>w.value=t),placeholder:"Search User"},null,8,["modelValue"])]),a.$can("create","user")?(i(),d(P,{key:0,"prepend-icon":"tabler-plus",onClick:e[12]||(e[12]=t=>A.value=!0)},{default:r(()=>[u(" Add New User ")]),_:1})):m("",!0)])]),_:1}),l(j),l(Ae,{"items-per-page":c.value,"onUpdate:itemsPerPage":e[14]||(e[14]=t=>c.value=t),page:f.value,"onUpdate:page":e[15]||(e[15]=t=>f.value=t),items:U.value,"items-length":F.value,headers:re,class:"text-no-wrap","show-select":"",height:L(G),"onUpdate:options":le},{"item.actions":r(({item:t})=>[l(P,{icon:"",variant:"text",color:"medium-emphasis"},{default:r(()=>[l(y,{icon:"tabler-dots-vertical"}),l(Fe,{activator:"parent"},{default:r(()=>[l(Te,null,{default:r(()=>[l(x,{to:{name:"user-view-id",params:{id:t.id}}},{prepend:r(()=>[l(y,{icon:"tabler-eye"})]),default:r(()=>[l(E,null,{default:r(()=>[u("View")]),_:1})]),_:2},1032,["to"]),a.$can("edit","user")?(i(),d(x,{key:0,onClick:g=>Z(t)},{prepend:r(()=>[l(y,{icon:"tabler-pencil"})]),default:r(()=>[l(E,null,{default:r(()=>[u("Edit")]),_:1})]),_:2},1032,["onClick"])):m("",!0),a.$can("edit","user")?(i(),d(x,{key:1,onClick:g=>W(t)},{prepend:r(()=>[l(y,{icon:"tabler-pencil"})]),default:r(()=>[l(E,null,{default:r(()=>[u("Set Parent")]),_:1})]),_:2},1032,["onClick"])):m("",!0),a.$can("delete","user")?(i(),d(x,{key:2,onClick:g=>ae(t.id)},{prepend:r(()=>[l(y,{icon:"tabler-trash"})]),default:r(()=>[l(E,null,{default:r(()=>[u("Delete")]),_:1})]),_:2},1032,["onClick"])):m("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),"item.status":r(({item:t})=>[l(Ie,{modelValue:t.status,"onUpdate:modelValue":g=>t.status=g,"true-value":1,"false-value":0,onChange:g=>se(t),loading:t.statusLoading},null,8,["modelValue","onUpdate:modelValue","onChange","loading"])]),bottom:r(()=>[l(ie,{page:f.value,"onUpdate:page":e[13]||(e[13]=t=>f.value=t),"items-per-page":c.value,"total-items":F.value},null,8,["page","items-per-page","total-items"])]),_:1},8,["items-per-page","page","items","items-length","height"])]),_:1}),l(ke,{isDrawerOpen:A.value,"onUpdate:isDrawerOpen":e[16]||(e[16]=t=>A.value=t),branches:I.value,onUserData:te},null,8,["isDrawerOpen","branches"])])],64)}}};export{Lt as default};
