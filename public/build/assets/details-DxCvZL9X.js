import{r as ut}from"./validators-BFiGRe3y.js";import{r as d,w as it,H as ot,o as m,f as B,e,b as t,d as a,v as s,x as i,n as F,c as f,F as D,z as N,j as rt,a6 as K,a7 as C,an as dt,i as G,R as mt,U as pt}from"./main-JeqQMmwL.js";import{_ as ct}from"./AppTextarea-BZD7hmGn.js";import{_ as _t}from"./AppAutocomplete-DtgsWaYJ.js";import{u as nt}from"./applicationList-YGBSj49d.js";import{_ as vt}from"./TablePagination-Cdr84kWy.js";import{_ as ft}from"./AppSelect-B5lFDM0q.js";import{u as yt,f as at}from"./format-1xFb8tEb.js";import{f as gt}from"./helpers-BJL85UA9.js";import{V as P}from"./VCardText-DwoObMNb.js";import{V as Vt}from"./VDivider-DFOEKbUK.js";import{V as wt}from"./VDataTableServer-CJnQL4vp.js";import{V as St}from"./VChip-_ECrNTq0.js";import{V as E,b as O,d as J}from"./VCard-Bua5yW2h.js";/* empty css                         */import Ct from"./details-document-D6E3qWu0.js";import{_ as bt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as X}from"./VDialog-FsJLVASO.js";import{V as Y}from"./VForm-C_9WjByA.js";import{V as H}from"./form-CoN8BGU1.js";import{V as ht}from"./VFileInput-D_p7ovpN.js";import{V as Z}from"./VSpacer-DdxwTxzT.js";import{V as At}from"./VTextField-s0w8yvdP.js";import{V as kt,a as M}from"./VTabs-Do3W4WTk.js";import{V as Ut,a as j}from"./VWindowItem-DhwY2n5-.js";import{V as W,a as U}from"./VRow-XonbfKIj.js";import{V as lt}from"./VTable-DV_Rb5f-.js";/* empty css                   */import"./VCounter-C1ZtmHnM.js";import"./index-C7Z3FfHW.js";import"./index-AORGi_uA.js";import"./VField-Bv_JpsSw.js";import"./easing-CjukEv2V.js";import"./VInput-X8Rk_bMl.js";import"./forwardRefs-C-GTDzx5.js";import"./VSelect-Bv_d0Orn.js";import"./VList-BVi-OV8s.js";import"./ssrBoot-ClFHSiZX.js";import"./VAvatar-Tgh28dnY.js";import"./VImg-ObyGeY8j.js";import"./dialog-transition-C-2LiOZp.js";import"./VMenu-BI2dpZZA.js";import"./VOverlay-4C44LsMX.js";import"./lazy-DCvnru5p.js";import"./scopeId-D4-41dY0.js";import"./VCheckboxBtn-CXyd3DFt.js";import"./VSelectionControl-CEY3BFEN.js";import"./filter-RS9YeugG.js";import"./api-KOetWxHk.js";import"./index-B3bPRkoL.js";import"./VPagination-x_yqUUV6.js";import"./VDataTable-rWDDkoNw.js";import"./VSlideGroup-DZZzcosZ.js";import"./fileStore-BIpIhNy1.js";import"./submitApplication-BFRZm8pF.js";import"./filepond-plugin-image-preview.esm-dty6V9An.js";import"./sweetalert2-z6gKu1nJ.js";/* empty css              */const Dt={class:"d-flex justify-space-between flex-wrap gap-6"},$t={class:"me-3 d-flex gap-3"},Lt=a("br",null,null,-1),xt={key:0},Tt={__name:"ApplicationActivityLog",props:{applicationId:{type:String,required:!0}},setup($){const tt=$,_=yt(),p=d([]),w=d(!1),S=d(0),v=d(1),c=d(10),L=d(""),V=d(null),b=[{title:"Date",key:"created_at",sortable:!0},{title:"User",key:"user",sortable:!0},{title:"Activity Type",key:"description",sortable:!0},{title:"Details",key:"details",sortable:!1},{title:"IP Address",key:"ip_address",sortable:!1}],x=async()=>{w.value=!0;try{_.setPage(v.value),_.setPerPage(c.value),_.setActivityType(V.value),_.setSearchQuery(L.value);const u=await _.fetchApplicationActivityLogs(tt.applicationId);p.value=u.data.data.map(r=>({...r,created_at:at(new Date(r.created_at),"yyyy-MM-dd HH:mm:ss"),ip_address:r.properties.ip||"N/A",details:h(r),user:r.user?r.user.name:"System"})),S.value=u.data.total}catch(u){console.error("Error fetching activity logs:",u)}finally{w.value=!1}},z=nt(),I=d([]),h=u=>{switch(u.description){case"application_submit":return`Submitted application #${u.properties.application_id}`;case"application_update":return`Updated application #${u.properties.application_id}`;case"document_upload":return`Uploaded document: ${u.properties.document_name||"Unknown"}`;case"comment_added":return`Added comment to application #${u.properties.application_id||"Unknown"}`;case"application_status_update":const r=k(u.properties.old_status),A=k(u.properties.new_status);return`Updated status from ${r} to ${A}`;default:return u.description||"Performed an action"}},k=u=>{const r=I.value.find(A=>A.id===parseInt(u));return r?r.name:"Unknown"},g=u=>{switch(u){case"application_submit":return"primary";case"application_update":return"info";case"document_upload":return"success";case"comment_added":return"warning";case"application_status_update":return"error";default:return"default"}},q=u=>{v.value=u.page,c.value=u.itemsPerPage,u.sortBy&&u.sortBy.length>0&&_.setSorting(u.sortBy[0].key,u.sortBy[0].order),x()};it([L,V],()=>{v.value=1,x()}),ot(async()=>{await x(),await Q()});const Q=async()=>{const u=await z.getAllApplicationStatuses();I.value=u.data};return(u,r)=>{const A=ft,R=vt;return m(),B(E,{title:"Application Activity Log",class:"mt-5"},{default:e(()=>[t(P,null,{default:e(()=>[a("div",Dt,[a("div",$t,[t(A,{modelValue:c.value,"onUpdate:modelValue":[r[0]||(r[0]=l=>c.value=l),r[1]||(r[1]=l=>c.value=parseInt(l,10))],items:[{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:"100"},{value:-1,title:"All"}],style:{"inline-size":"6.25rem"}},null,8,["modelValue"])])])]),_:1}),t(Vt),t(wt,{"items-per-page":c.value,"onUpdate:itemsPerPage":r[3]||(r[3]=l=>c.value=l),page:v.value,"onUpdate:page":r[4]||(r[4]=l=>v.value=l),items:p.value,"items-length":S.value,headers:b,loading:w.value,class:"text-no-wrap","onUpdate:options":q},{"item.description":e(({item:l})=>[t(St,{color:g(l.description),size:"small"},{default:e(()=>[s(i(F(gt)(l.description)),1)]),_:2},1032,["color"])]),"item.user":e(({item:l})=>[s(i(l.user),1)]),"item.created_at":e(({item:l})=>[s(i(F(at)(new Date(l.created_at),"dd MMM yyyy HH:mm:ss")),1)]),"item.ip_address":e(({item:l})=>[s(i(l.properties.ip),1)]),"item.details":e(({item:l})=>[l.description==="application_status_update"?(m(),f(D,{key:0},[s(" Updated "+i(l.properties.old_status)+" to "+i(l.properties.new_status)+" ",1),Lt,l.properties.comment?(m(),f("span",xt," Comment: "+i(l.properties.comment),1)):N("",!0)],64)):l.description==="comment_added"?(m(),f(D,{key:1},[s(i(l.properties.comment),1)],64)):l.description==="university_communication_added"?(m(),f(D,{key:2},[s(" Subject: "+i(l.properties.subject),1)],64)):(m(),f(D,{key:3},[s(i(l.properties.details||"N/A"),1)],64))]),bottom:e(()=>[t(R,{page:v.value,"onUpdate:page":r[2]||(r[2]=l=>v.value=l),"items-per-page":c.value,"total-items":S.value},null,8,["page","items-per-page","total-items"])]),_:1},8,["items-per-page","page","items","items-length","loading"])]),_:1})}}},y=$=>(mt("data-v-fc52c6af"),$=$(),pt(),$),Mt=y(()=>a("td",null,[a("strong",null,"Application Id")],-1)),jt=y(()=>a("td",null,[a("strong",null,"Date Added")],-1)),Nt=y(()=>a("td",null,[a("strong",null,"Student ID")],-1)),Pt=y(()=>a("td",null,[a("strong",null,"Student Passport No.")],-1)),It=y(()=>a("td",null,[a("strong",null,"Student Name")],-1)),Ht=y(()=>a("td",null,[a("strong",null,"Student Date of Birth")],-1)),Bt=y(()=>a("td",null,[a("strong",null,"Student E-Mail")],-1)),Et=y(()=>a("td",null,[a("strong",null,"Student Phone No.")],-1)),Ft=y(()=>a("td",null,[a("strong",null,"Communication E-Mail ID")],-1)),zt=y(()=>a("td",null,[a("strong",null,"Communication Phone No.")],-1)),qt=y(()=>a("thead",null,[a("tr",null,[a("th",null,"Date Added"),a("th",null,"Comment"),a("th",null,"Status and Document")])],-1)),Qt=["innerHTML"],Rt={key:0,class:"current-status-label"},Ot={key:1},Wt=["href"],Kt={class:"comment-section"},Gt={class:"comment-header"},Jt={class:"comment-date"},Xt=["innerHTML"],Yt={class:"comment-section"},Zt={class:"comment-header"},te={class:"comment-date"},ee={class:"communication-subject"},ae=y(()=>a("strong",null,"Subject:",-1)),le={class:"comment-body"},oe=["innerHTML"],ne={__name:"details",setup($){const _=rt().params.id,p=nt(),w=d("student-course-details"),S=d(!1),v=d(!1),c=d(!1),L=d(""),V=d(""),b=d({subject:"",message:""});d([{name:"Document1.pdf",progress:100},{name:"Document2.pdf",progress:100},{name:"Document3.pdf",progress:100},{name:"Document4.pdf",progress:100}]);const x=d([]),z=d([]),I=d([{created_at:"",comment:"",status_text:""}]),h=d({application_id:"",created_at:"",counsellor_email:"",counsellor_number:""}),k=d();d(!0);const g=d({id:null,student_id:null,first_name:null,last_name:null,passport_no:null,date_of_birth:null,whatsapp_number:null,email:null,address:null,city:null,country:null,region:null,state:null,gender:null,visa_refusal:null,created_at:null,updated_at:null,document:[{id:null,student_id:null,path:null,created_at:null,updated_at:null}]}),q=d([]),Q=d([]);ot(async()=>{await u()});const u=async()=>{await p.getApplicationDetails(_),await p.getApplicationStatusses(_),await p.getApplicationAllStatuses(),h.value=p.applicationData,q.value=p.documents,g.value=p.students,I.value=p.statuses,x.value=p.comments,z.value=p.universityCommunications,Q.value=p.allStatuses.filter(l=>l.id!==h.value.status)},r=async()=>{try{let l=new FormData;l.append("status",L.value),l.append("comment",V.value),k.value&&l.append("file",k.value[0]),await p.updateStatus(_,l),S.value=!1,await u()}catch(l){console.error("Error updating status:",l)}},A=async()=>{try{await p.addComment(_,V.value),V.value="",v.value=!1,await u()}catch(l){console.error("Error adding comment:",l)}},R=async()=>{try{await p.addUniversityCommunication(_,b.value),b.value={subject:"",message:""},c.value=!1,await u()}catch(l){console.error("Error adding university communication:",l)}};return(l,n)=>{const st=_t,et=ct;return m(),B(E,null,{default:e(()=>[t(O,null,{default:e(()=>[s("Application Details")]),_:1}),t(P,null,{default:e(()=>[t(X,{modelValue:S.value,"onUpdate:modelValue":n[4]||(n[4]=o=>S.value=o),"max-width":"500px"},{default:e(()=>[t(E,null,{default:e(()=>[t(O,null,{default:e(()=>[s("Change Current Status")]),_:1}),t(P,null,{default:e(()=>[t(Y,{onSubmit:K(r,["prevent"])},{default:e(()=>[t(st,{modelValue:L.value,"onUpdate:modelValue":n[0]||(n[0]=o=>L.value=o),items:Q.value,"item-title":o=>o.name,"item-value":o=>o.id,label:"Status",placeholder:"Select Status",rules:["requiredValidator"in l?l.requiredValidator:F(ut)]},null,8,["modelValue","items","item-title","item-value","rules"]),t(H,{class:"mt-2"},{default:e(()=>[s("Add any necessary file (Optional)")]),_:1}),t(ht,{modelValue:k.value,"onUpdate:modelValue":n[1]||(n[1]=o=>k.value=o),color:"primary",label:"File input",variant:"outlined",class:"mt-2"},null,8,["modelValue"]),t(H,{class:"mt-2"},{default:e(()=>[s("Comment (Optional)")]),_:1}),t(et,{modelValue:V.value,"onUpdate:modelValue":n[2]||(n[2]=o=>V.value=o),placeholder:"Place any comment regarding status"},null,8,["modelValue"])]),_:1})]),_:1}),t(J,null,{default:e(()=>[t(Z),t(C,{color:"primary",onClick:r},{default:e(()=>[s("Submit")]),_:1}),t(C,{onClick:n[3]||(n[3]=o=>S.value=!1)},{default:e(()=>[s("Cancel")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(X,{modelValue:v.value,"onUpdate:modelValue":n[7]||(n[7]=o=>v.value=o),"max-width":"500px"},{default:e(()=>[t(E,null,{default:e(()=>[t(O,null,{default:e(()=>[s("Add a New Comment")]),_:1}),t(P,null,{default:e(()=>[t(Y,{onSubmit:K(A,["prevent"])},{default:e(()=>[t(H,{class:"mt-2"},{default:e(()=>[s("New Comment")]),_:1}),t(et,{modelValue:V.value,"onUpdate:modelValue":n[5]||(n[5]=o=>V.value=o),placeholder:"Add a new comment",class:"mt-2"},null,8,["modelValue"])]),_:1})]),_:1}),t(J,null,{default:e(()=>[t(Z),t(C,{color:"primary",onClick:A},{default:e(()=>[s("Submit Comment")]),_:1}),t(C,{onClick:n[6]||(n[6]=o=>v.value=!1)},{default:e(()=>[s("Cancel")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(X,{modelValue:c.value,"onUpdate:modelValue":n[11]||(n[11]=o=>c.value=o),"max-width":"500px"},{default:e(()=>[t(E,null,{default:e(()=>[t(O,null,{default:e(()=>[s("Add a New University Communication")]),_:1}),t(P,null,{default:e(()=>[t(Y,{onSubmit:K(R,["prevent"])},{default:e(()=>[t(H,{class:"mt-2"},{default:e(()=>[s("Subject")]),_:1}),t(At,{modelValue:b.value.subject,"onUpdate:modelValue":n[8]||(n[8]=o=>b.value.subject=o),placeholder:"Subject",class:"mt-2"},null,8,["modelValue"]),t(H,{class:"mt-2"},{default:e(()=>[s("Message")]),_:1}),t(F(dt),{theme:"snow",content:b.value.message,"onUpdate:content":n[9]||(n[9]=o=>b.value.message=o),"content-type":"html",class:"mt-2"},null,8,["content"])]),_:1})]),_:1}),t(J,null,{default:e(()=>[t(Z),t(C,{color:"primary",onClick:R},{default:e(()=>[s("Submit Communication")]),_:1}),t(C,{onClick:n[10]||(n[10]=o=>c.value=!1)},{default:e(()=>[s("Cancel")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(kt,{modelValue:w.value,"onUpdate:modelValue":n[12]||(n[12]=o=>w.value=o)},{default:e(()=>[t(M,{value:"student-course-details"},{default:e(()=>[s("Student/Course Details")]),_:1}),t(M,{value:"upload-download"},{default:e(()=>[s("Upload/Download")]),_:1}),t(M,{value:"status"},{default:e(()=>[s("Status")]),_:1}),t(M,{value:"comments"},{default:e(()=>[s("Comments")]),_:1}),t(M,{value:"university-communication"},{default:e(()=>[s("University Communication")]),_:1}),t(M,{value:"activity-logs"},{default:e(()=>[s("Activity Logs")]),_:1})]),_:1},8,["modelValue"]),t(P,null,{default:e(()=>[t(Ut,{modelValue:w.value,"onUpdate:modelValue":n[16]||(n[16]=o=>w.value=o)},{default:e(()=>[t(j,{value:"student-course-details"},{default:e(()=>[t(W,null,{default:e(()=>[t(U,{cols:"12"},{default:e(()=>[t(lt,null,{default:e(()=>[a("tbody",null,[a("tr",null,[Mt,a("td",null,i(h.value.application_id),1),jt,a("td",null,i(h.value.created_at),1)]),a("tr",null,[Nt,a("td",null,i(g.value.student_id??""),1),Pt,a("td",null,i(g.value.passport_no),1)]),a("tr",null,[It,a("td",null,i(g.value.first_name)+" "+i(g.value.last_name),1),Ht,a("td",null,i(g.value.date_of_birth),1)]),a("tr",null,[Bt,a("td",null,i(g.value.email),1),Et,a("td",null,i(g.value.whatsapp_number),1)]),a("tr",null,[Ft,a("td",null,i(h.value.counsellor_email),1),zt,a("td",null,i(h.value.counsellor_number),1)])])]),_:1})]),_:1})]),_:1})]),_:1}),t(j,{value:"upload-download"},{default:e(()=>[t(Ct,{"existing-documents":q.value,"zip-link":g.value.document_zip_link},null,8,["existing-documents","zip-link"])]),_:1}),t(j,{value:"status"},{default:e(()=>[t(W,null,{default:e(()=>[t(U,{cols:"12",class:"d-flex justify-end"},{default:e(()=>[w.value==="status"&&l.$can("status","application")?(m(),B(C,{key:0,onClick:n[13]||(n[13]=o=>S.value=!0),color:"primary"},{default:e(()=>[s(" Change Current Status ")]),_:1})):N("",!0)]),_:1}),t(U,{cols:"12"},{default:e(()=>[t(lt,null,{default:e(()=>[qt,a("tbody",null,[(m(!0),f(D,null,G(I.value,(o,T)=>(m(),f("tr",{key:T},[a("td",null,i(o.created_at),1),a("td",null,i(o.comment),1),a("td",null,[a("div",null,[a("span",{innerHTML:o.status_text},null,8,Qt),T===0?(m(),f("span",Rt,"(Current Status)")):N("",!0),o.document?(m(),f("div",Ot,[a("div",null,i(o.file_name),1),a("a",{href:o.document,target:"_blank",class:"download-link"},"Document",8,Wt)])):N("",!0)])])]))),128))])]),_:1})]),_:1})]),_:1})]),_:1}),t(j,{value:"comments"},{default:e(()=>[t(W,null,{default:e(()=>[t(U,{cols:"12",class:"d-flex justify-end"},{default:e(()=>[l.$can("comment","application")?(m(),B(C,{key:0,onClick:n[14]||(n[14]=o=>v.value=!0),color:"primary"},{default:e(()=>[s("Add New Comment")]),_:1})):N("",!0)]),_:1}),t(U,{cols:"12"},{default:e(()=>[a("div",Kt,[(m(!0),f(D,null,G(x.value,(o,T)=>(m(),f("div",{key:T,class:"comment"},[a("div",Gt,[a("span",Jt,i(o.created_at),1)]),a("div",{class:"comment-body",innerHTML:o.comment_with_user},null,8,Xt)]))),128))])]),_:1})]),_:1})]),_:1}),t(j,{value:"university-communication"},{default:e(()=>[t(W,null,{default:e(()=>[t(U,{cols:"12",class:"d-flex justify-end"},{default:e(()=>[l.$can("university_communication","application")?(m(),B(C,{key:0,onClick:n[15]||(n[15]=o=>c.value=!0),color:"primary"},{default:e(()=>[s("Add New Communication")]),_:1})):N("",!0)]),_:1}),t(U,{cols:"12"},{default:e(()=>[a("div",Yt,[(m(!0),f(D,null,G(z.value,(o,T)=>(m(),f("div",{key:T,class:"comment"},[a("div",Zt,[a("span",te,i(o.created_at),1)]),a("div",ee,[ae,s(" "+i(o.subject),1)]),a("div",le,[a("div",{innerHTML:o.message},null,8,oe)])]))),128))])]),_:1})]),_:1})]),_:1}),t(j,{value:"activity-logs"},{default:e(()=>[t(Tt,{"application-id":F(_)},null,8,["application-id"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})}}},da=bt(ne,[["__scopeId","data-v-fc52c6af"]]);export{da as default};
