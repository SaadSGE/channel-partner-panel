import{r as ue}from"./validators-CzTvOQ7r.js";import{a6 as de,r as l,H as me,w as pe,o as u,c as ce,b as r,d as h,e as s,v as i,a7 as fe,n as F,a8 as P,f as m,z as p,a2 as U,F as ve}from"./main-D5McJ9Zv.js";import{_ as Ve}from"./TablePagination-BWZJrImI.js";import{_ as ge}from"./AppTextField-DgZofsLH.js";import{_ as ye}from"./AppSelect-uvpu5-01.js";import{_ as Ue}from"./AppAutocomplete-Bnpv6Vja.js";import{_ as _e}from"./Filters-xoY6uFqd.js";import{c as we}from"./commonFunction-CKbZ0Xmh.js";import{u as be}from"./rolePermission-D0bHF4mi.js";import{u as Se}from"./user-DmKX4wKa.js";import ke from"./AddNewUserDrawer-B1m4AiFG.js";import Ce from"./EditNewUserDrawer-crCHETp3.js";import{S as n}from"./sweetalert2-z6gKu1nJ.js";import{g as he}from"./helpers-C_zUu5UZ.js";import{V as z,b as M,c as Pe,a as $e}from"./VCard-Cgis6yXZ.js";import{V as T}from"./VCardText-ByrVCN3b.js";import{V as De}from"./VForm-CTPemAxI.js";import{V as H}from"./VSpacer-2uBqlsAT.js";import{V as Be}from"./VDialog-DlKcqVlB.js";import{V as xe}from"./VRow-D0QZu219.js";import{V as Q}from"./VDivider-Bg58jSdU.js";import{V as Ae}from"./VDataTableServer-B5AYWZYB.js";import{V as Ee}from"./VMenu-ovXTXsem.js";import{V as Fe,a as $,b as D}from"./VList-DY6ojEBA.js";import{V as Te}from"./VSwitch-CnMXKQaj.js";import"./VPagination-DrHkONnY.js";import"./VTextField-C6tY1X-k.js";import"./index-D8QWoZBU.js";import"./index-6ozB1_Sf.js";import"./forwardRefs-D3j0TLhE.js";import"./VSelect-ok_Yuo8W.js";import"./dialog-transition-B_BJ9JA7.js";import"./lazy-BGqaIAZx.js";import"./scopeId-cOAU0TpX.js";import"./VCheckboxBtn-CzZbLG_Q.js";import"./VAvatar-BewUqin6.js";import"./VImg-Bp_ZHGHr.js";import"./VChip-DaZnyOu_.js";import"./VSlideGroup-MxxTfIYi.js";import"./filter-fftxsn9K.js";import"./AppDateTimePicker-WVUhzLlx.js";import"./AppDrawerHeaderSection-W0ujFB1S.js";import"./auth-CTL6A-W7.js";import"./vue3-perfect-scrollbar.esm-CRpMxJlw.js";import"./VNavigationDrawer-eLhI8uu1.js";import"./ssrBoot-BFxq1bKX.js";import"./VFileInput-BmPD9Li0.js";import"./VCheckbox-CbqBEiPn.js";/* empty css              */import"./VDataTable-DqLWisIw.js";import"./VTable-M5UisAIY.js";const Re={class:"me-3 d-flex gap-3"},Ie={class:"app-user-search-filter d-flex align-center flex-wrap gap-4"},Le={style:{"inline-size":"15.625rem"}},It={__name:"index",setup(Ne){const Y=de(()=>"calc(100vh - 200px)"),d=Se(),R=be(),I=we(),B=l(!1),_=l([]),x=l(0),c=l(10),f=l(1),j=l(),G=l(),w=l(""),b=l(null),S=l(null);l(),l();const k=l(null),C=l(!1),J=l([]),A=l(!1),L=l(null),v=l(!1),V=l(null),N=l(null),O=l(he()==="admin"),E=l([]),K=e=>{N.value=e,V.value=e.parent_id||"",v.value=!0},q=async()=>{if(!V.value)return;const e=await d.setParent(N.value.id,V.value);e.success?(g(),n.fire("Success!",e.message,"success"),v.value=!1):n.fire("Error!",e.message,"error")},W=e=>{console.log(e);const t=_.value.findIndex(o=>o.id===e.id);t!==-1&&_.value.splice(t,1,e)},X=e=>{Z(e)},Z=e=>{L.value=e,A.value=!0},g=async()=>{C.value=!0;try{const e=await d.fetchUsers(f.value,w.value,b.value,S.value,k.value);_.value=e.data,x.value=e.total}catch(e){console.error("Error fetching users:",e)}finally{C.value=!1}},ee=async e=>{try{await g(),n.fire("Success!","User added successfully!","success")}catch(t){console.error("Error adding user:",t),n.fire("Error!","Failed to add user.","error")}},te=async e=>{if((await n.fire({title:"Are you sure?",text:"Do you want to delete this user?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel"})).isConfirmed){const o=await d.deleteUser(e);o.success?n.fire("Deleted!",o.message,"success"):n.fire("Error!",o.message,"error")}},ae=e=>{var t,o;j.value=(t=e.sortBy[0])==null?void 0:t.key,G.value=(o=e.sortBy[0])==null?void 0:o.order,g()},re=[{title:"Name",key:"full_name"},{title:"Company",key:"company_name_with_email"},{title:"Role",key:"role"},...O.value?[{title:"Parent",key:"parent.full_name"}]:[],{title:"Record Count",key:"record_count"},...O.value?[{title:"Status",key:"status",sortable:!1}]:[],{title:"Actions",key:"actions",sortable:!1}],se=async e=>{e.statusLoading=!0;try{(await d.updateUserStatus(e.id,e.status)).status?n.fire("Success!","User status updated successfully!","success"):(n.fire("Error!","Failed to update user status.","error"),e.status=e.status===1?0:1)}catch(t){console.error("Error updating user status:",t),n.fire("Error!","Failed to update user status.","error"),e.status=e.status===1?0:1}finally{e.statusLoading=!1}};me(async()=>{await R.getAllRoles(),J.value=R.roles,await d.fetchParentUsers(),g(),le()}),pe([w,b,S,k],()=>{g()});const le=async()=>{C.value=!0;try{await I.getBranches(),E.value=I.branches}catch(e){console.error("Error fetching branches:",e)}finally{C.value=!1}};return(e,t)=>{const o=Ue,oe=ye,ne=ge,ie=Ve;return u(),ce(ve,null,[r(Ce,{isDrawerOpen:A.value,editedUser:L.value,branches:E.value,"onUpdate:isDrawerOpen":t[0]||(t[0]=a=>A.value=a),onUserUpdated:W},null,8,["isDrawerOpen","editedUser","branches"]),h("section",null,[r(Be,{modelValue:v.value,"onUpdate:modelValue":t[3]||(t[3]=a=>v.value=a),"max-width":"500px"},{default:s(()=>[r(z,null,{default:s(()=>[r(M,null,{default:s(()=>[i("Set Parent")]),_:1}),r(T,null,{default:s(()=>[r(De,{onSubmit:fe(q,["prevent"])},{default:s(()=>[r(o,{modelValue:V.value,"onUpdate:modelValue":t[1]||(t[1]=a=>V.value=a),items:F(d).parentUsers,"item-title":a=>a.name_with_email,"item-value":a=>a.id,label:"Parent",placeholder:"Select Parent",rules:["requiredValidator"in e?e.requiredValidator:F(ue)]},null,8,["modelValue","items","item-title","item-value","rules"])]),_:1})]),_:1}),r(Pe,null,{default:s(()=>[r(H),r(P,{color:"primary",onClick:q},{default:s(()=>[i("Submit")]),_:1}),r(P,{onClick:t[2]||(t[2]=a=>v.value=!1)},{default:s(()=>[i("Cancel")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),r(z,{class:"mb-6"},{default:s(()=>[e.$can("filter","user")?(u(),m($e,{key:0,class:"pb-4"},{default:s(()=>[r(M,null,{default:s(()=>[i("Filter")]),_:1})]),_:1})):p("",!0),e.$can("filter","user")?(u(),m(T,{key:1},{default:s(()=>[r(xe,null,{default:s(()=>[r(_e,{"selected-role":b.value,onUpdateRole:t[4]||(t[4]=a=>b.value=a),"selected-parent":S.value,onUpdateParent:t[5]||(t[5]=a=>S.value=a),"selected-userStatus":k.value,onUpdateUserStatus:t[6]||(t[6]=a=>k.value=a)},null,8,["selected-role","selected-parent","selected-userStatus"])]),_:1})]),_:1})):p("",!0),r(Q),r(T,{class:"d-flex flex-wrap gap-4"},{default:s(()=>[h("div",Re,[r(oe,{"model-value":c.value,items:[{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:100},{value:-1,title:"All"}],style:{"inline-size":"6.25rem"},"onUpdate:modelValue":t[7]||(t[7]=a=>c.value=parseInt(a,10))},null,8,["model-value"])]),r(H),h("div",Ie,[h("div",Le,[r(ne,{modelValue:w.value,"onUpdate:modelValue":t[8]||(t[8]=a=>w.value=a),placeholder:"Search User"},null,8,["modelValue"])]),e.$can("create","user")?(u(),m(P,{key:0,"prepend-icon":"tabler-plus",onClick:t[9]||(t[9]=a=>B.value=!0)},{default:s(()=>[i(" Add New User ")]),_:1})):p("",!0)])]),_:1}),r(Q),r(Ae,{"items-per-page":c.value,"onUpdate:itemsPerPage":t[11]||(t[11]=a=>c.value=a),page:f.value,"onUpdate:page":t[12]||(t[12]=a=>f.value=a),items:_.value,"items-length":x.value,headers:re,class:"text-no-wrap","show-select":"",height:F(Y),"onUpdate:options":ae},{"item.actions":s(({item:a})=>[r(P,{icon:"",variant:"text",color:"medium-emphasis"},{default:s(()=>[r(U,{icon:"tabler-dots-vertical"}),r(Ee,{activator:"parent"},{default:s(()=>[r(Fe,null,{default:s(()=>[r($,{to:{name:"user-view-id",params:{id:a.id}}},{prepend:s(()=>[r(U,{icon:"tabler-eye"})]),default:s(()=>[r(D,null,{default:s(()=>[i("View")]),_:1})]),_:2},1032,["to"]),e.$can("edit","user")?(u(),m($,{key:0,onClick:y=>X(a)},{prepend:s(()=>[r(U,{icon:"tabler-pencil"})]),default:s(()=>[r(D,null,{default:s(()=>[i("Edit")]),_:1})]),_:2},1032,["onClick"])):p("",!0),e.$can("edit","user")?(u(),m($,{key:1,onClick:y=>K(a)},{prepend:s(()=>[r(U,{icon:"tabler-pencil"})]),default:s(()=>[r(D,null,{default:s(()=>[i("Set Parent")]),_:1})]),_:2},1032,["onClick"])):p("",!0),e.$can("delete","user")?(u(),m($,{key:2,onClick:y=>te(a.id)},{prepend:s(()=>[r(U,{icon:"tabler-trash"})]),default:s(()=>[r(D,null,{default:s(()=>[i("Delete")]),_:1})]),_:2},1032,["onClick"])):p("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),"item.status":s(({item:a})=>[r(Te,{modelValue:a.status,"onUpdate:modelValue":y=>a.status=y,"true-value":1,"false-value":0,onChange:y=>se(a),loading:a.statusLoading},null,8,["modelValue","onUpdate:modelValue","onChange","loading"])]),bottom:s(()=>[r(ie,{page:f.value,"onUpdate:page":t[10]||(t[10]=a=>f.value=a),"items-per-page":c.value,"total-items":x.value},null,8,["page","items-per-page","total-items"])]),_:1},8,["items-per-page","page","items","items-length","height"])]),_:1}),r(ke,{isDrawerOpen:B.value,"onUpdate:isDrawerOpen":t[13]||(t[13]=a=>B.value=a),branches:E.value,onUserData:ee},null,8,["isDrawerOpen","branches"])])],64)}}};export{It as default};
