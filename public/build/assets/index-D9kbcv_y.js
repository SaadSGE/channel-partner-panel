import{r as me}from"./validators-D02V_TYF.js";import{a6 as pe,r as l,H as ce,w as fe,o as i,c as ve,b as s,d as $,e as r,v as u,a8 as Ve,n as R,a9 as D,f as m,z as p,a2 as U,F as ge}from"./main-Chpg_S2F.js";import{_ as ye}from"./TablePagination-BE99l0S9.js";import{_ as Ue}from"./AppTextField-9nxRsrZx.js";import{_ as we}from"./AppSelect-CeYlt37K.js";import{_ as _e}from"./AppAutocomplete-yqpjlxUf.js";import{_ as be}from"./Filters-D7I3mZgk.js";import{c as Se}from"./commonFunction-BJISIr2J.js";import{u as Ce}from"./rolePermission-BxH-cnDF.js";import{u as ke}from"./user-CqboCg9I.js";import he from"./AddNewUserDrawer-BuZIicsN.js";import Pe from"./EditNewUserDrawer-DzdQXyLJ.js";import{S as n}from"./sweetalert2-z6gKu1nJ.js";import{g as $e}from"./helpers-FtjfYHxl.js";import{V as H,b as Q,c as De,a as Be}from"./VCard-BOFUYVjh.js";import{V as I}from"./VCardText-Io1XnNxC.js";import{V as xe}from"./VForm-BJ7hVFMt.js";import{V as Y}from"./VSpacer-CkTRFcGW.js";import{V as Ae}from"./VDialog-4E_d2k8T.js";import{V as Ee}from"./VRow-lZn-sppq.js";import{V as j}from"./VDivider-B2cQESyw.js";import{V as Fe}from"./VDataTableServer-vhucdR_y.js";import{V as Te}from"./VMenu-CLf3Moh0.js";import{V as Re,a as B,b as x}from"./VList-DHEQ2-yk.js";import{V as Ie}from"./VSwitch-BxKsp1fo.js";import"./VPagination-Dl-WNAXM.js";import"./VInput-DD7K0I3z.js";import"./index-zlu4swji.js";import"./index-C4-GU5od.js";import"./forwardRefs-D3j0TLhE.js";import"./VTextField-TFJRZd5d.js";import"./VSelect-BXjkeAaU.js";import"./dialog-transition-BhHG9wUE.js";import"./scopeId-Bs5Lp4Sg.js";import"./VCheckboxBtn-BzQ2N5Gd.js";import"./VAvatar-BibMrmet.js";import"./VImg-DMIafN81.js";import"./VChip-m1kqjwJD.js";import"./filter-C7BqSIMx.js";import"./AppDateTimePicker-gLl6XTMx.js";import"./AppDrawerHeaderSection-BDt6-jwn.js";import"./auth-DW6E8CVA.js";import"./vue3-perfect-scrollbar.esm-D3TtikBR.js";import"./VNavigationDrawer-BVqQmUVu.js";import"./ssrBoot-CwN-h_rL.js";import"./VFileInput-CUDYCzO8.js";import"./VCheckbox-BBbqYwvB.js";/* empty css              */import"./VDataTable-B2xSjSlB.js";import"./VTable-D5M_yX-K.js";const Le={class:"me-3 d-flex gap-3"},Ne={class:"app-user-search-filter d-flex align-center flex-wrap gap-4"},Oe={style:{"inline-size":"15.625rem"}},Lt={__name:"index",setup(Me){const G=pe(()=>"calc(100vh - 200px)"),d=ke(),L=Ce(),N=Se(),A=l(!1),w=l([]),E=l(0),c=l(10),f=l(1),J=l(),K=l(),_=l(""),b=l(null),S=l(null),C=l(null),k=l(null);l(),l();const h=l(null),P=l(!1),W=l([]),F=l(!1),O=l(null),v=l(!1),V=l(null),M=l(null),q=l($e()==="admin"),T=l([]),X=e=>{M.value=e,V.value=e.parent_id||"",v.value=!0},z=async()=>{if(!V.value)return;const e=await d.setParent(M.value.id,V.value);e.success?(g(),n.fire("Success!",e.message,"success"),v.value=!1):n.fire("Error!",e.message,"error")},Z=e=>{console.log(e);const t=w.value.findIndex(o=>o.id===e.id);t!==-1&&w.value.splice(t,1,e)},ee=e=>{te(e)},te=e=>{O.value=e,F.value=!0},g=async()=>{P.value=!0;try{const e=await d.fetchUsers(f.value,_.value,b.value,S.value,h.value,C.value,k.value);w.value=e.data,E.value=e.total}catch(e){console.error("Error fetching users:",e)}finally{P.value=!1}},ae=async e=>{try{await g(),n.fire("Success!","User added successfully!","success")}catch(t){console.error("Error adding user:",t),n.fire("Error!","Failed to add user.","error")}},se=async e=>{if((await n.fire({title:"Are you sure?",text:"Do you want to delete this user?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel"})).isConfirmed){const o=await d.deleteUser(e);o.success?n.fire("Deleted!",o.message,"success"):n.fire("Error!",o.message,"error")}},re=e=>{var t,o;J.value=(t=e.sortBy[0])==null?void 0:t.key,K.value=(o=e.sortBy[0])==null?void 0:o.order,g()},le=[{title:"Name",key:"full_name"},{title:"Company",key:"company_name_with_email"},{title:"Role",key:"role"},...q.value?[{title:"Parent",key:"parent.full_name"}]:[],{title:"Record Count",key:"record_count"},...q.value?[{title:"Status",key:"status",sortable:!1}]:[],{title:"Actions",key:"actions",sortable:!1}],oe=async e=>{e.statusLoading=!0;try{(await d.updateUserStatus(e.id,e.status)).status?n.fire("Success!","User status updated successfully!","success"):(n.fire("Error!","Failed to update user status.","error"),e.status=e.status===1?0:1)}catch(t){console.error("Error updating user status:",t),n.fire("Error!","Failed to update user status.","error"),e.status=e.status===1?0:1}finally{e.statusLoading=!1}};ce(async()=>{await L.getAllRoles(),W.value=L.roles,await d.fetchParentUsers(),g(),ne()}),fe([_,b,S,h,C,k],()=>{g()});const ne=async()=>{P.value=!0;try{await N.getBranches(),T.value=N.branches}catch(e){console.error("Error fetching branches:",e)}finally{P.value=!1}};return(e,t)=>{const o=_e,ue=we,ie=Ue,de=ye;return i(),ve(ge,null,[s(Pe,{isDrawerOpen:F.value,editedUser:O.value,branches:T.value,"onUpdate:isDrawerOpen":t[0]||(t[0]=a=>F.value=a),onUserUpdated:Z},null,8,["isDrawerOpen","editedUser","branches"]),$("section",null,[s(Ae,{modelValue:v.value,"onUpdate:modelValue":t[3]||(t[3]=a=>v.value=a),"max-width":"500px"},{default:r(()=>[s(H,null,{default:r(()=>[s(Q,null,{default:r(()=>[u("Set Parent")]),_:1}),s(I,null,{default:r(()=>[s(xe,{onSubmit:Ve(z,["prevent"])},{default:r(()=>[s(o,{modelValue:V.value,"onUpdate:modelValue":t[1]||(t[1]=a=>V.value=a),items:R(d).parentUsers,"item-title":a=>a.name_with_email,"item-value":a=>a.id,label:"Parent",placeholder:"Select Parent",rules:["requiredValidator"in e?e.requiredValidator:R(me)]},null,8,["modelValue","items","item-title","item-value","rules"])]),_:1})]),_:1}),s(De,null,{default:r(()=>[s(Y),s(D,{color:"primary",onClick:z},{default:r(()=>[u("Submit")]),_:1}),s(D,{onClick:t[2]||(t[2]=a=>v.value=!1)},{default:r(()=>[u("Cancel")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(H,{class:"mb-6"},{default:r(()=>[e.$can("filter","user")?(i(),m(Be,{key:0,class:"pb-4"},{default:r(()=>[s(Q,null,{default:r(()=>[u("Filter")]),_:1})]),_:1})):p("",!0),e.$can("filter","user")?(i(),m(I,{key:1},{default:r(()=>[s(Ee,null,{default:r(()=>[s(be,{"selected-role":b.value,onUpdateRole:t[4]||(t[4]=a=>b.value=a),"selected-parent":S.value,onUpdateParent:t[5]||(t[5]=a=>S.value=a),"selected-userStatus":h.value,onUpdateUserStatus:t[6]||(t[6]=a=>h.value=a),"selected-country":C.value,onUpdateCountry:t[7]||(t[7]=a=>C.value=a),"selected-mou":k.value,onUpdateMou:t[8]||(t[8]=a=>k.value=a)},null,8,["selected-role","selected-parent","selected-userStatus","selected-country","selected-mou"])]),_:1})]),_:1})):p("",!0),s(j),s(I,{class:"d-flex flex-wrap gap-4"},{default:r(()=>[$("div",Le,[s(ue,{"model-value":c.value,items:[{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:100},{value:-1,title:"All"}],style:{"inline-size":"6.25rem"},"onUpdate:modelValue":t[9]||(t[9]=a=>c.value=parseInt(a,10))},null,8,["model-value"])]),s(Y),$("div",Ne,[$("div",Oe,[s(ie,{modelValue:_.value,"onUpdate:modelValue":t[10]||(t[10]=a=>_.value=a),placeholder:"Search User"},null,8,["modelValue"])]),e.$can("create","user")?(i(),m(D,{key:0,"prepend-icon":"tabler-plus",onClick:t[11]||(t[11]=a=>A.value=!0)},{default:r(()=>[u(" Add New User ")]),_:1})):p("",!0)])]),_:1}),s(j),s(Fe,{"items-per-page":c.value,"onUpdate:itemsPerPage":t[13]||(t[13]=a=>c.value=a),page:f.value,"onUpdate:page":t[14]||(t[14]=a=>f.value=a),items:w.value,"items-length":E.value,headers:le,class:"text-no-wrap","show-select":"",height:R(G),"onUpdate:options":re},{"item.actions":r(({item:a})=>[s(D,{icon:"",variant:"text",color:"medium-emphasis"},{default:r(()=>[s(U,{icon:"tabler-dots-vertical"}),s(Te,{activator:"parent"},{default:r(()=>[s(Re,null,{default:r(()=>[s(B,{to:{name:"user-view-id",params:{id:a.id}}},{prepend:r(()=>[s(U,{icon:"tabler-eye"})]),default:r(()=>[s(x,null,{default:r(()=>[u("View")]),_:1})]),_:2},1032,["to"]),e.$can("edit","user")?(i(),m(B,{key:0,onClick:y=>ee(a)},{prepend:r(()=>[s(U,{icon:"tabler-pencil"})]),default:r(()=>[s(x,null,{default:r(()=>[u("Edit")]),_:1})]),_:2},1032,["onClick"])):p("",!0),e.$can("edit","user")?(i(),m(B,{key:1,onClick:y=>X(a)},{prepend:r(()=>[s(U,{icon:"tabler-pencil"})]),default:r(()=>[s(x,null,{default:r(()=>[u("Set Parent")]),_:1})]),_:2},1032,["onClick"])):p("",!0),e.$can("delete","user")?(i(),m(B,{key:2,onClick:y=>se(a.id)},{prepend:r(()=>[s(U,{icon:"tabler-trash"})]),default:r(()=>[s(x,null,{default:r(()=>[u("Delete")]),_:1})]),_:2},1032,["onClick"])):p("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),"item.status":r(({item:a})=>[s(Ie,{modelValue:a.status,"onUpdate:modelValue":y=>a.status=y,"true-value":1,"false-value":0,onChange:y=>oe(a),loading:a.statusLoading},null,8,["modelValue","onUpdate:modelValue","onChange","loading"])]),bottom:r(()=>[s(de,{page:f.value,"onUpdate:page":t[12]||(t[12]=a=>f.value=a),"items-per-page":c.value,"total-items":E.value},null,8,["page","items-per-page","total-items"])]),_:1},8,["items-per-page","page","items","items-length","height"])]),_:1}),s(he,{isDrawerOpen:A.value,"onUpdate:isDrawerOpen":t[15]||(t[15]=a=>A.value=a),branches:T.value,onUserData:ae},null,8,["isDrawerOpen","branches"])])],64)}}};export{Lt as default};
