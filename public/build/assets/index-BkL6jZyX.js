import{r as ue}from"./validators-DuJVVkWA.js";import{a6 as ie,r,H as de,w as me,o as i,c as pe,b as s,d as P,e as l,v as u,a8 as ce,n as F,a9 as h,f as d,z as m,a2 as g,F as fe}from"./main-BvFQxvBT.js";import{_ as ve}from"./TablePagination-DQb9J8IM.js";import{_ as Ve}from"./AppTextField-DMqdYcKP.js";import{_ as Ue}from"./AppSelect-D5GmplFU.js";import{_ as ge}from"./AppAutocomplete-B4XpmGJY.js";import{_ as ye}from"./Filters-9ZiEiMl9.js";import{c as we}from"./commonFunction-CPAn8OOM.js";import{u as _e}from"./rolePermission-jm7GwEP3.js";import{u as be}from"./user-CDBmVU8h.js";import Ce from"./AddNewUserDrawer-CF1RJ0qw.js";import Se from"./EditNewUserDrawer-Dpq6jDS_.js";import{S as n}from"./sweetalert2-z6gKu1nJ.js";import{g as ke}from"./helpers-Dq4Czwmk.js";import{V as z,b as H,c as $e,a as De}from"./VCard-B7qhezZk.js";import{V as I}from"./VCardText-DWakh8Y2.js";import{V as Pe}from"./VForm-DDmIgmTN.js";import{V as Q}from"./VSpacer-B1pH7dQy.js";import{V as he}from"./VDialog-CinZxSIx.js";import{V as Be}from"./VRow-C_WBmDjV.js";import{V as Y}from"./VDivider-CjM7G8NO.js";import{V as xe}from"./VDataTableServer-Aan1_F8y.js";import{V as Ee}from"./VMenu-CtZ79DNW.js";import{V as Ae,a as B,b as x}from"./VList-xrzE1bpy.js";import{V as Te}from"./VSwitch-M3yct503.js";import"./VPagination-DRg9HUIM.js";import"./VInput-DyyFC-H6.js";import"./index-Dgw-CaPr.js";import"./index-7dKs4xIn.js";import"./forwardRefs-D3j0TLhE.js";import"./VTextField-CzYs9nDg.js";import"./VSelect-uA5monyM.js";import"./dialog-transition-FkgYEYy3.js";import"./scopeId-dB-Pi8uf.js";import"./VCheckboxBtn-Dd8JOE0x.js";import"./VAvatar-WzIA0iyC.js";import"./VImg-BMf7BfAR.js";import"./VChip-Bb7ACT6s.js";import"./filter-Dlys4yA2.js";import"./AppDateTimePicker-kqoNRpJg.js";import"./AppDrawerHeaderSection-Bi01qt98.js";import"./auth-YaCOxSjm.js";import"./vue3-perfect-scrollbar.esm-BjWebDhB.js";import"./VNavigationDrawer-DJK3zTMM.js";import"./ssrBoot-HqMp4Sv1.js";import"./VFileInput-BTIGsDXT.js";import"./VCheckbox-PoJfsPjl.js";/* empty css              */import"./VDataTable-D9XxyXoR.js";import"./VTable-CDCqoSRN.js";const Fe={class:"me-3 d-flex gap-3"},Ie={class:"app-user-search-filter d-flex align-center flex-wrap gap-4"},Le={style:{"inline-size":"15.625rem"}},Ft={__name:"index",setup(Ne){const j=ie(()=>"calc(100vh - 200px)"),p=be();_e(),we();const E=r(!1),y=r([]),A=r(0),c=r(10),f=r(1),G=r(),J=r(),w=r(""),_=r(null),b=r(null),C=r(null),S=r(null);r(),r();const k=r(null),L=r(!1);r([]);const T=r(!1),N=r(null),v=r(!1),V=r(null),O=r(null),R=r(ke()==="admin"),M=r([]),$=r(null),K=a=>{O.value=a,V.value=a.parent_id||"",v.value=!0},q=async()=>{if(!V.value)return;const a=await p.setParent(O.value.id,V.value);a.success?(D(),n.fire("Success!",a.message,"success"),v.value=!1):n.fire("Error!",a.message,"error")},W=a=>{const e=y.value.findIndex(o=>o.id===a.id);e!==-1&&y.value.splice(e,1,a)},X=a=>{Z(a)},Z=a=>{N.value=a,T.value=!0},D=async()=>{L.value=!0;try{const a=await p.fetchUsers(f.value,w.value,_.value,b.value,k.value,C.value,S.value,$.value);y.value=a.data,A.value=a.total}catch(a){console.error("Error fetching users:",a)}finally{L.value=!1}},ee=async a=>{try{await D(),n.fire("Success!","User added successfully!","success")}catch(e){console.error("Error adding user:",e),n.fire("Error!","Failed to add user.","error")}},te=async a=>{if((await n.fire({title:"Are you sure?",text:"Do you want to delete this user?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel"})).isConfirmed){const o=await p.deleteUser(a);o.success?n.fire("Deleted!",o.message,"success"):n.fire("Error!",o.message,"error")}},ae=a=>{var e,o;G.value=(e=a.sortBy[0])==null?void 0:e.key,J.value=(o=a.sortBy[0])==null?void 0:o.order,D()},se=[{title:"Name",key:"full_name"},{title:"Company",key:"company_name_with_email"},{title:"Role",key:"role"},...R.value?[{title:"Parent",key:"parent.full_name"}]:[],{title:"Record Count",key:"record_count"},...R.value?[{title:"Status",key:"status",sortable:!1}]:[],{title:"Actions",key:"actions",sortable:!1}],le=async a=>{a.statusLoading=!0;try{(await p.updateUserStatus(a.id,a.status)).status?n.fire("Success!","User status updated successfully!","success"):(n.fire("Error!","Failed to update user status.","error"),a.status=a.status===1?0:1)}catch(e){console.error("Error updating user status:",e),n.fire("Error!","Failed to update user status.","error"),a.status=a.status===1?0:1}finally{a.statusLoading=!1}};return de(async()=>{}),me([w,_,b,k,C,S,$],()=>{D()}),(a,e)=>{const o=ge,re=Ue,oe=Ve,ne=ve;return i(),pe(fe,null,[s(Se,{isDrawerOpen:T.value,editedUser:N.value,branches:M.value,"onUpdate:isDrawerOpen":e[0]||(e[0]=t=>T.value=t),onUserUpdated:W},null,8,["isDrawerOpen","editedUser","branches"]),P("section",null,[s(he,{modelValue:v.value,"onUpdate:modelValue":e[3]||(e[3]=t=>v.value=t),"max-width":"500px"},{default:l(()=>[s(z,null,{default:l(()=>[s(H,null,{default:l(()=>[u("Set Parent")]),_:1}),s(I,null,{default:l(()=>[s(Pe,{onSubmit:ce(q,["prevent"])},{default:l(()=>[s(o,{modelValue:V.value,"onUpdate:modelValue":e[1]||(e[1]=t=>V.value=t),items:F(p).parentUsers,"item-title":t=>t.name_with_email,"item-value":t=>t.id,label:"Parent",placeholder:"Select Parent",rules:["requiredValidator"in a?a.requiredValidator:F(ue)]},null,8,["modelValue","items","item-title","item-value","rules"])]),_:1})]),_:1}),s($e,null,{default:l(()=>[s(Q),s(h,{color:"primary",onClick:q},{default:l(()=>[u("Submit")]),_:1}),s(h,{onClick:e[2]||(e[2]=t=>v.value=!1)},{default:l(()=>[u("Cancel")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(z,{class:"mb-6"},{default:l(()=>[a.$can("filter","user")?(i(),d(De,{key:0,class:"pb-4"},{default:l(()=>[s(H,null,{default:l(()=>[u("Filter")]),_:1})]),_:1})):m("",!0),a.$can("filter","user")?(i(),d(I,{key:1},{default:l(()=>[s(Be,null,{default:l(()=>[s(ye,{"selected-role":_.value,onUpdateRole:e[4]||(e[4]=t=>_.value=t),"selected-parent":b.value,onUpdateParent:e[5]||(e[5]=t=>b.value=t),"selected-userStatus":k.value,onUpdateUserStatus:e[6]||(e[6]=t=>k.value=t),"selected-country":C.value,onUpdateCountry:e[7]||(e[7]=t=>C.value=t),"selected-mou":S.value,onUpdateMou:e[8]||(e[8]=t=>S.value=t),"selected-branch":$.value,onUpdateBranch:e[9]||(e[9]=t=>$.value=t)},null,8,["selected-role","selected-parent","selected-userStatus","selected-country","selected-mou","selected-branch"])]),_:1})]),_:1})):m("",!0),s(Y),s(I,{class:"d-flex flex-wrap gap-4"},{default:l(()=>[P("div",Fe,[s(re,{"model-value":c.value,items:[{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:100},{value:-1,title:"All"}],style:{"inline-size":"6.25rem"},"onUpdate:modelValue":e[10]||(e[10]=t=>c.value=parseInt(t,10))},null,8,["model-value"])]),s(Q),P("div",Ie,[P("div",Le,[s(oe,{modelValue:w.value,"onUpdate:modelValue":e[11]||(e[11]=t=>w.value=t),placeholder:"Search User"},null,8,["modelValue"])]),a.$can("create","user")?(i(),d(h,{key:0,"prepend-icon":"tabler-plus",onClick:e[12]||(e[12]=t=>E.value=!0)},{default:l(()=>[u(" Add New User ")]),_:1})):m("",!0)])]),_:1}),s(Y),s(xe,{"items-per-page":c.value,"onUpdate:itemsPerPage":e[14]||(e[14]=t=>c.value=t),page:f.value,"onUpdate:page":e[15]||(e[15]=t=>f.value=t),items:y.value,"items-length":A.value,headers:se,class:"text-no-wrap","show-select":"",height:F(j),"onUpdate:options":ae},{"item.actions":l(({item:t})=>[s(h,{icon:"",variant:"text",color:"medium-emphasis"},{default:l(()=>[s(g,{icon:"tabler-dots-vertical"}),s(Ee,{activator:"parent"},{default:l(()=>[s(Ae,null,{default:l(()=>[s(B,{to:{name:"user-view-id",params:{id:t.id}}},{prepend:l(()=>[s(g,{icon:"tabler-eye"})]),default:l(()=>[s(x,null,{default:l(()=>[u("View")]),_:1})]),_:2},1032,["to"]),a.$can("edit","user")?(i(),d(B,{key:0,onClick:U=>X(t)},{prepend:l(()=>[s(g,{icon:"tabler-pencil"})]),default:l(()=>[s(x,null,{default:l(()=>[u("Edit")]),_:1})]),_:2},1032,["onClick"])):m("",!0),a.$can("edit","user")?(i(),d(B,{key:1,onClick:U=>K(t)},{prepend:l(()=>[s(g,{icon:"tabler-pencil"})]),default:l(()=>[s(x,null,{default:l(()=>[u("Set Parent")]),_:1})]),_:2},1032,["onClick"])):m("",!0),a.$can("delete","user")?(i(),d(B,{key:2,onClick:U=>te(t.id)},{prepend:l(()=>[s(g,{icon:"tabler-trash"})]),default:l(()=>[s(x,null,{default:l(()=>[u("Delete")]),_:1})]),_:2},1032,["onClick"])):m("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),"item.status":l(({item:t})=>[s(Te,{modelValue:t.status,"onUpdate:modelValue":U=>t.status=U,"true-value":1,"false-value":0,onChange:U=>le(t),loading:t.statusLoading},null,8,["modelValue","onUpdate:modelValue","onChange","loading"])]),bottom:l(()=>[s(ne,{page:f.value,"onUpdate:page":e[13]||(e[13]=t=>f.value=t),"items-per-page":c.value,"total-items":A.value},null,8,["page","items-per-page","total-items"])]),_:1},8,["items-per-page","page","items","items-length","height"])]),_:1}),s(Ce,{isDrawerOpen:E.value,"onUpdate:isDrawerOpen":e[16]||(e[16]=t=>E.value=t),branches:M.value,onUserData:ee},null,8,["isDrawerOpen","branches"])])],64)}}};export{Ft as default};
