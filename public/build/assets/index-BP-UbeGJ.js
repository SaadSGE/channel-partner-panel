import{an as J,r as h,ad as A,a5 as C,w as K,a as F,o as _,f as U,e as l,b as e,d as s,a7 as N,v as M,c as V,z as O,F as z,i as P,y as I,a1 as E,x as g,n as B,a3 as Q,a6 as W,K as X,L as Y}from"./main-15KFjogE.js";import{$ as T}from"./api-DHc9yKBN.js";import{_ as Z}from"./TiptapEditor-Co7cOy7X.js";import{_ as ee}from"./AppAutocomplete-CuFOMo1G.js";import{u as te}from"./user-CrrB2Ujh.js";import{a as se,V as L}from"./VCard-DXrPaF3o.js";import{V as j}from"./VSpacer-BZQs6UQ2.js";import{V as $}from"./VDivider-BfmRFN5b.js";import{V as R}from"./VTextField-Da2ikpu6.js";import{P as q}from"./vue3-perfect-scrollbar.esm-Df095_Ib.js";import{V as ae}from"./VAvatar-BZxRRe_G.js";import{V as oe}from"./VImg-Bh6gilOl.js";import{V as le}from"./VCardText-BUII6ExO.js";import{V as G}from"./VNavigationDrawer-Ce8SZSue.js";import{u as ie,a as ne,V as re}from"./VMain-D-TQAgdh.js";import{V as ce}from"./VCheckbox-vDHzbQIJ.js";import"./index-B3bPRkoL.js";import"./index-Cgp74jC8.js";import"./index-CbMV2pY-.js";import"./form-B5069VtK.js";import"./VSelect-B_TqZZGB.js";import"./forwardRefs-C-GTDzx5.js";import"./VList-CAFdzFUq.js";import"./index-CqLoS_Tw.js";import"./ssrBoot-CtNasRGc.js";import"./index-BywMyx-L.js";import"./dialog-transition-BVTDiMXd.js";import"./easing-CjukEv2V.js";import"./VMenu-5qCR1DEp.js";import"./VOverlay-8IfTc10N.js";import"./lazy-Hc4MIGTj.js";import"./scopeId-CAtradTb.js";import"./VCheckboxBtn-P-Uk0ZBF.js";import"./VSelectionControl-jWafKC1v.js";import"./VChip-Cbn8Fd09.js";import"./VSlideGroup-D1VcRc8T.js";import"./filter-Dp01fkun.js";import"./helpers-BlCShVO3.js";/* empty css              *//* empty css                   */import"./VCounter-WCzF8qc_.js";import"./VField-BnlfoiQt.js";import"./VInput-DdRggOY-.js";const H=J({id:"email",state:()=>({receivedEmails:[],sentEmails:[]}),actions:{async fetchReceivedEmails(){try{const c=await T("/emails/received",{method:"GET",headers:{"Content-Type":"application/json"}});this.receivedEmails=c.data}catch(c){console.error("Error fetching received emails:",c)}},async fetchSentEmails(){try{const c=await T("/emails/sent",{method:"GET",headers:{"Content-Type":"application/json"}});this.sentEmails=c.data}catch(c){console.error("Error fetching sent emails:",c)}},async sendEmail({recipients:c,subject:f,body:a}){console.log(c),console.log(f),console.log(a);try{const i=await T("/emails/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({recipients:c,subject:f,body:a})});return this.sentEmails.unshift(i.data),{success:!0,message:"Email sent successfully!"}}catch(i){return console.error("Error sending email:",i),this.errors=i.response?i.response.data.errors:["An unexpected error occurred"],{success:!1,message:"Failed to send email."}}}}}),me={class:"d-flex align-center"},de=s("h5",{class:"text-h5"},"Compose Mail",-1),pe={class:"d-flex align-center gap-x-2"},ue={class:"px-1 pe-6 py-1"},ve=s("div",{class:"text-base font-weight-medium text-disabled"}," To: ",-1),fe={class:"px-1 pe-6 py-1"},_e=s("div",{class:"text-base font-weight-medium text-disabled"},"Subject:",-1),he={class:"d-flex align-center px-6 py-4"},ge={__name:"ComposeDialog",emits:["close"],async setup(c,{emit:f}){let a,i;const u=f,d=h(""),o=h([]),v=h(""),m=h(""),b=te(),x=H();[a,i]=A(()=>b.fetcAllhUser()),await a,i();const k=C(()=>b.allUsers),w=()=>{o.value=[],v.value="",m.value="",d.value=""};K(o,r=>{});const S=async()=>{const t={recipients:o.value,subject:v.value,body:d.value},y=await x.sendEmail(t);y.success?(w(),u("close")):console.error(y.message)};return(r,t)=>{const y=F("IconBtn"),n=ee,D=Z;return _(),U(L,{class:"email-compose-dialog",elevation:"10","max-width":"30vw"},{default:l(()=>[e(se,{class:"py-3 px-6"},{default:l(()=>[s("div",me,[de,e(j),s("div",pe,[e(y,{size:"small",icon:"tabler-minus",onClick:t[0]||(t[0]=p=>r.$emit("close"))}),e(y,{size:"small",icon:"tabler-x",onClick:t[1]||(t[1]=p=>{r.$emit("close"),w()})})])])]),_:1}),s("div",ue,[e(n,{modelValue:o.value,"onUpdate:modelValue":t[2]||(t[2]=p=>o.value=p),items:k.value,"item-title":p=>p.name_with_email,"item-value":p=>p.id,multiple:"",chips:"","closable-chips":""},{"prepend-inner":l(()=>[ve]),_:1},8,["modelValue","items","item-title","item-value"])]),e($),s("div",fe,[e(R,{modelValue:v.value,"onUpdate:modelValue":t[3]||(t[3]=p=>v.value=p),density:"compact"},{"prepend-inner":l(()=>[_e]),_:1},8,["modelValue"])]),e($),e(D,{modelValue:d.value,"onUpdate:modelValue":t[4]||(t[4]=p=>d.value=p),placeholder:"Message"},null,8,["modelValue"]),e($),s("div",he,[e(N,{color:"primary",class:"me-4","append-icon":"tabler-send",onClick:t[5]||(t[5]=p=>S())},{default:l(()=>[M(" Send ")]),_:1})])]),_:1})}}},xe={class:"d-flex flex-column h-100"},ye={key:0,class:"px-6 pb-5 pt-6"},Ve={class:"email-filters py-4"},be=["onClick"],$e={class:"text-base"},we={__name:"EmailLeftSidebarContent",emits:["toggleComposeDialogVisibility","changeFolder"],setup(c,{emit:f}){const a=f,i=h("inbox"),u=[{title:"Inbox",prependIcon:"tabler-mail",filter:"inbox"},{title:"Sent",prependIcon:"tabler-send",filter:"sent"}],d=o=>{i.value=o,a("changeFolder",o)};return(o,v)=>(_(),V("div",xe,[o.$can("create","email")?(_(),V("div",ye,[e(N,{block:"",onClick:v[0]||(v[0]=m=>o.$emit("toggleComposeDialogVisibility"))},{default:l(()=>[M(" Compose ")]),_:1})])):O("",!0),s("ul",Ve,[(_(),V(z,null,P(u,m=>s("li",{key:m.title,class:I(["d-flex align-center cursor-pointer",{"email-filter-active text-primary":i.value===m.filter}]),onClick:b=>d(m.filter)},[e(E,{icon:m.prependIcon,class:"me-2",size:"20"},null,8,["icon"]),s("div",$e,g(m.title),1)],10,be)),64))])]))}},Ce={class:"email-view-header d-flex align-center px-5 py-3"},Ee={class:"d-flex align-center flex-wrap flex-grow-1 overflow-hidden gap-2"},ke={class:"text-body-1 text-high-emphasis text-truncate"},Se={class:"d-flex align-start align-sm-center pa-6 gap-x-4"},De={class:"d-flex flex-wrap flex-grow-1 overflow-hidden"},Te={class:"text-truncate"},Ie={class:"text-body-1 text-high-emphasis text-truncate"},Be={class:"text-sm"},Fe={class:"text-disabled text-base"},Ue=["innerHTML"],ze={__name:"EmailView",props:{email:{type:Object,required:!0}},emits:["close"],setup(c,{emit:f}){const a=c;return(i,u)=>{const d=F("IconBtn");return _(),U(G,{temporary:"","model-value":!!a.email,location:"right",scrim:!1,floating:"",class:"email-view"},{default:l(()=>[a.email?(_(),V(z,{key:0},[s("div",Ce,[e(d,{class:"me-2",onClick:u[0]||(u[0]=o=>i.$emit("close"))},{default:l(()=>[e(E,{size:"22",icon:"tabler-chevron-left",class:"flip-in-rtl"})]),_:1}),s("div",Ee,[s("div",ke,g(a.email.data.subject),1)])]),e($),e(B(q),{tag:"div",class:"mail-content-container flex-grow-1 pa-sm-12 pa-6",options:{wheelPropagation:!1}},{default:l(()=>[e(L,{class:"mb-4"},{default:l(()=>[s("div",Se,[e(ae,{size:"38"},{default:l(()=>[e(oe,{src:a.email.data.sender_avatar,alt:a.email.data.sender_name},null,8,["src","alt"])]),_:1}),s("div",De,[s("div",Te,[s("div",Ie,g(a.email.data.sender_name),1),s("div",Be,g(a.email.data.sender_email),1)]),e(j),s("div",Fe,g(new Date(a.email.created_at).toDateString()),1)])]),e($),e(le,null,{default:l(()=>[s("div",{class:"text-base",innerHTML:a.email.data.body},null,8,Ue)]),_:1})]),_:1})]),_:1})],64)):O("",!0)]),_:1},8,["model-value"])}}},Le={class:"d-flex align-center"},je=["onClick"],Ae={class:"text-h6"},Ne={class:"text-body-2 truncate"},Me={class:"text-sm text-disabled"},Oe={key:1,class:"py-4 px-5 text-center"},Pe=s("span",{class:"text-high-emphasis"},"No emails found.",-1),Re=[Pe],Ft={__name:"index",async setup(c){let f,a;const{isLeftSidebarOpen:i}=ie(),u=H(),d=h(!1),o=h([]),v=h(null),m=h("inbox"),b=async()=>{m.value==="inbox"?await u.fetchReceivedEmails():m.value==="sent"&&await u.fetchSentEmails()};[f,a]=A(()=>b()),await f,a();const x=C(()=>m.value==="inbox"?u.receivedEmails||[]:m.value==="sent"?u.sentEmails||[]:[]),k=r=>{const t=o.value.indexOf(r);t===-1?o.value.push(r):o.value.splice(t,1)};C(()=>x.value.length>0&&x.value.length===o.value.length),C(()=>!!o.value.length&&x.value.length!==o.value.length);const w=async r=>{m.value=r,await b()},S=r=>{v.value=r};return(r,t)=>{const y=F("IconBtn");return _(),U(re,{style:{"min-block-size":"100%"},class:"email-app-layout"},{default:l(()=>[e(G,{modelValue:B(i),"onUpdate:modelValue":t[1]||(t[1]=n=>Q(i)?i.value=n:null),absolute:"",touchless:"",location:"start",temporary:r.$vuetify.display.mdAndDown},{default:l(()=>[e(we,{onToggleComposeDialogVisibility:t[0]||(t[0]=n=>d.value=!d.value),onChangeFolder:w})]),_:1},8,["modelValue","temporary"]),e(ze,{email:v.value,onClose:t[2]||(t[2]=n=>v.value=null)},null,8,["email"]),e(ne,null,{default:l(()=>[e(L,{flat:"",class:"email-content-list h-100 d-flex flex-column"},{default:l(()=>[s("div",Le,[e(y,{class:"d-lg-none ms-3",onClick:t[3]||(t[3]=n=>i.value=!0)},{default:l(()=>[e(E,{icon:"tabler-menu-2"})]),_:1}),e(R,{modelValue:r.q,"onUpdate:modelValue":t[4]||(t[4]=n=>r.q=n),density:"default",class:"email-search px-sm-2 flex-grow-1 py-1",placeholder:"Search mail"},{"prepend-inner":l(()=>[e(E,{icon:"tabler-search",size:"24",class:"me-1 text-medium-emphasis"})]),_:1},8,["modelValue"])]),e($),e(B(q),{tag:"ul",options:{wheelPropagation:!1},class:"email-list"},{default:l(()=>[x.value.length>0?(_(!0),V(z,{key:0},P(x.value,n=>(_(),V("li",{key:n.id,class:I(["email-item d-flex align-center pa-4 gap-2 cursor-pointer",[{"email-read":n.read_at}]]),onClick:D=>S(n)},[e(ce,{"model-value":o.value.includes(n.id),class:"flex-shrink-0","onUpdate:modelValue":D=>k(n.id),onClick:t[5]||(t[5]=W(()=>{},["stop"]))},null,8,["model-value","onUpdate:modelValue"]),s("h6",Ae,g(n.data.sender_name),1),s("span",Ne,g(n.data.subject),1),e(j),s("div",{class:I(["email-meta align-center gap-2",r.$vuetify.display.xs?"d-none":""])},[s("span",Me,g(new Date(n.created_at).toLocaleString()),1)],2)],10,je))),128)):(_(),V("li",Oe,Re))]),_:1})]),_:1}),X(e(ge,{onClose:t[6]||(t[6]=n=>d.value=!1)},null,512),[[Y,d.value]])]),_:1})]),_:1})}}};export{Ft as default};
