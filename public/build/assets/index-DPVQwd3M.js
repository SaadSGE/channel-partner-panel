import{r as oe}from"./validators-B1VWr22n.js";import{a5 as ie,r as l,H as ne,w as ue,o as u,c as de,b as r,d as b,e as s,v as n,a6 as me,n as A,a7 as P,f as m,z as p,a1 as _,F as pe}from"./main-BF6e-Eh1.js";import{_ as ce}from"./TablePagination-DU0AENEo.js";import{_ as fe}from"./AppTextField-tZg0diSR.js";import{_ as ve}from"./AppSelect-zpWWj17V.js";import{_ as Ve}from"./AppAutocomplete-CkjN57e0.js";import{_ as ge}from"./Filters-DQiQXs7I.js";import{u as Ue}from"./rolePermission-CBM_Cbx9.js";import{u as _e}from"./user-hSju0oqk.js";import ye from"./AddNewUserDrawer-0UqMrikd.js";import we from"./EditNewUserDrawer-DI3HqL1S.js";import{S as i}from"./sweetalert2-z6gKu1nJ.js";import{g as Se}from"./helpers-DoU3yFal.js";import{V as O,b as q,d as ke,a as Ce}from"./VCard-Bi5b61tq.js";import{V as E}from"./VCardText-B8-CUIel.js";import{V as be}from"./VForm-bOISUoDK.js";import{V as z}from"./VSpacer-C62oh_64.js";import{V as Pe}from"./VDialog-DC-Gf9Lc.js";import{V as $e}from"./VRow-BmWmwuSp.js";import{V as M}from"./VDivider-BmLSUF_n.js";import{V as De}from"./VDataTableServer-C7pOyMX5.js";import{V as he}from"./VMenu-REHTAch5.js";import{V as xe,a as $,b as D}from"./VList-DdOH8j-P.js";import{V as Be}from"./VSwitch-CE3iYGpD.js";import"./VPagination-BasU6x9g.js";import"./form-4TuR6qd9.js";import"./VTextField-BjeFlSIA.js";/* empty css                   */import"./VCounter-DLV0QghX.js";import"./index-CUfd_o_2.js";import"./index-DFwR0W_E.js";import"./VField-BxycNjwc.js";import"./easing-CjukEv2V.js";import"./VInput-DkJAcnuc.js";import"./forwardRefs-C-GTDzx5.js";import"./VSelect-D7Q_gkaL.js";import"./dialog-transition-D-XOHiN-.js";import"./VOverlay-CcUFDdIJ.js";import"./lazy-BNB4Kfda.js";import"./scopeId-CdW-4zvo.js";import"./VCheckboxBtn-E2s6CmtP.js";import"./VSelectionControl-Bd5ryKse.js";import"./VAvatar-Bd0FJTa4.js";import"./VImg-dxLDw2h5.js";import"./VChip-D5_WYowu.js";import"./VSlideGroup-j5Zz9RxS.js";import"./filter-BNLKVGOU.js";import"./AppDateTimePicker-C8ANIFpN.js";import"./commonFunction-DLQ2fPb3.js";import"./api-BJ1HzT7u.js";import"./index-Dz1rBMAR.js";import"./AppDrawerHeaderSection-CyyyLF_h.js";import"./auth-B_eo6w1U.js";import"./vue3-perfect-scrollbar.esm-CTrTeRcz.js";import"./VNavigationDrawer-CRgvdxyA.js";import"./ssrBoot-DyS4YQLx.js";import"./VFileInput-Hmz-mBoN.js";import"./VCheckbox-C5Rcfq2y.js";/* empty css              */import"./VDataTable-C_rVib9w.js";import"./VTable-57NGg9vU.js";const Ae={class:"me-3 d-flex gap-3"},Ee={class:"app-user-search-filter d-flex align-center flex-wrap gap-4"},Te={style:{"inline-size":"15.625rem"}},Mt={__name:"index",setup(Fe){const H=ie(()=>"calc(100vh - 200px)"),d=_e(),T=Ue(),h=l(!1),y=l([]),x=l(0),c=l(10),f=l(1),Q=l(),Y=l(),w=l(""),S=l(null),k=l(null);l(),l();const C=l(null),F=l(!1),j=l([]),B=l(!1),R=l(null),v=l(!1),V=l(null),I=l(null),L=l(Se()==="admin"),G=e=>{I.value=e,V.value=e.parent_id||"",v.value=!0},N=async()=>{if(!V.value)return;const e=await d.setParent(I.value.id,V.value);e.success?(g(),i.fire("Success!",e.message,"success"),v.value=!1):i.fire("Error!",e.message,"error")},J=e=>{console.log(e);const t=y.value.findIndex(o=>o.id===e.id);t!==-1&&y.value.splice(t,1,e)},K=e=>{W(e)},W=e=>{R.value=e,B.value=!0},g=async()=>{F.value=!0;try{const e=await d.fetchUsers(f.value,w.value,S.value,k.value,C.value);y.value=e.data,x.value=e.total}catch(e){console.error("Error fetching users:",e)}finally{F.value=!1}},X=async e=>{try{await g(),i.fire("Success!","User added successfully!","success")}catch(t){console.error("Error adding user:",t),i.fire("Error!","Failed to add user.","error")}},Z=async e=>{if((await i.fire({title:"Are you sure?",text:"Do you want to delete this user?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel"})).isConfirmed){const o=await d.deleteUser(e);o.success?i.fire("Deleted!",o.message,"success"):i.fire("Error!",o.message,"error")}},ee=e=>{var t,o;Q.value=(t=e.sortBy[0])==null?void 0:t.key,Y.value=(o=e.sortBy[0])==null?void 0:o.order,g()},te=[{title:"Name",key:"full_name"},{title:"Company",key:"company_name_with_email"},{title:"Role",key:"role"},...L.value?[{title:"Parent",key:"parent.full_name"}]:[],{title:"Record Count",key:"record_count"},...L.value?[{title:"Status",key:"status",sortable:!1}]:[],{title:"Actions",key:"actions",sortable:!1}],ae=async e=>{e.statusLoading=!0;try{(await d.updateUserStatus(e.id,e.status)).status?i.fire("Success!","User status updated successfully!","success"):(i.fire("Error!","Failed to update user status.","error"),e.status=e.status===1?0:1)}catch(t){console.error("Error updating user status:",t),i.fire("Error!","Failed to update user status.","error"),e.status=e.status===1?0:1}finally{e.statusLoading=!1}};return ne(async()=>{await T.getAllRoles(),j.value=T.roles,await d.fetchParentUsers(),g()}),ue([w,S,k,C],()=>{g()}),(e,t)=>{const o=Ve,re=ve,se=fe,le=ce;return u(),de(pe,null,[r(we,{isDrawerOpen:B.value,editedUser:R.value,"onUpdate:isDrawerOpen":t[0]||(t[0]=a=>B.value=a),onUserUpdated:J},null,8,["isDrawerOpen","editedUser"]),b("section",null,[r(Pe,{modelValue:v.value,"onUpdate:modelValue":t[3]||(t[3]=a=>v.value=a),"max-width":"500px"},{default:s(()=>[r(O,null,{default:s(()=>[r(q,null,{default:s(()=>[n("Set Parent")]),_:1}),r(E,null,{default:s(()=>[r(be,{onSubmit:me(N,["prevent"])},{default:s(()=>[r(o,{modelValue:V.value,"onUpdate:modelValue":t[1]||(t[1]=a=>V.value=a),items:A(d).parentUsers,"item-title":a=>a.name_with_email,"item-value":a=>a.id,label:"Parent",placeholder:"Select Parent",rules:["requiredValidator"in e?e.requiredValidator:A(oe)]},null,8,["modelValue","items","item-title","item-value","rules"])]),_:1})]),_:1}),r(ke,null,{default:s(()=>[r(z),r(P,{color:"primary",onClick:N},{default:s(()=>[n("Submit")]),_:1}),r(P,{onClick:t[2]||(t[2]=a=>v.value=!1)},{default:s(()=>[n("Cancel")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),r(O,{class:"mb-6"},{default:s(()=>[e.$can("filter","user")?(u(),m(Ce,{key:0,class:"pb-4"},{default:s(()=>[r(q,null,{default:s(()=>[n("Filter")]),_:1})]),_:1})):p("",!0),e.$can("filter","user")?(u(),m(E,{key:1},{default:s(()=>[r($e,null,{default:s(()=>[r(ge,{"selected-role":S.value,onUpdateRole:t[4]||(t[4]=a=>S.value=a),"selected-parent":k.value,onUpdateParent:t[5]||(t[5]=a=>k.value=a),"selected-userStatus":C.value,onUpdateUserStatus:t[6]||(t[6]=a=>C.value=a)},null,8,["selected-role","selected-parent","selected-userStatus"])]),_:1})]),_:1})):p("",!0),r(M),r(E,{class:"d-flex flex-wrap gap-4"},{default:s(()=>[b("div",Ae,[r(re,{"model-value":c.value,items:[{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:100},{value:-1,title:"All"}],style:{"inline-size":"6.25rem"},"onUpdate:modelValue":t[7]||(t[7]=a=>c.value=parseInt(a,10))},null,8,["model-value"])]),r(z),b("div",Ee,[b("div",Te,[r(se,{modelValue:w.value,"onUpdate:modelValue":t[8]||(t[8]=a=>w.value=a),placeholder:"Search User"},null,8,["modelValue"])]),e.$can("create","user")?(u(),m(P,{key:0,"prepend-icon":"tabler-plus",onClick:t[9]||(t[9]=a=>h.value=!0)},{default:s(()=>[n(" Add New User ")]),_:1})):p("",!0)])]),_:1}),r(M),r(De,{"items-per-page":c.value,"onUpdate:itemsPerPage":t[11]||(t[11]=a=>c.value=a),page:f.value,"onUpdate:page":t[12]||(t[12]=a=>f.value=a),items:y.value,"items-length":x.value,headers:te,class:"text-no-wrap","show-select":"",height:A(H),"onUpdate:options":ee},{"item.actions":s(({item:a})=>[r(P,{icon:"",variant:"text",color:"medium-emphasis"},{default:s(()=>[r(_,{icon:"tabler-dots-vertical"}),r(he,{activator:"parent"},{default:s(()=>[r(xe,null,{default:s(()=>[r($,{to:{name:"user-view-id",params:{id:a.id}}},{prepend:s(()=>[r(_,{icon:"tabler-eye"})]),default:s(()=>[r(D,null,{default:s(()=>[n("View")]),_:1})]),_:2},1032,["to"]),e.$can("edit","user")?(u(),m($,{key:0,onClick:U=>K(a)},{prepend:s(()=>[r(_,{icon:"tabler-pencil"})]),default:s(()=>[r(D,null,{default:s(()=>[n("Edit")]),_:1})]),_:2},1032,["onClick"])):p("",!0),e.$can("edit","user")?(u(),m($,{key:1,onClick:U=>G(a)},{prepend:s(()=>[r(_,{icon:"tabler-pencil"})]),default:s(()=>[r(D,null,{default:s(()=>[n("Set Parent")]),_:1})]),_:2},1032,["onClick"])):p("",!0),e.$can("delete","user")?(u(),m($,{key:2,onClick:U=>Z(a.id)},{prepend:s(()=>[r(_,{icon:"tabler-trash"})]),default:s(()=>[r(D,null,{default:s(()=>[n("Delete")]),_:1})]),_:2},1032,["onClick"])):p("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),"item.status":s(({item:a})=>[r(Be,{modelValue:a.status,"onUpdate:modelValue":U=>a.status=U,"true-value":1,"false-value":0,onChange:U=>ae(a),loading:a.statusLoading},null,8,["modelValue","onUpdate:modelValue","onChange","loading"])]),bottom:s(()=>[r(le,{page:f.value,"onUpdate:page":t[10]||(t[10]=a=>f.value=a),"items-per-page":c.value,"total-items":x.value},null,8,["page","items-per-page","total-items"])]),_:1},8,["items-per-page","page","items","items-length","height"])]),_:1}),r(ye,{isDrawerOpen:h.value,"onUpdate:isDrawerOpen":t[13]||(t[13]=a=>h.value=a),onUserData:X},null,8,["isDrawerOpen"])])],64)}}};export{Mt as default};
