import{p as se}from"./formatters-CtCyAfzS.js";import{r as oe}from"./validators-HfjVqymk.js";import{r as s,H as ie,w as ne,o as A,c as L,b as e,d as o,e as l,F as M,i as ue,f as me,x as y,y as de,n as U,a1 as d,v as n,a6 as pe,a7 as h}from"./main-XJa5aX3I.js";import{_ as ce}from"./TablePagination-CViHA-yz.js";import{_ as fe}from"./AppTextField-DrmolqLU.js";import{_ as ve}from"./AppSelect-CyvI6GiH.js";import{_ as _e}from"./AppAutocomplete-DpHMkZtc.js";import{u as Ve}from"./rolePermission-BPH004js.js";import{u as ge}from"./user-DAdmVNbq.js";import we from"./AddNewUserDrawer-DN2yaAZo.js";import be from"./EditNewUserDrawer-B0Q0P7t_.js";import{S as u}from"./sweetalert2-z6gKu1nJ.js";import{V as $,b as W,d as xe,a as ye}from"./VCard-BFoj9BhB.js";import{V as C}from"./VCardText-P6OX4H04.js";import{V as Ue}from"./VAvatar-CX5r16Ti.js";import{a as E,V as q}from"./VRow-Dwpnmj__.js";import{V as he}from"./VForm-CcTXiBEf.js";import{V as j}from"./VSpacer-CFgU9INv.js";import{V as Ce}from"./VDialog-DEG5gqqS.js";import{V as H}from"./VDivider-BtvMDquf.js";import{V as ke}from"./VDataTableServer-COWYxqZn.js";import{V as Pe}from"./VMenu-Cpqavgja.js";import{V as Se,a as k,b as P}from"./VList-D6tzqEvZ.js";import"./helpers-JeqSko8v.js";import"./VPagination-BLWS_rEt.js";import"./form-Z5tG_ZG7.js";import"./VTextField-CSD0oQBT.js";/* empty css                   */import"./VCounter-Mm2vdIyV.js";import"./index-zEe2giix.js";import"./index-zwv73YjU.js";import"./VField-Cobw2p2R.js";import"./easing-CjukEv2V.js";import"./VInput-BC1HEXL1.js";import"./forwardRefs-C-GTDzx5.js";import"./VSelect-BKMDYlsV.js";import"./dialog-transition-CTiuRszX.js";import"./VOverlay-Bi2A_5bs.js";import"./lazy-BiNEa39J.js";import"./scopeId-CT2whC_9.js";import"./VCheckboxBtn-CP-3PHGB.js";import"./VSelectionControl-D6l_27o_.js";import"./VChip-DdQTJchV.js";import"./VSlideGroup-B-IflH2w.js";import"./filter-Cav6n7Bq.js";import"./api-J8nRVKeM.js";import"./index-B3bPRkoL.js";import"./AppDrawerHeaderSection-LdoXO7hE.js";import"./auth-HwfIc_tI.js";import"./vue3-perfect-scrollbar.esm-eBo9RyUM.js";import"./VNavigationDrawer-BhXBSzj3.js";import"./ssrBoot-Cs4BXTlO.js";import"./VCheckbox-wg7ptJyW.js";import"./VImg-3ZTHbjf_.js";/* empty css              */import"./VDataTable-BJG3lirU.js";import"./VTable-DmShKz6R.js";const De={class:"d-flex mb-6"},Be={class:"d-flex justify-space-between"},Ae={class:"d-flex flex-column gap-y-1"},$e={class:"text-body-1 text-high-emphasis"},Ee={class:"d-flex gap-x-2 align-center"},Te={class:"text-h4"},Ne={class:"text-sm"},Ie={class:"me-3 d-flex gap-3"},Oe={class:"app-user-search-filter d-flex align-center flex-wrap gap-4"},Re={style:{"inline-size":"15.625rem"}},Wt={__name:"index",setup(Fe){const m=ge(),T=Ve(),S=s(!1),V=s([]),D=s(0),p=s(10),c=s(1),Q=s(),Y=s(),g=s(""),w=s(),b=s(null);s(),s();const N=s(!1),I=s([]),B=s(!1),O=s(null),f=s(!1),v=s(null),R=s(null),G=r=>{R.value=r,v.value=r.parent_id||"",f.value=!0},F=async()=>{if(!v.value)return;const r=await m.setParent(R.value.id,v.value);r.success?(_(),u.fire("Success!",r.message,"success"),f.value=!1):u.fire("Error!",r.message,"error")},J=r=>{const a=V.value.findIndex(i=>i.id===r.id);a!==-1&&V.value.splice(a,1,r)},K=r=>{X(r)},X=r=>{O.value=r,B.value=!0},_=async()=>{N.value=!0;try{const r=await m.fetchUsers(c.value,g.value,w.value,b.value);V.value=r.data,D.value=r.total}catch(r){console.error("Error fetching users:",r)}finally{N.value=!1}},Z=async r=>{try{await _(),u.fire("Success!","User added successfully!","success")}catch(a){console.error("Error adding user:",a),u.fire("Error!","Failed to add user.","error")}},ee=async r=>{if((await u.fire({title:"Are you sure?",text:"Do you want to delete this user?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel"})).isConfirmed){const i=await m.deleteUser(r);i.success?u.fire("Deleted!",i.message,"success"):u.fire("Error!",i.message,"error")}},te=r=>{var a,i;Q.value=(a=r.sortBy[0])==null?void 0:a.key,Y.value=(i=r.sortBy[0])==null?void 0:i.order,_()},le=[{title:"Name",key:"full_name"},{title:"Email",key:"email"},{title:"Mobile Number",key:"mobile_number"},{title:"Whatsapp Number",key:"whatsapp_number"},{title:"Role",key:"role"},{title:"Parent",key:"parent.full_name"},{title:"Record Count",key:"record_count"},{title:"Actions",key:"actions",sortable:!1}];return ie(async()=>{await T.getAllRoles(),I.value=T.roles,await m.fetchParentUsers(),_()}),ne([g,w,b],()=>{_()}),(r,a)=>{const i=_e,z=ve,ae=fe,re=ce;return A(),L(M,null,[e(be,{isDrawerOpen:B.value,editedUser:O.value,"onUpdate:isDrawerOpen":a[0]||(a[0]=t=>B.value=t),onUserUpdated:J},null,8,["isDrawerOpen","editedUser"]),o("section",null,[o("div",De,[e(q,null,{default:l(()=>[(A(!0),L(M,null,ue(r.widgetData,(t,x)=>(A(),me(E,{key:x,cols:"12",md:"3",sm:"6"},{default:l(()=>[e($,null,{default:l(()=>[e(C,null,{default:l(()=>[o("div",Be,[o("div",Ae,[o("div",$e,y(t.title),1),o("div",Ee,[o("h4",Te,y(t.value),1),o("div",{class:de(["text-base",t.change>0?"text-success":"text-error"])}," ("+y(("prefixWithPlus"in r?r.prefixWithPlus:U(se))(t.change))+"%) ",3)]),o("div",Ne,y(t.desc),1)]),e(Ue,{color:t.iconColor,variant:"tonal",rounded:"",size:"42"},{default:l(()=>[e(d,{icon:t.icon,size:"26"},null,8,["icon"])]),_:2},1032,["color"])])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),e(Ce,{modelValue:f.value,"onUpdate:modelValue":a[3]||(a[3]=t=>f.value=t),"max-width":"500px"},{default:l(()=>[e($,null,{default:l(()=>[e(W,null,{default:l(()=>[n("Set Parent")]),_:1}),e(C,null,{default:l(()=>[e(he,{onSubmit:pe(F,["prevent"])},{default:l(()=>[e(i,{modelValue:v.value,"onUpdate:modelValue":a[1]||(a[1]=t=>v.value=t),items:U(m).parentUsers,"item-title":t=>t.full_name,"item-value":t=>t.id,label:"Parent",placeholder:"Select Parent",rules:["requiredValidator"in r?r.requiredValidator:U(oe)]},null,8,["modelValue","items","item-title","item-value","rules"])]),_:1})]),_:1}),e(xe,null,{default:l(()=>[e(j),e(h,{color:"primary",onClick:F},{default:l(()=>[n("Submit")]),_:1}),e(h,{onClick:a[2]||(a[2]=t=>f.value=!1)},{default:l(()=>[n("Cancel")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e($,{class:"mb-6"},{default:l(()=>[e(ye,{class:"pb-4"},{default:l(()=>[e(W,null,{default:l(()=>[n("Filters")]),_:1})]),_:1}),e(C,null,{default:l(()=>[e(q,null,{default:l(()=>[e(E,{cols:"12",sm:"4"},{default:l(()=>[e(z,{modelValue:w.value,"onUpdate:modelValue":a[4]||(a[4]=t=>w.value=t),placeholder:"Select Role",items:I.value,clearable:"","clear-icon":"tabler-x","item-title":t=>t.role,"item-value":t=>t.role},null,8,["modelValue","items","item-title","item-value"])]),_:1}),e(E,{cols:"12",sm:"4"},{default:l(()=>[e(i,{modelValue:b.value,"onUpdate:modelValue":a[5]||(a[5]=t=>b.value=t),placeholder:"Select Parent",items:U(m).parentUsers,clearable:"","clear-icon":"tabler-x","item-title":t=>t.full_name,"item-value":t=>t.id},null,8,["modelValue","items","item-title","item-value"])]),_:1})]),_:1})]),_:1}),e(H),e(C,{class:"d-flex flex-wrap gap-4"},{default:l(()=>[o("div",Ie,[e(z,{"model-value":p.value,items:[{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:100},{value:-1,title:"All"}],style:{"inline-size":"6.25rem"},"onUpdate:modelValue":a[6]||(a[6]=t=>p.value=parseInt(t,10))},null,8,["model-value"])]),e(j),o("div",Oe,[o("div",Re,[e(ae,{modelValue:g.value,"onUpdate:modelValue":a[7]||(a[7]=t=>g.value=t),placeholder:"Search User"},null,8,["modelValue"])]),e(h,{"prepend-icon":"tabler-plus",onClick:a[8]||(a[8]=t=>S.value=!0)},{default:l(()=>[n(" Add New User ")]),_:1})])]),_:1}),e(H),e(ke,{"items-per-page":p.value,"onUpdate:itemsPerPage":a[10]||(a[10]=t=>p.value=t),page:c.value,"onUpdate:page":a[11]||(a[11]=t=>c.value=t),items:V.value,"items-length":D.value,headers:le,class:"text-no-wrap","show-select":"","onUpdate:options":te},{"item.actions":l(({item:t})=>[e(h,{icon:"",variant:"text",color:"medium-emphasis"},{default:l(()=>[e(d,{icon:"tabler-dots-vertical"}),e(Pe,{activator:"parent"},{default:l(()=>[e(Se,null,{default:l(()=>[e(k,{to:{name:"user-view-id",params:{id:t.id}}},{prepend:l(()=>[e(d,{icon:"tabler-eye"})]),default:l(()=>[e(P,null,{default:l(()=>[n("View")]),_:1})]),_:2},1032,["to"]),e(k,{onClick:x=>K(t)},{prepend:l(()=>[e(d,{icon:"tabler-pencil"})]),default:l(()=>[e(P,null,{default:l(()=>[n("Edit")]),_:1})]),_:2},1032,["onClick"]),e(k,{onClick:x=>G(t)},{prepend:l(()=>[e(d,{icon:"tabler-pencil"})]),default:l(()=>[e(P,null,{default:l(()=>[n("Set Parent")]),_:1})]),_:2},1032,["onClick"]),e(k,{onClick:x=>ee(t.id)},{prepend:l(()=>[e(d,{icon:"tabler-trash"})]),default:l(()=>[e(P,null,{default:l(()=>[n("Delete")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),bottom:l(()=>[e(re,{page:c.value,"onUpdate:page":a[9]||(a[9]=t=>c.value=t),"items-per-page":p.value,"total-items":D.value},null,8,["page","items-per-page","total-items"])]),_:1},8,["items-per-page","page","items","items-length"])]),_:1}),e(we,{isDrawerOpen:S.value,"onUpdate:isDrawerOpen":a[12]||(a[12]=t=>S.value=t),onUserData:Z},null,8,["isDrawerOpen"])])],64)}}};export{Wt as default};
