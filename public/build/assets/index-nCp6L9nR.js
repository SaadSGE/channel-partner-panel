import{r as de}from"./validators-Cx3gVRSL.js";import{a6 as me,r as l,H as pe,w as ce,o as i,c as fe,b as r,d as D,e as s,v as u,a8 as ve,n as L,a9 as P,f as d,z as m,a2 as y,F as Ve}from"./main-CmMDhg6u.js";import{_ as ge}from"./TablePagination-rxfEkGwn.js";import{_ as ye}from"./AppTextField-B0-A5xPY.js";import{_ as Ue}from"./AppSelect-_6WgLAWB.js";import{_ as we}from"./AppAutocomplete-DDFXNnKo.js";import{_ as _e}from"./Filters-BRsYFSKB.js";import{c as be}from"./commonFunction-Dr7PFmSJ.js";import{u as Ce}from"./rolePermission-BmLn4JOH.js";import{u as Se}from"./user-CM2Okux1.js";import ke from"./AddNewUserDrawer-CnGwnUDG.js";import he from"./EditNewUserDrawer-DkN1MA3x.js";import{S as n}from"./sweetalert2-z6gKu1nJ.js";import{g as $e}from"./helpers-DC_7qQJT.js";import{V as H,b as Q,c as Be,a as De}from"./VCard-D_l0b8x4.js";import{V as N}from"./VCardText-DsgPFVgU.js";import{V as Pe}from"./VForm-awqrZ1nG.js";import{V as Y}from"./VSpacer-D2YVgYWF.js";import{V as xe}from"./VDialog-DcvMTuQa.js";import{V as Ee}from"./VRow-D-DB5r5S.js";import{V as j}from"./VDivider-CxqX8XSx.js";import{V as Ae}from"./VDataTableServer-CqDVsQiP.js";import{V as Fe}from"./VMenu-NO46rdPP.js";import{V as Te,a as x,b as E}from"./VList-BBY-xzD7.js";import{V as Ie}from"./VSwitch-d9j-KaVz.js";import"./VPagination-DvmwUgNw.js";import"./VInput-B2jW00VE.js";import"./index-CuVcTx4c.js";import"./index-BYZd4dhZ.js";import"./forwardRefs-D3j0TLhE.js";import"./VTextField-N-zyBZPx.js";import"./VSelect-CuvGNuNy.js";import"./dialog-transition-DXd6M7Eg.js";import"./scopeId-BGpenozN.js";import"./VCheckboxBtn-shEHWdjX.js";import"./VAvatar-iSqAFoJH.js";import"./VImg-CdcnN94L.js";import"./VChip-Cn9LDSEE.js";import"./filter-DTLDMYBh.js";import"./AppDateTimePicker-9naNJv4i.js";import"./AppDrawerHeaderSection-DwmUboyF.js";import"./auth-CIfRGsSK.js";import"./vue3-perfect-scrollbar.esm-V0P8kw4a.js";import"./VNavigationDrawer-CppzuPrT.js";import"./ssrBoot-CSa3_jgG.js";import"./VFileInput-Buc-5EPs.js";import"./VCheckbox-q0fvf2eN.js";/* empty css              */import"./VDataTable-MtGV2DpS.js";import"./VTable-C6wxiKin.js";const Le={class:"me-3 d-flex gap-3"},Ne={class:"app-user-search-filter d-flex align-center flex-wrap gap-4"},Oe={style:{"inline-size":"15.625rem"}},Lt={__name:"index",setup(Re){const G=me(()=>"calc(100vh - 200px)"),p=Se();Ce();const O=be(),A=l(!1),U=l([]),F=l(0),c=l(10),f=l(1),J=l(),K=l(),w=l(""),_=l(null),b=l(null),C=l(null),S=l(null);l(),l();const k=l(null),h=l(!1);l([]);const T=l(!1),R=l(null),v=l(!1),V=l(null),M=l(null),q=l($e()==="admin"),I=l([]),$=l(null),W=a=>{M.value=a,V.value=a.parent_id||"",v.value=!0},z=async()=>{if(!V.value)return;const a=await p.setParent(M.value.id,V.value);a.success?(B(),n.fire("Success!",a.message,"success"),v.value=!1):n.fire("Error!",a.message,"error")},X=a=>{const e=U.value.findIndex(o=>o.id===a.id);e!==-1&&U.value.splice(e,1,a)},Z=a=>{ee(a)},ee=a=>{R.value=a,T.value=!0},B=async()=>{h.value=!0;try{const a=await p.fetchUsers(f.value,w.value,_.value,b.value,k.value,C.value,S.value,$.value);U.value=a.data,F.value=a.total}catch(a){console.error("Error fetching users:",a)}finally{h.value=!1}},te=async a=>{try{await B(),n.fire("Success!","User added successfully!","success")}catch(e){console.error("Error adding user:",e),n.fire("Error!","Failed to add user.","error")}},ae=async a=>{if((await n.fire({title:"Are you sure?",text:"Do you want to delete this user?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel"})).isConfirmed){const o=await p.deleteUser(a);o.success?n.fire("Deleted!",o.message,"success"):n.fire("Error!",o.message,"error")}},re=a=>{var e,o;J.value=(e=a.sortBy[0])==null?void 0:e.key,K.value=(o=a.sortBy[0])==null?void 0:o.order,B()},se=[{title:"Name",key:"full_name"},{title:"Company",key:"company_name_with_email"},{title:"Role",key:"role"},...q.value?[{title:"Parent",key:"parent.full_name"}]:[],{title:"Record Count",key:"record_count"},...q.value?[{title:"Status",key:"status",sortable:!1}]:[],{title:"Actions",key:"actions",sortable:!1}],le=async a=>{a.statusLoading=!0;try{(await p.updateUserStatus(a.id,a.status)).status?n.fire("Success!","User status updated successfully!","success"):(n.fire("Error!","Failed to update user status.","error"),a.status=a.status===1?0:1)}catch(e){console.error("Error updating user status:",e),n.fire("Error!","Failed to update user status.","error"),a.status=a.status===1?0:1}finally{a.statusLoading=!1}};pe(async()=>{oe()}),ce([w,_,b,k,C,S,$],()=>{B()});const oe=async()=>{h.value=!0;try{await O.getBranches(),I.value=O.branches}catch(a){console.error("Error fetching branches:",a)}finally{h.value=!1}};return(a,e)=>{const o=we,ne=Ue,ue=ye,ie=ge;return i(),fe(Ve,null,[r(he,{isDrawerOpen:T.value,editedUser:R.value,branches:I.value,"onUpdate:isDrawerOpen":e[0]||(e[0]=t=>T.value=t),onUserUpdated:X},null,8,["isDrawerOpen","editedUser","branches"]),D("section",null,[r(xe,{modelValue:v.value,"onUpdate:modelValue":e[3]||(e[3]=t=>v.value=t),"max-width":"500px"},{default:s(()=>[r(H,null,{default:s(()=>[r(Q,null,{default:s(()=>[u("Set Parent")]),_:1}),r(N,null,{default:s(()=>[r(Pe,{onSubmit:ve(z,["prevent"])},{default:s(()=>[r(o,{modelValue:V.value,"onUpdate:modelValue":e[1]||(e[1]=t=>V.value=t),items:L(p).parentUsers,"item-title":t=>t.name_with_email,"item-value":t=>t.id,label:"Parent",placeholder:"Select Parent",rules:["requiredValidator"in a?a.requiredValidator:L(de)]},null,8,["modelValue","items","item-title","item-value","rules"])]),_:1})]),_:1}),r(Be,null,{default:s(()=>[r(Y),r(P,{color:"primary",onClick:z},{default:s(()=>[u("Submit")]),_:1}),r(P,{onClick:e[2]||(e[2]=t=>v.value=!1)},{default:s(()=>[u("Cancel")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),r(H,{class:"mb-6"},{default:s(()=>[a.$can("filter","user")?(i(),d(De,{key:0,class:"pb-4"},{default:s(()=>[r(Q,null,{default:s(()=>[u("Filter")]),_:1})]),_:1})):m("",!0),a.$can("filter","user")?(i(),d(N,{key:1},{default:s(()=>[r(Ee,null,{default:s(()=>[r(_e,{"selected-role":_.value,onUpdateRole:e[4]||(e[4]=t=>_.value=t),"selected-parent":b.value,onUpdateParent:e[5]||(e[5]=t=>b.value=t),"selected-userStatus":k.value,onUpdateUserStatus:e[6]||(e[6]=t=>k.value=t),"selected-country":C.value,onUpdateCountry:e[7]||(e[7]=t=>C.value=t),"selected-mou":S.value,onUpdateMou:e[8]||(e[8]=t=>S.value=t),"selected-branch":$.value,onUpdateBranch:e[9]||(e[9]=t=>$.value=t)},null,8,["selected-role","selected-parent","selected-userStatus","selected-country","selected-mou","selected-branch"])]),_:1})]),_:1})):m("",!0),r(j),r(N,{class:"d-flex flex-wrap gap-4"},{default:s(()=>[D("div",Le,[r(ne,{"model-value":c.value,items:[{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:100},{value:-1,title:"All"}],style:{"inline-size":"6.25rem"},"onUpdate:modelValue":e[10]||(e[10]=t=>c.value=parseInt(t,10))},null,8,["model-value"])]),r(Y),D("div",Ne,[D("div",Oe,[r(ue,{modelValue:w.value,"onUpdate:modelValue":e[11]||(e[11]=t=>w.value=t),placeholder:"Search User"},null,8,["modelValue"])]),a.$can("create","user")?(i(),d(P,{key:0,"prepend-icon":"tabler-plus",onClick:e[12]||(e[12]=t=>A.value=!0)},{default:s(()=>[u(" Add New User ")]),_:1})):m("",!0)])]),_:1}),r(j),r(Ae,{"items-per-page":c.value,"onUpdate:itemsPerPage":e[14]||(e[14]=t=>c.value=t),page:f.value,"onUpdate:page":e[15]||(e[15]=t=>f.value=t),items:U.value,"items-length":F.value,headers:se,class:"text-no-wrap","show-select":"",height:L(G),"onUpdate:options":re},{"item.actions":s(({item:t})=>[r(P,{icon:"",variant:"text",color:"medium-emphasis"},{default:s(()=>[r(y,{icon:"tabler-dots-vertical"}),r(Fe,{activator:"parent"},{default:s(()=>[r(Te,null,{default:s(()=>[r(x,{to:{name:"user-view-id",params:{id:t.id}}},{prepend:s(()=>[r(y,{icon:"tabler-eye"})]),default:s(()=>[r(E,null,{default:s(()=>[u("View")]),_:1})]),_:2},1032,["to"]),a.$can("edit","user")?(i(),d(x,{key:0,onClick:g=>Z(t)},{prepend:s(()=>[r(y,{icon:"tabler-pencil"})]),default:s(()=>[r(E,null,{default:s(()=>[u("Edit")]),_:1})]),_:2},1032,["onClick"])):m("",!0),a.$can("edit","user")?(i(),d(x,{key:1,onClick:g=>W(t)},{prepend:s(()=>[r(y,{icon:"tabler-pencil"})]),default:s(()=>[r(E,null,{default:s(()=>[u("Set Parent")]),_:1})]),_:2},1032,["onClick"])):m("",!0),a.$can("delete","user")?(i(),d(x,{key:2,onClick:g=>ae(t.id)},{prepend:s(()=>[r(y,{icon:"tabler-trash"})]),default:s(()=>[r(E,null,{default:s(()=>[u("Delete")]),_:1})]),_:2},1032,["onClick"])):m("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),"item.status":s(({item:t})=>[r(Ie,{modelValue:t.status,"onUpdate:modelValue":g=>t.status=g,"true-value":1,"false-value":0,onChange:g=>le(t),loading:t.statusLoading},null,8,["modelValue","onUpdate:modelValue","onChange","loading"])]),bottom:s(()=>[r(ie,{page:f.value,"onUpdate:page":e[13]||(e[13]=t=>f.value=t),"items-per-page":c.value,"total-items":F.value},null,8,["page","items-per-page","total-items"])]),_:1},8,["items-per-page","page","items","items-length","height"])]),_:1}),r(ke,{isDrawerOpen:A.value,"onUpdate:isDrawerOpen":e[16]||(e[16]=t=>A.value=t),branches:I.value,onUserData:te},null,8,["isDrawerOpen","branches"])])],64)}}};export{Lt as default};
