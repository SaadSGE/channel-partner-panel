import{an as H,r as v,ad as A,a5 as C,w as J,a as B,o as _,f as U,e as o,b as e,d as s,a7 as N,v as M,c as V,F as z,i as O,a1 as E,x as h,n as I,z as K,a3 as Q,y as j,a6 as W,K as X,L as Y}from"./main-CEhYKYKY.js";import{$ as T}from"./api-Ct8N1VxS.js";import{_ as Z}from"./TiptapEditor-21Ipd9oW.js";import{_ as ee}from"./AppAutocomplete-DP7KSy2H.js";import{u as te}from"./user-DyB7X-GN.js";import{a as se,V as F}from"./VCard-CcoVlaZG.js";import{V as L}from"./VSpacer-CtT-3tKW.js";import{V as b}from"./VDivider-jsKSsrtF.js";import{V as P}from"./VTextField-Dvc6aHS_.js";import{P as R}from"./vue3-perfect-scrollbar.esm-BbWfxpGe.js";import{V as ae}from"./VAvatar-DuiXy5c-.js";import{V as oe}from"./VImg-plWwyhZh.js";import{V as le}from"./VCardText-DXl8qm3H.js";import{V as q}from"./VNavigationDrawer-C2z-2M_h.js";import{u as ie,a as ne,V as re}from"./VMain-DOZNHkui.js";import{V as me}from"./VCheckbox-BARqbVWG.js";import"./index-B3bPRkoL.js";import"./index-CWwP8dhX.js";import"./index-WZJIRu9J.js";import"./form-CR9FHYSk.js";import"./VSelect-D18eXXxa.js";import"./forwardRefs-C-GTDzx5.js";import"./VList-DeZNdhQC.js";import"./index-Bosu9QYL.js";import"./ssrBoot-DAToJ_Bq.js";import"./index-1lT_ll9z.js";import"./dialog-transition-BGvNIWMw.js";import"./easing-CjukEv2V.js";import"./VMenu-DvHSS_2N.js";import"./VOverlay-BJTdUf6z.js";import"./lazy-CdJklPXb.js";import"./scopeId-a4ccIhBx.js";import"./VCheckboxBtn-BvQCB4ge.js";import"./VSelectionControl-CR3bYC0I.js";import"./VChip-Bo-B3fxT.js";import"./VSlideGroup-S1eoZvBH.js";import"./filter-CnO1fquf.js";import"./helpers-DpcB77om.js";/* empty css              *//* empty css                   */import"./VCounter-DSruwY3c.js";import"./VField-YghrxBaZ.js";import"./VInput-Cr3FVq7V.js";const G=H({id:"email",state:()=>({receivedEmails:[],sentEmails:[]}),actions:{async fetchReceivedEmails(){try{const m=await T("/emails/received",{method:"GET",headers:{"Content-Type":"application/json"}});this.receivedEmails=m.data}catch(m){console.error("Error fetching received emails:",m)}},async fetchSentEmails(){try{const m=await T("/emails/sent",{method:"GET",headers:{"Content-Type":"application/json"}});this.sentEmails=m.data}catch(m){console.error("Error fetching sent emails:",m)}},async sendEmail({recipients:m,subject:u,body:a}){console.log(m),console.log(u),console.log(a);try{const l=await T("/emails/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({recipients:m,subject:u,body:a})});return this.sentEmails.unshift(l.data),{success:!0,message:"Email sent successfully!"}}catch(l){return console.error("Error sending email:",l),this.errors=l.response?l.response.data.errors:["An unexpected error occurred"],{success:!1,message:"Failed to send email."}}}}}),ce={class:"d-flex align-center"},de=s("h5",{class:"text-h5"},"Compose Mail",-1),pe={class:"d-flex align-center gap-x-2"},ue={class:"px-1 pe-6 py-1"},_e=s("div",{class:"text-base font-weight-medium text-disabled"}," To: ",-1),fe={class:"px-1 pe-6 py-1"},ve=s("div",{class:"text-base font-weight-medium text-disabled"},"Subject:",-1),he={class:"d-flex align-center px-6 py-4"},ge={__name:"ComposeDialog",emits:["close"],async setup(m,{emit:u}){let a,l;const d=u,n=v(""),c=v([]),f=v(""),g=v(""),$=te(),x=G();[a,l]=A(()=>$.fetcAllhUser()),await a,l();const S=C(()=>$.allUsers),w=()=>{c.value=[],f.value="",g.value="",n.value=""};J(c,r=>{});const k=async()=>{const t={recipients:c.value,subject:f.value,body:n.value},y=await x.sendEmail(t);y.success?(w(),d("close")):console.error(y.message)};return(r,t)=>{const y=B("IconBtn"),i=ee,D=Z;return _(),U(F,{class:"email-compose-dialog",elevation:"10","max-width":"30vw"},{default:o(()=>[e(se,{class:"py-3 px-6"},{default:o(()=>[s("div",ce,[de,e(L),s("div",pe,[e(y,{size:"small",icon:"tabler-minus",onClick:t[0]||(t[0]=p=>r.$emit("close"))}),e(y,{size:"small",icon:"tabler-x",onClick:t[1]||(t[1]=p=>{r.$emit("close"),w()})})])])]),_:1}),s("div",ue,[e(i,{modelValue:c.value,"onUpdate:modelValue":t[2]||(t[2]=p=>c.value=p),items:S.value,"item-title":p=>p.name_with_email,"item-value":p=>p.id,multiple:"",chips:"","closable-chips":""},{"prepend-inner":o(()=>[_e]),_:1},8,["modelValue","items","item-title","item-value"])]),e(b),s("div",fe,[e(P,{modelValue:f.value,"onUpdate:modelValue":t[3]||(t[3]=p=>f.value=p),density:"compact"},{"prepend-inner":o(()=>[ve]),_:1},8,["modelValue"])]),e(b),e(D,{modelValue:n.value,"onUpdate:modelValue":t[4]||(t[4]=p=>n.value=p),placeholder:"Message"},null,8,["modelValue"]),e(b),s("div",he,[e(N,{color:"primary",class:"me-4","append-icon":"tabler-send",onClick:t[5]||(t[5]=p=>k())},{default:o(()=>[M(" Send ")]),_:1})])]),_:1})}}},xe={class:"d-flex flex-column h-100"},ye={class:"px-6 pb-5 pt-6"},Ve={class:"email-filters py-4"},be=["onClick"],$e={class:"text-base"},we={__name:"EmailLeftSidebarContent",emits:["toggleComposeDialogVisibility","changeFolder"],setup(m,{emit:u}){const a=[{title:"Inbox",prependIcon:"tabler-mail",filter:"inbox"},{title:"Sent",prependIcon:"tabler-send",filter:"sent"}];return(l,d)=>(_(),V("div",xe,[s("div",ye,[e(N,{block:"",onClick:d[0]||(d[0]=n=>l.$emit("toggleComposeDialogVisibility"))},{default:o(()=>[M(" Compose ")]),_:1})]),s("ul",Ve,[(_(),V(z,null,O(a,n=>s("li",{key:n.title,class:"d-flex align-center cursor-pointer",onClick:c=>l.$emit("changeFolder",n.filter)},[e(E,{icon:n.prependIcon,class:"me-2",size:"20"},null,8,["icon"]),s("div",$e,h(n.title),1)],8,be)),64))])]))}},Ce={class:"email-view-header d-flex align-center px-5 py-3"},Ee={class:"d-flex align-center flex-wrap flex-grow-1 overflow-hidden gap-2"},Se={class:"text-body-1 text-high-emphasis text-truncate"},ke={class:"d-flex align-start align-sm-center pa-6 gap-x-4"},De={class:"d-flex flex-wrap flex-grow-1 overflow-hidden"},Te={class:"text-truncate"},Ie={class:"text-body-1 text-high-emphasis text-truncate"},Be={class:"text-sm"},Ue={class:"text-disabled text-base"},ze=["innerHTML"],Fe={__name:"EmailView",props:{email:{type:Object,required:!0}},emits:["close"],setup(m,{emit:u}){const a=m;return(l,d)=>{const n=B("IconBtn");return _(),U(q,{temporary:"","model-value":!!a.email,location:"right",scrim:!1,floating:"",class:"email-view"},{default:o(()=>[a.email?(_(),V(z,{key:0},[s("div",Ce,[e(n,{class:"me-2",onClick:d[0]||(d[0]=c=>l.$emit("close"))},{default:o(()=>[e(E,{size:"22",icon:"tabler-chevron-left",class:"flip-in-rtl"})]),_:1}),s("div",Ee,[s("div",Se,h(a.email.data.subject),1)])]),e(b),e(I(R),{tag:"div",class:"mail-content-container flex-grow-1 pa-sm-12 pa-6",options:{wheelPropagation:!1}},{default:o(()=>[e(F,{class:"mb-4"},{default:o(()=>[s("div",ke,[e(ae,{size:"38"},{default:o(()=>[e(oe,{src:a.email.data.sender_avatar,alt:a.email.data.sender_name},null,8,["src","alt"])]),_:1}),s("div",De,[s("div",Te,[s("div",Ie,h(a.email.data.sender_name),1),s("div",Be,h(a.email.data.sender_email),1)]),e(L),s("div",Ue,h(new Date(a.email.created_at).toDateString()),1)])]),e(b),e(le,null,{default:o(()=>[s("div",{class:"text-base",innerHTML:a.email.data.body},null,8,ze)]),_:1})]),_:1})]),_:1})],64)):K("",!0)]),_:1},8,["model-value"])}}},Le={class:"d-flex align-center"},je=["onClick"],Ae={class:"text-h6"},Ne={class:"text-body-2 truncate"},Me={class:"text-sm text-disabled"},Oe={key:1,class:"py-4 px-5 text-center"},Pe=s("span",{class:"text-high-emphasis"},"No emails found.",-1),Re=[Pe],Ut={__name:"index",async setup(m){let u,a;const{isLeftSidebarOpen:l}=ie(),d=G(),n=v(!1),c=v([]),f=v(null),g=v("inbox"),$=async()=>{g.value==="inbox"?await d.fetchReceivedEmails():g.value==="sent"&&await d.fetchSentEmails()};[u,a]=A(()=>$()),await u,a();const x=C(()=>g.value==="inbox"?d.receivedEmails||[]:g.value==="sent"?d.sentEmails||[]:[]),S=r=>{const t=c.value.indexOf(r);t===-1?c.value.push(r):c.value.splice(t,1)};C(()=>x.value.length>0&&x.value.length===c.value.length),C(()=>!!c.value.length&&x.value.length!==c.value.length);const w=async r=>{g.value=r,await $()},k=r=>{f.value=r};return(r,t)=>{const y=B("IconBtn");return _(),U(re,{style:{"min-block-size":"100%"},class:"email-app-layout"},{default:o(()=>[e(q,{modelValue:I(l),"onUpdate:modelValue":t[1]||(t[1]=i=>Q(l)?l.value=i:null),absolute:"",touchless:"",location:"start",temporary:r.$vuetify.display.mdAndDown},{default:o(()=>[e(we,{onToggleComposeDialogVisibility:t[0]||(t[0]=i=>n.value=!n.value),onChangeFolder:w})]),_:1},8,["modelValue","temporary"]),e(Fe,{email:f.value,onClose:t[2]||(t[2]=i=>f.value=null)},null,8,["email"]),e(ne,null,{default:o(()=>[e(F,{flat:"",class:"email-content-list h-100 d-flex flex-column"},{default:o(()=>[s("div",Le,[e(y,{class:"d-lg-none ms-3",onClick:t[3]||(t[3]=i=>l.value=!0)},{default:o(()=>[e(E,{icon:"tabler-menu-2"})]),_:1}),e(P,{modelValue:r.q,"onUpdate:modelValue":t[4]||(t[4]=i=>r.q=i),density:"default",class:"email-search px-sm-2 flex-grow-1 py-1",placeholder:"Search mail"},{"prepend-inner":o(()=>[e(E,{icon:"tabler-search",size:"24",class:"me-1 text-medium-emphasis"})]),_:1},8,["modelValue"])]),e(b),e(I(R),{tag:"ul",options:{wheelPropagation:!1},class:"email-list"},{default:o(()=>[x.value.length>0?(_(!0),V(z,{key:0},O(x.value,i=>(_(),V("li",{key:i.id,class:j(["email-item d-flex align-center pa-4 gap-2 cursor-pointer",[{"email-read":i.read_at}]]),onClick:D=>k(i)},[e(me,{"model-value":c.value.includes(i.id),class:"flex-shrink-0","onUpdate:modelValue":D=>S(i.id),onClick:t[5]||(t[5]=W(()=>{},["stop"]))},null,8,["model-value","onUpdate:modelValue"]),s("h6",Ae,h(i.data.sender_name),1),s("span",Ne,h(i.data.subject),1),e(L),s("div",{class:j(["email-meta align-center gap-2",r.$vuetify.display.xs?"d-none":""])},[s("span",Me,h(new Date(i.created_at).toLocaleString()),1)],2)],10,je))),128)):(_(),V("li",Oe,Re))]),_:1})]),_:1}),X(e(ge,{onClose:t[6]||(t[6]=i=>n.value=!1)},null,512),[[Y,n.value]])]),_:1})]),_:1})}}};export{Ut as default};
