import{r as it}from"./validators-CYQma1M4.js";import{r as d,w as rt,H as nt,o as m,f as I,e,b as t,d as a,v as n,x as r,n as z,c as f,F as L,z as $,j as dt,a6 as J,a7 as A,an as mt,i as X,R as pt,U as ct}from"./main-D18SjM8o.js";import{_ as _t}from"./AppTextarea-BBgzysSv.js";import{_ as vt}from"./AppAutocomplete-CJktx0hb.js";import{u as st}from"./applicationList-D7fD6HFZ.js";import{_ as ft}from"./TablePagination-BaobEI1m.js";import{_ as yt}from"./AppSelect-CzYaMipO.js";import{u as gt,f as lt}from"./format-DEnD-IsH.js";import{f as Vt,g as wt}from"./helpers-6_Vkkyle.js";import{V as H}from"./VCardText-DZIDicOU.js";import{V as St}from"./VDivider-CSUkZSbR.js";import{V as Ct}from"./VDataTableServer-DlJyLh7x.js";import{V as bt}from"./VChip-Hc-TXFBc.js";import{V as F,b as W,d as Y}from"./VCard--LWezGZw.js";/* empty css                         */import At from"./details-document-SmuCCBln.js";import{_ as ht}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as Z}from"./VDialog-D44nnjZC.js";import{V as tt}from"./VForm-CCuroRNG.js";import{V as E}from"./form-Dildnxco.js";import{V as kt}from"./VFileInput-C6j6ttHd.js";import{V as et}from"./VSpacer-C1sLtjzV.js";import{V as Ut}from"./VTextField-C8tSfTKw.js";import{V as Dt,a as N}from"./VTabs-D_AI02fW.js";import{V as $t,a as P}from"./VWindowItem-DS5koLSa.js";import{V as K,a as D}from"./VRow--BqiF0XQ.js";import{V as ot}from"./VTable-doi8TZUB.js";/* empty css                   */import"./VCounter-DjLiRu6x.js";import"./index-WMrVuzwm.js";import"./index-DFlKVI-p.js";import"./VField-DWPZ7GDO.js";import"./easing-CjukEv2V.js";import"./VInput-C1-GBOSd.js";import"./forwardRefs-C-GTDzx5.js";import"./VSelect-Bqari_qV.js";import"./VList-CTIFt7-l.js";import"./ssrBoot-fEReWUYU.js";import"./VAvatar-W9lvtYXi.js";import"./VImg-CHKlhm0_.js";import"./dialog-transition-Cw8hunBr.js";import"./VMenu-BMd_ZTs_.js";import"./VOverlay-BYzqhk2P.js";import"./lazy-B1UVp5Fh.js";import"./scopeId-BuTrgiUd.js";import"./VCheckboxBtn-BwmbKQER.js";import"./VSelectionControl-qM0g-Obg.js";import"./filter-BPN1mtWh.js";import"./api-Ct7LI-nj.js";import"./index-B3bPRkoL.js";import"./VPagination-SwCjjQQr.js";import"./VDataTable-Dr8d1lBZ.js";import"./VSlideGroup-Dgpu8o_8.js";import"./fileStore-BB3dZIc_.js";import"./submitApplication-DZDsWFRR.js";import"./filepond-plugin-image-preview.esm-BAJaIDcj.js";import"./sweetalert2-z6gKu1nJ.js";/* empty css              */const Lt={class:"d-flex justify-space-between flex-wrap gap-6"},xt={class:"me-3 d-flex gap-3"},Tt=a("br",null,null,-1),Mt={key:0},jt={__name:"ApplicationActivityLog",props:{applicationId:{type:String,required:!0}},setup(x){const G=x,U=gt(),w=d([]),c=d(!1),S=d(0),v=d(1),_=d(10),h=d(""),T=d(null),C=[{title:"Date",key:"created_at",sortable:!0},{title:"User",key:"user",sortable:!0},{title:"Activity Type",key:"description",sortable:!0},{title:"Details",key:"details",sortable:!1},{title:"IP Address",key:"ip_address",sortable:!1}],V=async()=>{c.value=!0;try{U.setPage(v.value),U.setPerPage(_.value),U.setActivityType(T.value),U.setSearchQuery(h.value);const u=await U.fetchApplicationActivityLogs(G.applicationId);w.value=u.data.data.map(i=>({...i,created_at:lt(new Date(i.created_at),"yyyy-MM-dd HH:mm:ss"),ip_address:i.properties.ip||"N/A",details:R(i),user:i.user?i.user.name:"System"})),S.value=u.data.total}catch(u){console.error("Error fetching activity logs:",u)}finally{c.value=!1}},q=st(),B=d([]),R=u=>{switch(u.description){case"application_submit":return`Submitted application #${u.properties.application_id}`;case"application_update":return`Updated application #${u.properties.application_id}`;case"document_upload":return`Uploaded document: ${u.properties.document_name||"Unknown"}`;case"comment_added":return`Added comment to application #${u.properties.application_id||"Unknown"}`;case"application_status_update":const i=b(u.properties.old_status),k=b(u.properties.new_status);return`Updated status from ${i} to ${k}`;default:return u.description||"Performed an action"}},b=u=>{const i=B.value.find(k=>k.id===parseInt(u));return i?i.name:"Unknown"},M=u=>{switch(u){case"application_submit":return"primary";case"application_update":return"info";case"document_upload":return"success";case"comment_added":return"warning";case"application_status_update":return"error";default:return"default"}},g=u=>{v.value=u.page,_.value=u.itemsPerPage,u.sortBy&&u.sortBy.length>0&&U.setSorting(u.sortBy[0].key,u.sortBy[0].order),V()};rt([h,T],()=>{v.value=1,V()}),nt(async()=>{await V(),await Q()});const Q=async()=>{const u=await q.getAllApplicationStatuses();B.value=u.data};return(u,i)=>{const k=yt,O=ft;return m(),I(F,{title:"Application Activity Log",class:"mt-5"},{default:e(()=>[t(H,null,{default:e(()=>[a("div",Lt,[a("div",xt,[t(k,{modelValue:_.value,"onUpdate:modelValue":[i[0]||(i[0]=s=>_.value=s),i[1]||(i[1]=s=>_.value=parseInt(s,10))],items:[{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:"100"},{value:-1,title:"All"}],style:{"inline-size":"6.25rem"}},null,8,["modelValue"])])])]),_:1}),t(St),t(Ct,{"items-per-page":_.value,"onUpdate:itemsPerPage":i[3]||(i[3]=s=>_.value=s),page:v.value,"onUpdate:page":i[4]||(i[4]=s=>v.value=s),items:w.value,"items-length":S.value,headers:C,loading:c.value,class:"text-no-wrap","onUpdate:options":g},{"item.description":e(({item:s})=>[t(bt,{color:M(s.description),size:"small"},{default:e(()=>[n(r(z(Vt)(s.description)),1)]),_:2},1032,["color"])]),"item.user":e(({item:s})=>[n(r(s.user),1)]),"item.created_at":e(({item:s})=>[n(r(z(lt)(new Date(s.created_at),"dd MMM yyyy HH:mm:ss")),1)]),"item.ip_address":e(({item:s})=>[n(r(s.properties.ip),1)]),"item.details":e(({item:s})=>[s.description==="application_status_update"?(m(),f(L,{key:0},[n(" Updated "+r(s.properties.old_status)+" to "+r(s.properties.new_status)+" ",1),Tt,s.properties.comment?(m(),f("span",Mt," Comment: "+r(s.properties.comment),1)):$("",!0)],64)):s.description==="comment_added"?(m(),f(L,{key:1},[n(r(s.properties.comment),1)],64)):s.description==="university_communication_added"?(m(),f(L,{key:2},[n(" Subject: "+r(s.properties.subject),1)],64)):(m(),f(L,{key:3},[n(r(s.properties.details||"N/A"),1)],64))]),bottom:e(()=>[t(O,{page:v.value,"onUpdate:page":i[2]||(i[2]=s=>v.value=s),"items-per-page":_.value,"total-items":S.value},null,8,["page","items-per-page","total-items"])]),_:1},8,["items-per-page","page","items","items-length","loading"])]),_:1})}}},y=x=>(pt("data-v-216ff5a0"),x=x(),ct(),x),Nt=y(()=>a("td",null,[a("strong",null,"Application Id")],-1)),Pt=y(()=>a("td",null,[a("strong",null,"Date Added")],-1)),It=y(()=>a("td",null,[a("strong",null,"Student ID")],-1)),Ht=y(()=>a("td",null,[a("strong",null,"Student Passport No.")],-1)),Bt=y(()=>a("td",null,[a("strong",null,"Student Name")],-1)),Et=y(()=>a("td",null,[a("strong",null,"Student Date of Birth")],-1)),Ft=y(()=>a("td",null,[a("strong",null,"Student E-Mail")],-1)),zt=y(()=>a("td",null,[a("strong",null,"Student Phone No.")],-1)),qt=y(()=>a("td",null,[a("strong",null,"Communication E-Mail ID")],-1)),Rt=y(()=>a("td",null,[a("strong",null,"Communication Phone No.")],-1)),Qt=y(()=>a("thead",null,[a("tr",null,[a("th",null,"Date Added"),a("th",null,"Comment"),a("th",null,"Status and Document")])],-1)),Ot=["innerHTML"],Wt={key:0,class:"current-status-label"},Kt={key:1},Gt=["href"],Jt={class:"comment-section"},Xt={class:"comment-header"},Yt={class:"comment-date"},Zt=["innerHTML"],te={class:"comment-section"},ee={class:"comment-header"},ae={class:"comment-date"},le={class:"communication-subject"},oe=y(()=>a("strong",null,"Subject:",-1)),ne={class:"comment-body"},se=["innerHTML"],ue={__name:"details",setup(x){const G=d(wt()==="admin"),w=dt().params.id,c=st(),S=d("student-course-details"),v=d(!1),_=d(!1),h=d(!1),T=d(""),C=d(""),V=d({subject:"",message:""});d([{name:"Document1.pdf",progress:100},{name:"Document2.pdf",progress:100},{name:"Document3.pdf",progress:100},{name:"Document4.pdf",progress:100}]);const q=d([]),B=d([]),R=d([{created_at:"",comment:"",status_text:""}]),b=d({application_id:"",created_at:"",counsellor_email:"",counsellor_number:""}),M=d();d(!0);const g=d({id:null,student_id:null,first_name:null,last_name:null,passport_no:null,date_of_birth:null,whatsapp_number:null,email:null,address:null,city:null,country:null,region:null,state:null,gender:null,visa_refusal:null,created_at:null,updated_at:null,document:[{id:null,student_id:null,path:null,created_at:null,updated_at:null}]}),Q=d([]),u=d([]);nt(async()=>{await i()});const i=async()=>{await c.getApplicationDetails(w),await c.getApplicationStatusses(w),await c.getApplicationAllStatuses(),b.value=c.applicationData,Q.value=c.documents,g.value=c.students,R.value=c.statuses,q.value=c.comments,B.value=c.universityCommunications,u.value=c.allStatuses.filter(p=>p.id!==b.value.status)},k=async()=>{try{let p=new FormData;p.append("status",T.value),p.append("comment",C.value),M.value&&p.append("file",M.value[0]),await c.updateStatus(w,p),v.value=!1,await i()}catch(p){console.error("Error updating status:",p)}},O=async()=>{try{await c.addComment(w,C.value),C.value="",_.value=!1,await i()}catch(p){console.error("Error adding comment:",p)}},s=async()=>{try{await c.addUniversityCommunication(w,V.value),V.value={subject:"",message:""},h.value=!1,await i()}catch(p){console.error("Error adding university communication:",p)}};return(p,o)=>{const ut=vt,at=_t;return m(),I(F,null,{default:e(()=>[t(W,null,{default:e(()=>[n("Application Details")]),_:1}),t(H,null,{default:e(()=>[t(Z,{modelValue:v.value,"onUpdate:modelValue":o[4]||(o[4]=l=>v.value=l),"max-width":"500px"},{default:e(()=>[t(F,null,{default:e(()=>[t(W,null,{default:e(()=>[n("Change Current Status")]),_:1}),t(H,null,{default:e(()=>[t(tt,{onSubmit:J(k,["prevent"])},{default:e(()=>[t(ut,{modelValue:T.value,"onUpdate:modelValue":o[0]||(o[0]=l=>T.value=l),items:u.value,"item-title":l=>l.name,"item-value":l=>l.id,label:"Status",placeholder:"Select Status",rules:["requiredValidator"in p?p.requiredValidator:z(it)]},null,8,["modelValue","items","item-title","item-value","rules"]),t(E,{class:"mt-2"},{default:e(()=>[n("Add any necessary file (Optional)")]),_:1}),t(kt,{modelValue:M.value,"onUpdate:modelValue":o[1]||(o[1]=l=>M.value=l),color:"primary",label:"File input",variant:"outlined",class:"mt-2"},null,8,["modelValue"]),t(E,{class:"mt-2"},{default:e(()=>[n("Comment (Optional)")]),_:1}),t(at,{modelValue:C.value,"onUpdate:modelValue":o[2]||(o[2]=l=>C.value=l),placeholder:"Place any comment regarding status"},null,8,["modelValue"])]),_:1})]),_:1}),t(Y,null,{default:e(()=>[t(et),t(A,{color:"primary",onClick:k},{default:e(()=>[n("Submit")]),_:1}),t(A,{onClick:o[3]||(o[3]=l=>v.value=!1)},{default:e(()=>[n("Cancel")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(Z,{modelValue:_.value,"onUpdate:modelValue":o[7]||(o[7]=l=>_.value=l),"max-width":"500px"},{default:e(()=>[t(F,null,{default:e(()=>[t(W,null,{default:e(()=>[n("Add a New Comment")]),_:1}),t(H,null,{default:e(()=>[t(tt,{onSubmit:J(O,["prevent"])},{default:e(()=>[t(E,{class:"mt-2"},{default:e(()=>[n("New Comment")]),_:1}),t(at,{modelValue:C.value,"onUpdate:modelValue":o[5]||(o[5]=l=>C.value=l),placeholder:"Add a new comment",class:"mt-2"},null,8,["modelValue"])]),_:1})]),_:1}),t(Y,null,{default:e(()=>[t(et),t(A,{color:"primary",onClick:O},{default:e(()=>[n("Submit Comment")]),_:1}),t(A,{onClick:o[6]||(o[6]=l=>_.value=!1)},{default:e(()=>[n("Cancel")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(Z,{modelValue:h.value,"onUpdate:modelValue":o[11]||(o[11]=l=>h.value=l),"max-width":"500px"},{default:e(()=>[t(F,null,{default:e(()=>[t(W,null,{default:e(()=>[n("Add a New University Communication")]),_:1}),t(H,null,{default:e(()=>[t(tt,{onSubmit:J(s,["prevent"])},{default:e(()=>[t(E,{class:"mt-2"},{default:e(()=>[n("Subject")]),_:1}),t(Ut,{modelValue:V.value.subject,"onUpdate:modelValue":o[8]||(o[8]=l=>V.value.subject=l),placeholder:"Subject",class:"mt-2"},null,8,["modelValue"]),t(E,{class:"mt-2"},{default:e(()=>[n("Message")]),_:1}),t(z(mt),{theme:"snow",content:V.value.message,"onUpdate:content":o[9]||(o[9]=l=>V.value.message=l),"content-type":"html",class:"mt-2"},null,8,["content"])]),_:1})]),_:1}),t(Y,null,{default:e(()=>[t(et),t(A,{color:"primary",onClick:s},{default:e(()=>[n("Submit Communication")]),_:1}),t(A,{onClick:o[10]||(o[10]=l=>h.value=!1)},{default:e(()=>[n("Cancel")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(Dt,{modelValue:S.value,"onUpdate:modelValue":o[12]||(o[12]=l=>S.value=l)},{default:e(()=>[t(N,{value:"student-course-details"},{default:e(()=>[n("Student/Course Details")]),_:1}),t(N,{value:"upload-download"},{default:e(()=>[n("Upload/Download")]),_:1}),t(N,{value:"status"},{default:e(()=>[n("Status")]),_:1}),t(N,{value:"comments"},{default:e(()=>[n("Comments")]),_:1}),t(N,{value:"university-communication"},{default:e(()=>[n("University Communication")]),_:1}),G.value?(m(),I(N,{key:0,value:"activity-logs"},{default:e(()=>[n("Activity Logs")]),_:1})):$("",!0)]),_:1},8,["modelValue"]),t(H,null,{default:e(()=>[t($t,{modelValue:S.value,"onUpdate:modelValue":o[16]||(o[16]=l=>S.value=l)},{default:e(()=>[t(P,{value:"student-course-details"},{default:e(()=>[t(K,null,{default:e(()=>[t(D,{cols:"12"},{default:e(()=>[t(ot,null,{default:e(()=>[a("tbody",null,[a("tr",null,[Nt,a("td",null,r(b.value.application_id),1),Pt,a("td",null,r(b.value.created_at),1)]),a("tr",null,[It,a("td",null,r(g.value.student_id??""),1),Ht,a("td",null,r(g.value.passport_no),1)]),a("tr",null,[Bt,a("td",null,r(g.value.first_name)+" "+r(g.value.last_name),1),Et,a("td",null,r(g.value.date_of_birth),1)]),a("tr",null,[Ft,a("td",null,r(g.value.email),1),zt,a("td",null,r(g.value.whatsapp_number),1)]),a("tr",null,[qt,a("td",null,r(b.value.counsellor_email),1),Rt,a("td",null,r(b.value.counsellor_number),1)])])]),_:1})]),_:1})]),_:1})]),_:1}),t(P,{value:"upload-download"},{default:e(()=>[t(At,{"existing-documents":Q.value,"zip-link":g.value.document_zip_link},null,8,["existing-documents","zip-link"])]),_:1}),t(P,{value:"status"},{default:e(()=>[t(K,null,{default:e(()=>[t(D,{cols:"12",class:"d-flex justify-end"},{default:e(()=>[S.value==="status"&&p.$can("status","application")?(m(),I(A,{key:0,onClick:o[13]||(o[13]=l=>v.value=!0),color:"primary"},{default:e(()=>[n(" Change Current Status ")]),_:1})):$("",!0)]),_:1}),t(D,{cols:"12"},{default:e(()=>[t(ot,null,{default:e(()=>[Qt,a("tbody",null,[(m(!0),f(L,null,X(R.value,(l,j)=>(m(),f("tr",{key:j},[a("td",null,r(l.created_at),1),a("td",null,r(l.comment),1),a("td",null,[a("div",null,[a("span",{innerHTML:l.status_text},null,8,Ot),j===0?(m(),f("span",Wt,"(Current Status)")):$("",!0),l.document?(m(),f("div",Kt,[a("div",null,r(l.file_name),1),a("a",{href:l.document,target:"_blank",class:"download-link"},"Document",8,Gt)])):$("",!0)])])]))),128))])]),_:1})]),_:1})]),_:1})]),_:1}),t(P,{value:"comments"},{default:e(()=>[t(K,null,{default:e(()=>[t(D,{cols:"12",class:"d-flex justify-end"},{default:e(()=>[p.$can("comment","application")?(m(),I(A,{key:0,onClick:o[14]||(o[14]=l=>_.value=!0),color:"primary"},{default:e(()=>[n("Add New Comment")]),_:1})):$("",!0)]),_:1}),t(D,{cols:"12"},{default:e(()=>[a("div",Jt,[(m(!0),f(L,null,X(q.value,(l,j)=>(m(),f("div",{key:j,class:"comment"},[a("div",Xt,[a("span",Yt,r(l.created_at),1)]),a("div",{class:"comment-body",innerHTML:l.comment_with_user},null,8,Zt)]))),128))])]),_:1})]),_:1})]),_:1}),t(P,{value:"university-communication"},{default:e(()=>[t(K,null,{default:e(()=>[t(D,{cols:"12",class:"d-flex justify-end"},{default:e(()=>[p.$can("university_communication","application")?(m(),I(A,{key:0,onClick:o[15]||(o[15]=l=>h.value=!0),color:"primary"},{default:e(()=>[n("Add New Communication")]),_:1})):$("",!0)]),_:1}),t(D,{cols:"12"},{default:e(()=>[a("div",te,[(m(!0),f(L,null,X(B.value,(l,j)=>(m(),f("div",{key:j,class:"comment"},[a("div",ee,[a("span",ae,r(l.created_at),1)]),a("div",le,[oe,n(" "+r(l.subject),1)]),a("div",ne,[a("div",{innerHTML:l.message},null,8,se)])]))),128))])]),_:1})]),_:1})]),_:1}),t(P,{value:"activity-logs"},{default:e(()=>[t(jt,{"application-id":z(w)},null,8,["application-id"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})}}},pa=ht(ue,[["__scopeId","data-v-216ff5a0"]]);export{pa as default};
