import{r as ee}from"./validators-IgT9dpV5.js";import{r as o,H as te,w as le,o as ae,c as re,b as e,d as g,e as a,v as i,a6 as oe,n as k,a7 as y,a1 as v,F as se}from"./main-Bu07ZU8n.js";import{_ as ie}from"./TablePagination-VJ3OGJE_.js";import{_ as ne}from"./AppTextField-DvNF0h3r.js";import{_ as ue}from"./AppSelect-Cv_ayy5q.js";import{_ as me}from"./AppAutocomplete-D-a7iESL.js";import{u as de}from"./rolePermission-ICGceqAs.js";import{u as pe}from"./user-D7IkvN3Q.js";import ce from"./AddNewUserDrawer-DAR4uGQl.js";import fe from"./EditNewUserDrawer-DUyH7QWB.js";import{S as n}from"./sweetalert2-z6gKu1nJ.js";import{V as h,b as F,d as ve,a as Ve}from"./VCard-Bvr6JzHJ.js";import{V as D}from"./VCardText-BZRdhyJL.js";import{V as _e}from"./VForm-CDQsog1Y.js";import{V as N}from"./VSpacer-BKjvkR1x.js";import{V as we}from"./VDialog-CTvqhvK8.js";import{V as Ue,a as L}from"./VRow-CcJHtXmu.js";import{V as q}from"./VDivider-B-w6e9DO.js";import{V as ge}from"./VDataTableServer-BeEIf5qx.js";import{V as ye}from"./VMenu-CbjP9zWg.js";import{V as be,a as b,b as C}from"./VList-BoOkByxF.js";import"./helpers-CK0esMst.js";import"./VPagination-CIkWD7Un.js";import"./form-CeZMlzEl.js";import"./VTextField-CgNrjLSL.js";/* empty css                   */import"./VCounter-88fyL_8t.js";import"./index-Cg1gnPv9.js";import"./index-Bbm3NaZh.js";import"./VField-BjXYh3HS.js";import"./easing-CjukEv2V.js";import"./VInput-0s04WhYE.js";import"./forwardRefs-C-GTDzx5.js";import"./VSelect-iBvLADqF.js";import"./dialog-transition-CQvS1h-u.js";import"./VOverlay-BYik6_Ks.js";import"./lazy-BLhCTXJN.js";import"./scopeId-BWXbeajJ.js";import"./VCheckboxBtn-DuL6jGPW.js";import"./VSelectionControl-CwyugBES.js";import"./VAvatar-TDvewQ4F.js";import"./VImg-hiYjhe04.js";import"./VChip-DBxCZLKZ.js";import"./VSlideGroup-sZKotdKY.js";import"./filter-wKdPDQrT.js";import"./api-DsgGwMm2.js";import"./index-B3bPRkoL.js";import"./AppDrawerHeaderSection-BRbiHfMJ.js";import"./auth-B185rOMv.js";import"./vue3-perfect-scrollbar.esm-Dzk1DxUq.js";import"./VNavigationDrawer-DUbtkxFO.js";import"./ssrBoot-8l8iwP5d.js";import"./VCheckbox-DiysMeg0.js";/* empty css              */import"./VDataTable-DeOXc9a3.js";import"./VTable-jJCx2jRJ.js";const Ce={class:"me-3 d-flex gap-3"},xe={class:"app-user-search-filter d-flex align-center flex-wrap gap-4"},Se={style:{"inline-size":"15.625rem"}},Bt={__name:"index",setup(Pe){const u=pe(),B=de(),x=o(!1),V=o([]),S=o(0),m=o(10),d=o(1),M=o(),z=o(),_=o(""),w=o(),U=o(null);o(),o();const A=o(!1),$=o([]),P=o(!1),E=o(null),p=o(!1),c=o(null),T=o(null),H=r=>{T.value=r,c.value=r.parent_id||"",p.value=!0},I=async()=>{if(!c.value)return;const r=await u.setParent(T.value.id,c.value);r.success?(f(),n.fire("Success!",r.message,"success"),p.value=!1):n.fire("Error!",r.message,"error")},Q=r=>{console.log(r);const l=V.value.findIndex(s=>s.id===r.id);l!==-1&&V.value.splice(l,1,r)},Y=r=>{j(r)},j=r=>{E.value=r,P.value=!0},f=async()=>{A.value=!0;try{const r=await u.fetchUsers(d.value,_.value,w.value,U.value);V.value=r.data,S.value=r.total}catch(r){console.error("Error fetching users:",r)}finally{A.value=!1}},G=async r=>{try{await f(),n.fire("Success!","User added successfully!","success")}catch(l){console.error("Error adding user:",l),n.fire("Error!","Failed to add user.","error")}},J=async r=>{if((await n.fire({title:"Are you sure?",text:"Do you want to delete this user?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel"})).isConfirmed){const s=await u.deleteUser(r);s.success?n.fire("Deleted!",s.message,"success"):n.fire("Error!",s.message,"error")}},K=r=>{var l,s;M.value=(l=r.sortBy[0])==null?void 0:l.key,z.value=(s=r.sortBy[0])==null?void 0:s.order,f()},W=[{title:"Name",key:"full_name"},{title:"Email",key:"email"},{title:"Role",key:"role"},{title:"Parent",key:"parent.full_name"},{title:"Record Count",key:"record_count"},{title:"Actions",key:"actions",sortable:!1}];return te(async()=>{await B.getAllRoles(),$.value=B.roles,await u.fetchParentUsers(),f()}),le([_,w,U],()=>{f()}),(r,l)=>{const s=me,O=ue,X=ne,Z=ie;return ae(),re(se,null,[e(fe,{isDrawerOpen:P.value,editedUser:E.value,"onUpdate:isDrawerOpen":l[0]||(l[0]=t=>P.value=t),onUserUpdated:Q},null,8,["isDrawerOpen","editedUser"]),g("section",null,[e(we,{modelValue:p.value,"onUpdate:modelValue":l[3]||(l[3]=t=>p.value=t),"max-width":"500px"},{default:a(()=>[e(h,null,{default:a(()=>[e(F,null,{default:a(()=>[i("Set Parent")]),_:1}),e(D,null,{default:a(()=>[e(_e,{onSubmit:oe(I,["prevent"])},{default:a(()=>[e(s,{modelValue:c.value,"onUpdate:modelValue":l[1]||(l[1]=t=>c.value=t),items:k(u).parentUsers,"item-title":t=>t.full_name,"item-value":t=>t.id,label:"Parent",placeholder:"Select Parent",rules:["requiredValidator"in r?r.requiredValidator:k(ee)]},null,8,["modelValue","items","item-title","item-value","rules"])]),_:1})]),_:1}),e(ve,null,{default:a(()=>[e(N),e(y,{color:"primary",onClick:I},{default:a(()=>[i("Submit")]),_:1}),e(y,{onClick:l[2]||(l[2]=t=>p.value=!1)},{default:a(()=>[i("Cancel")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(h,{class:"mb-6"},{default:a(()=>[e(Ve,{class:"pb-4"},{default:a(()=>[e(F,null,{default:a(()=>[i("Filters")]),_:1})]),_:1}),e(D,null,{default:a(()=>[e(Ue,null,{default:a(()=>[e(L,{cols:"12",sm:"4"},{default:a(()=>[e(O,{modelValue:w.value,"onUpdate:modelValue":l[4]||(l[4]=t=>w.value=t),placeholder:"Select Role",items:$.value,clearable:"","clear-icon":"tabler-x","item-title":t=>t.role,"item-value":t=>t.role},null,8,["modelValue","items","item-title","item-value"])]),_:1}),e(L,{cols:"12",sm:"4"},{default:a(()=>[e(s,{modelValue:U.value,"onUpdate:modelValue":l[5]||(l[5]=t=>U.value=t),placeholder:"Select Parent",items:k(u).parentUsers,clearable:"","clear-icon":"tabler-x","item-title":t=>t.full_name,"item-value":t=>t.id},null,8,["modelValue","items","item-title","item-value"])]),_:1})]),_:1})]),_:1}),e(q),e(D,{class:"d-flex flex-wrap gap-4"},{default:a(()=>[g("div",Ce,[e(O,{"model-value":m.value,items:[{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:100},{value:-1,title:"All"}],style:{"inline-size":"6.25rem"},"onUpdate:modelValue":l[6]||(l[6]=t=>m.value=parseInt(t,10))},null,8,["model-value"])]),e(N),g("div",xe,[g("div",Se,[e(X,{modelValue:_.value,"onUpdate:modelValue":l[7]||(l[7]=t=>_.value=t),placeholder:"Search User"},null,8,["modelValue"])]),e(y,{"prepend-icon":"tabler-plus",onClick:l[8]||(l[8]=t=>x.value=!0)},{default:a(()=>[i(" Add New User ")]),_:1})])]),_:1}),e(q),e(ge,{"items-per-page":m.value,"onUpdate:itemsPerPage":l[10]||(l[10]=t=>m.value=t),page:d.value,"onUpdate:page":l[11]||(l[11]=t=>d.value=t),items:V.value,"items-length":S.value,headers:W,class:"text-no-wrap","show-select":"","onUpdate:options":K},{"item.actions":a(({item:t})=>[e(y,{icon:"",variant:"text",color:"medium-emphasis"},{default:a(()=>[e(v,{icon:"tabler-dots-vertical"}),e(ye,{activator:"parent"},{default:a(()=>[e(be,null,{default:a(()=>[e(b,{to:{name:"user-view-id",params:{id:t.id}}},{prepend:a(()=>[e(v,{icon:"tabler-eye"})]),default:a(()=>[e(C,null,{default:a(()=>[i("View")]),_:1})]),_:2},1032,["to"]),e(b,{onClick:R=>Y(t)},{prepend:a(()=>[e(v,{icon:"tabler-pencil"})]),default:a(()=>[e(C,null,{default:a(()=>[i("Edit")]),_:1})]),_:2},1032,["onClick"]),e(b,{onClick:R=>H(t)},{prepend:a(()=>[e(v,{icon:"tabler-pencil"})]),default:a(()=>[e(C,null,{default:a(()=>[i("Set Parent")]),_:1})]),_:2},1032,["onClick"]),e(b,{onClick:R=>J(t.id)},{prepend:a(()=>[e(v,{icon:"tabler-trash"})]),default:a(()=>[e(C,null,{default:a(()=>[i("Delete")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),bottom:a(()=>[e(Z,{page:d.value,"onUpdate:page":l[9]||(l[9]=t=>d.value=t),"items-per-page":m.value,"total-items":S.value},null,8,["page","items-per-page","total-items"])]),_:1},8,["items-per-page","page","items","items-length"])]),_:1}),e(ce,{isDrawerOpen:x.value,"onUpdate:isDrawerOpen":l[12]||(l[12]=t=>x.value=t),onUserData:G},null,8,["isDrawerOpen"])])],64)}}};export{Bt as default};
