import{r as Ue}from"./validators-CNXoXdHO.js";import{_ as ie}from"./AppTextarea-CCOT3gaI.js";import{_ as Ne}from"./AppAutocomplete-BX-75_ZM.js";import{V as W,b as X,c as ce,a as xe}from"./VCard-K6Atqr_5.js";import{V as R}from"./VCardText-C95nyFHd.js";import{V as Y}from"./VSpacer-KTNu1Dz4.js";import{r as o,w as pe,o as c,f as N,e as l,b as a,v as u,n as De,a9 as k,H as Ae,bL as se,c as S,z as U,a8 as Ie,d,x as r,F as oe,i as ne,a2 as K,J as $e}from"./main-Cc9ym1b4.js";import{V as me}from"./VDialog-CY3QhHNh.js";import{_ as Te}from"./TablePagination-CfQEMVFQ.js";import{_ as Be}from"./AppSelect-BZEZ65xi.js";import{_ as Fe}from"./Filters-D71jpXt2.js";import{u as ze}from"./leadStore-Drc8QUO4.js";/* empty css                         */import{c as Ee}from"./commonFunction-CLfw6fEx.js";import Me from"./upload-lead-DdVnZSva.js";import{V as He}from"./VRow-BVuxX-r0.js";import{V as Pe}from"./VForm-Dl8UzsZ8.js";import{V as qe}from"./VInput-D1FERqoD.js";import{V as ue}from"./VDivider-DIqqhsZs.js";import{V as Je}from"./VDataTableServer-BB3nwmQf.js";import{V as Q}from"./VChip-Bl_Mp0g8.js";import{V as Oe}from"./VMenu-1NDupjgg.js";import{V as Re,a as de,b as re}from"./VList-BpqTLlop.js";import"./helpers-EDWR3hkw.js";import"./forwardRefs-D3j0TLhE.js";import"./index-CTlvPYU1.js";import"./VSelect-BXLPibQk.js";import"./VTextField-NPbV2jFW.js";import"./dialog-transition-BqdSwXsS.js";import"./scopeId-DSwOxKvb.js";import"./VCheckboxBtn-DyRRspFv.js";import"./VAvatar-By7U6YR5.js";import"./VImg-CuMeNFaz.js";import"./filter-C5W54F6o.js";/* empty css              */import"./VPagination-CEYiZI_n.js";import"./AppDateTimePicker-B74iSiPT.js";import"./AppTextField-CkYfuaro.js";import"./rolePermission-DyV_Qn8k.js";import"./user-DepUDavd.js";import"./index-BJZAyQLF.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./VFileInput-CXX2vW2e.js";import"./index-9_xD3HKr.js";import"./VDataTable-ZiP0-ktD.js";import"./VTable-DLWQ4zMh.js";import"./ssrBoot-BQI-WCFh.js";const je={__name:"ChangeStatusDialog",props:{showDialog:Boolean,leadId:Number,statusId:Number,leadStatuses:Array,resolveLeadStatusName:Function},emits:["updateStatus","closeDialog"],setup(x,{emit:j}){const v=x,h=j,f=o(null),_=o("");pe(()=>v.showDialog,m=>{m&&(f.value=v.resolveLeadStatusName(v.statusId))});const w=()=>{h("closeDialog")},g=()=>{f.value!==null&&(h("updateStatus",{leadId:v.leadId,statusId:f.value,statusNote:_.value}),_.value="",w())};return(m,V)=>{const D=Ne,A=ie;return c(),N(me,{"model-value":v.showDialog,persistent:"",width:m.$vuetify.display.smAndDown?"auto":400,"onClick:outside":w},{default:l(()=>[a(W,null,{default:l(()=>[a(X,null,{default:l(()=>[u("Select New Status")]),_:1}),a(R,null,{default:l(()=>[a(D,{modelValue:f.value,"onUpdate:modelValue":V[0]||(V[0]=p=>f.value=p),items:x.leadStatuses,"item-title":p=>p.name,"item-value":p=>p.id,label:"Status",placeholder:"Select Status",rules:["requiredValidator"in m?m.requiredValidator:De(Ue)],clearable:""},null,8,["modelValue","items","item-title","item-value","rules"]),a(A,{modelValue:_.value,"onUpdate:modelValue":V[1]||(V[1]=p=>_.value=p),class:"mt-4",label:"Status Note (optional)",placeholder:"Enter status note",rows:"3"},null,8,["modelValue"])]),_:1}),a(ce,null,{default:l(()=>[a(Y),a(k,{color:"primary",onClick:g},{default:l(()=>[u("Update Status")]),_:1}),a(k,{text:"",onClick:w},{default:l(()=>[u("Cancel")]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value","width"])}}},Ge={class:"me-3 d-flex gap-3"},Ke={class:"app-user-search-filter d-flex align-center flex-wrap gap-4"},Qe={class:"d-flex flex-column ms-3"},We={class:"d-block font-weight-medium text-truncate text-high-emphasis"},Xe={class:"text-md"},Ye={style:{"list-style-type":"disc","padding-inline-start":"20px"}},Ze={style:{color:"#757575"}},et={style:{color:"#007acc"}},tt={style:{color:"orange"}},at=["onClick"],lt={key:0},st={style:{"list-style-type":"disc","padding-inline-start":"20px"}},ot={style:{color:"#757575"}},nt={style:{color:"#757575"}},ut={style:{color:"#007acc"}},dt={style:{color:"orange"}},rt=["onClick"],la={__name:"index",props:{userId:{type:String,default:null}},setup(x){const j=x;Ee();const v=o([]);Ae(async()=>{});const h=ze(),f=o([]),_=o(),w=o(!1),g=o(10),m=o(1),V=o(),D=o(),A=o(""),p=o(null),Z=o(null),I=o(null),$=o(null),T=o(!1),B=o(null),F=o(!1),b=o(!1),z=o(""),C=o(!1),E=se({}),ve=o(!1),M=o(null),H=o(null),P=o(null),q=o(null),fe=s=>{E[s]=!E[s]},J=o(null),_e=[{title:"Actions",key:"actions",sortable:!1},{title:"Lead Country",key:"lead_type"},{title:"Name",key:"name"},{title:"Phone",key:"phone"},{title:"Email",key:"email"},{title:"Interested Course & Country",key:"course_country"},{title:"Current Status",key:"status"},{title:"Status History",key:"statusHistory"},{title:"Assigned Status",key:"assigned_user"},{title:"Assigned User",key:"assigned_user.name_with_email"},{title:"Manager's Note",key:"notes"},{title:"Assigned Branch",key:"branch.branch_name_with_country"}];pe([A,p,I,$,M,H,P,q,J],()=>{L()});const L=async()=>{w.value=!0;try{const s=await h.getLeads(j.userId,m.value,g.value,A.value,V.value,D.value,p.value,I.value,$.value,M.value,H.value,P.value,q.value,J.value);f.value=s.data,_.value=s.total}catch(s){console.error("Error fetching leads:",s)}finally{w.value=!1}},ge=s=>{var t,i;L(),V.value=(t=s.sortBy[0])==null?void 0:t.key,D.value=(i=s.sortBy[0])==null?void 0:i.order},ee=(s,t,i)=>{B.value=s,Z.value=t,T.value=!0,i.value=i},ye=async({leadId:s,statusId:t,statusNote:i})=>{console.log("convertToStudent",ve.value);const G={status:t,status_note:i};await h.updateLeadStatus(s,G),await L(),T.value=!1},Se=s=>{const t=v.value.find(i=>i.id===s);return t?t.name:"Unknown Status"},we=s=>{const t=v.value.find(i=>i.id===s);return t?t.color_code:"#000"},te=async s=>{if(!s){console.error("Lead ID is required to add a note.");return}try{C.value=!0;const t={note:z.value};await h.addNoteToLead(s,t.note),z.value="",b.value=!1,await L()}catch(t){console.error("Error adding note:",t)}finally{C.value=!1}},O=se({}),Ve=s=>{O[s]=!O[s]},he=s=>{B.value=s,b.value=!0},ke=()=>{F.value=!F.value};return(s,t)=>{const i=Fe,G=ie,be=Be,Ce=Te,Le=je;return c(),S("section",null,[a(W,{class:"mb-6"},{default:l(()=>[s.$can("create","lead")?(c(),N(xe,{key:0,class:"pb-4"},{default:l(()=>[a(X,null,{default:l(()=>[u("Filter")]),_:1})]),_:1})):U("",!0),s.$can("create","lead")?(c(),N(R,{key:1},{default:l(()=>[a(He,null,{default:l(()=>[a(i,{"selected-assigned-status":M.value,"selected-lead-status":p.value,"selected-dateFrom":I.value,"selected-dateTo":$.value,"selected-lead-type":H.value,"selected-event":P.value,"selected-country":J.value,"selected-branch":q.value,onUpdateAssignedStatus:t[0]||(t[0]=e=>M.value=e),onUpdateLeadStatus:t[1]||(t[1]=e=>p.value=e),onUpdateDateFrom:t[2]||(t[2]=e=>I.value=e),onUpdateDateTo:t[3]||(t[3]=e=>$.value=e),onUpdateLeadType:t[4]||(t[4]=e=>H.value=e),onUpdateEvent:t[5]||(t[5]=e=>P.value=e),onUpdateCountry:t[6]||(t[6]=e=>J.value=e),onUpdateBranch:t[7]||(t[7]=e=>q.value=e),"country-label":"Lead Country"},null,8,["selected-assigned-status","selected-lead-status","selected-dateFrom","selected-dateTo","selected-lead-type","selected-event","selected-country","selected-branch"])]),_:1}),a(me,{modelValue:b.value,"onUpdate:modelValue":t[11]||(t[11]=e=>b.value=e),"max-width":"500px"},{default:l(()=>[a(W,null,{default:l(()=>[a(X,null,{default:l(()=>[u("Add a New Note")]),_:1}),a(R,null,{default:l(()=>[a(Pe,{onSubmit:Ie(te,["prevent"])},{default:l(()=>[a(qe,{class:"mt-2"},{default:l(()=>[u(" New Note ")]),_:1}),a(G,{modelValue:z.value,"onUpdate:modelValue":t[8]||(t[8]=e=>z.value=e),placeholder:"Add a new note",class:"mt-2"},null,8,["modelValue"])]),_:1})]),_:1}),a(ce,null,{default:l(()=>[a(Y),a(k,{color:"primary",loading:C.value,disabled:C.value,onClick:t[9]||(t[9]=()=>te(B.value))},{default:l(()=>[u(" Submit Note ")]),_:1},8,["loading","disabled"]),a(k,{disabled:C.value,onClick:t[10]||(t[10]=e=>b.value=!1)},{default:l(()=>[u(" Cancel ")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})):U("",!0),a(ue),a(R,{class:"d-flex flex-wrap gap-4"},{default:l(()=>[d("div",Ge,[a(be,{"model-value":g.value,items:[{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:100},{value:-1,title:"All"}],style:{"inline-size":"6.25rem"},"onUpdate:modelValue":t[12]||(t[12]=e=>g.value=parseInt(e,10))},null,8,["model-value"])]),a(Y),d("div",Ke,[s.$can("create","lead")?(c(),N(k,{key:0,"prepend-icon":"tabler-plus",onClick:ke},{default:l(()=>[u(" Upload Lead ")]),_:1})):U("",!0)]),a(Me,{showUploadCard:F.value,"onUpdate:showUploadCard":t[13]||(t[13]=e=>F.value=e),onLeadsUploaded:L},null,8,["showUploadCard"])]),_:1}),a(ue),a(Je,{"items-per-page":g.value,"onUpdate:itemsPerPage":t[15]||(t[15]=e=>g.value=e),page:m.value,"onUpdate:page":t[16]||(t[16]=e=>m.value=e),loading:w.value,"onUpdate:options":ge,"items-length":_.value,headers:_e,items:f.value,"item-value":"total",class:"text-no-wrap text-sm rounded-0"},{"item.lead_type":l(({item:e})=>{var n,y;return[d("span",null,r(e.lead_type==="social"?(n=e.lead_country)==null?void 0:n.name:(y=e.lead_event)==null?void 0:y.name),1)]}),"item.assigned_user":l(({item:e})=>[a(Q,{color:e.assigned_user?"success":"error",size:"small",class:"font-weight-medium",style:{color:"#000",cursor:"pointer"}},{default:l(()=>[u(r(e.assigned_user?"Assigned":"Unassigned"),1)]),_:2},1032,["color"])]),"item.course_country":l(({item:e})=>[d("div",Qe,[d("span",We,r(e.interested_course),1),d("span",Xe,r(e.interested_country),1)])]),"item.notes":l(({item:e})=>[d("ul",Ye,[(c(!0),S(oe,null,ne(E[e.id]?e.notes:e.notes.slice(0,2),(n,y)=>(c(),S("li",{key:n.id,class:"note",style:{"font-size":"1.1em","margin-block-end":"8px"}},[u(r(n.note)+" ( ",1),d("small",Ze,[d("span",et,r(n.created_by),1),u(", "),d("span",tt,r(n.created_at?new Date(n.created_at).toLocaleDateString():"N/A"),1)]),u(" ) ")]))),128))]),e.notes.length>2?(c(),S("p",{key:0,onClick:n=>fe(e.id),style:{color:"blue",cursor:"pointer","font-weight":"bold","padding-inline-start":"10px","text-decoration":"underline"}},r(E[e.id]?"Show Less":"Show More"),9,at)):U("",!0)]),"item.status":l(({item:e})=>{var n;return[a(Q,{color:((n=e.status)==null?void 0:n.color_code)||"#D3D3D3",size:"small",class:"font-weight-medium",style:{cursor:"pointer"},onClick:y=>{var ae,le;return ee(e.id,(ae=e.status)==null?void 0:ae.id,(le=e.status)==null?void 0:le.convert_to_student)}},{default:l(()=>{var y;return[u(r(((y=e.status)==null?void 0:y.name)||"Unknown Status"),1)]}),_:2},1032,["color","onClick"])]}),"item.assigned_branch":l(({item:e})=>[e.assigned_branch?(c(),S("span",lt,r(e.assigned_branch),1)):(c(),N(Q,{key:1,color:"error",size:"small",variant:"flat"},{default:l(()=>[u("Not Assigned")]),_:1}))]),"item.actions":l(({item:e})=>[a(k,{icon:"",variant:"text",color:"medium-emphasis",class:"action-button"},{default:l(()=>[a(K,{icon:"tabler-dots-vertical"}),a(Oe,{activator:"parent","open-on-hover":""},{default:l(()=>[a(Re,null,{default:l(()=>[a(de,{onClick:n=>ee(e.id,e.status),class:"change-status-option"},{prepend:l(()=>[a(K,{icon:"tabler-analyze"})]),default:l(()=>[a(re,null,{default:l(()=>[u("Change Status")]),_:1})]),_:2},1032,["onClick"]),a(de,{onClick:n=>he(e.id),class:"add-note-option"},{prepend:l(()=>[a(K,{icon:"tabler-clipboard-text"})]),default:l(()=>[a(re,null,{default:l(()=>[u("Add Note")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),"item.statusHistory":l(({item:e})=>[d("ul",st,[(c(!0),S(oe,null,ne(O[e.id]?e.status_history:e.status_history.slice(0,2),(n,y)=>(c(),S("li",{key:n.id,class:"status-history",style:{"font-size":"1.1em","margin-block-end":"8px"}},[d("span",{style:$e({color:we(n.status_id)})},r(n.status_name),5),u(" - "),d("span",ot,r(n.status_note),1),u(" ( "),d("small",nt,[d("span",ut,r(n.user_name),1),u(", "),d("span",dt,r(n.created_at),1)]),u(" ) ")]))),128))]),e.status_history.length>2?(c(),S("p",{key:0,onClick:n=>Ve(e.id),style:{color:"blue",cursor:"pointer","font-weight":"bold","padding-inline-start":"10px","text-decoration":"underline"}},r(O[e.id]?"Show Less":"Show More"),9,rt)):U("",!0)]),bottom:l(()=>[a(Ce,{page:m.value,"onUpdate:page":t[14]||(t[14]=e=>m.value=e),"items-per-page":g.value,"total-items":_.value},null,8,["page","items-per-page","total-items"])]),_:1},8,["items-per-page","page","loading","items-length","items"])]),_:1}),a(Le,{showDialog:T.value,leadId:B.value,statusId:Z.value,leadStatuses:v.value,resolveLeadStatusName:Se,onUpdateStatus:ye,onCloseDialog:t[17]||(t[17]=e=>T.value=!1)},null,8,["showDialog","leadId","statusId","leadStatuses"])])}}};export{la as default};
