import{r as xe}from"./validators-BfBMfxeh.js";import{_ as me}from"./AppTextarea-CCaGH2Fi.js";import{_ as Te}from"./AppAutocomplete-CrpGktJf.js";import{V as Y,b as Z,c as ve,a as $e}from"./VCard-DR8o-ry8.js";import{V as R}from"./VCardText-DdPoPC6k.js";import{V as ee}from"./VSpacer-BWhe8SvQ.js";import{r as o,w as fe,o as r,f as _,e as a,b as l,v as d,n as Fe,a9 as x,H as Ie,bL as de,c as b,z as g,a8 as Be,d as u,x as i,F as ue,i as re,a2 as W,J as ze}from"./main-yREKzWa3.js";import{V as ye}from"./VDialog-C7WDMWzD.js";import{_ as Ee}from"./TablePagination-pM2nNGzI.js";import{_ as Me}from"./AppTextField-DSYXqKAq.js";import{_ as He}from"./AppSelect-6DFTB4bF.js";import{_ as Pe}from"./Filters-ButuHoPh.js";import{u as qe}from"./leadStore-EwSZhDh3.js";/* empty css                         */import{c as Je}from"./commonFunction-JavNI6r1.js";import Oe from"./upload-lead-KJRv8Sda.js";import{u as Re}from"./useAbility-C7PEpV5F.js";import{V as je}from"./VRow-CXWRi666.js";import{V as Ge}from"./VForm-CITSsJ3z.js";import{V as Ke}from"./VInput-CX_A6WhG.js";import{V as ie}from"./VDivider-BMplZTgV.js";import{V as Qe}from"./VDataTableServer-CCXbInmO.js";import{V as X}from"./VChip-X-1QsvEu.js";import{V as We}from"./VMenu-m6jZ7zIq.js";import{V as Xe,a as pe,b as ce}from"./VList-CvKjHq0z.js";import"./helpers-CMtaXWnf.js";import"./forwardRefs-D3j0TLhE.js";import"./index-t5oxwAMG.js";import"./VSelect-BpTiYXCw.js";import"./VTextField-BG00MGzj.js";import"./dialog-transition-DvMT6qZF.js";import"./scopeId--cM6UE04.js";import"./VCheckboxBtn-DloNp0wj.js";import"./VAvatar-B7R4GMG_.js";import"./VImg-C38KahoZ.js";import"./filter-C4JFbaj2.js";/* empty css              */import"./VPagination-srqUlD4L.js";import"./AppDateTimePicker-ZRzgkvYI.js";import"./rolePermission-WK2NjaKK.js";import"./user-yjqBirvJ.js";import"./index-DoALn70t.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./VFileInput-DPrNSEtp.js";import"./index-CXcCxLHN.js";import"./VDataTable-Bj961VBc.js";import"./VTable-DEhZ2lJ5.js";import"./ssrBoot-CgfG2JAU.js";const Ye={__name:"ChangeStatusDialog",props:{showDialog:Boolean,leadId:Number,statusId:Number,leadStatuses:Array,resolveLeadStatusName:Function},emits:["updateStatus","closeDialog"],setup(j,{emit:G}){const f=j,C=G,y=o(null),U=o("");fe(()=>f.showDialog,c=>{c&&(y.value=f.resolveLeadStatusName(f.statusId))});const L=()=>{C("closeDialog")},T=()=>{y.value!==null&&(C("updateStatus",{leadId:f.leadId,statusId:y.value,statusNote:U.value}),U.value="",L())};return(c,v)=>{const B=Te,z=me;return r(),_(ye,{"model-value":f.showDialog,persistent:"",width:c.$vuetify.display.smAndDown?"auto":400,"onClick:outside":L},{default:a(()=>[l(Y,null,{default:a(()=>[l(Z,null,{default:a(()=>[d("Select New Status")]),_:1}),l(R,null,{default:a(()=>[l(B,{modelValue:y.value,"onUpdate:modelValue":v[0]||(v[0]=m=>y.value=m),items:f.leadStatuses,"item-title":m=>m.name,"item-value":m=>m.id,label:"Status",placeholder:"Select Status",rules:["requiredValidator"in c?c.requiredValidator:Fe(xe)],clearable:""},null,8,["modelValue","items","item-title","item-value","rules"]),l(z,{modelValue:U.value,"onUpdate:modelValue":v[1]||(v[1]=m=>U.value=m),class:"mt-4",label:"Status Note (optional)",placeholder:"Enter status note",rows:"3"},null,8,["modelValue"])]),_:1}),l(ve,null,{default:a(()=>[l(ee),l(x,{color:"primary",onClick:T},{default:a(()=>[d("Update Status")]),_:1}),l(x,{text:"",onClick:L},{default:a(()=>[d("Cancel")]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value","width"])}}},Ze={class:"me-3 d-flex gap-3"},et={class:"app-user-search-filter d-flex align-center flex-wrap gap-4"},tt={style:{"inline-size":"15.625rem"}},at={class:"d-flex flex-column ms-3"},lt={class:"d-block font-weight-medium text-truncate text-high-emphasis"},st={class:"text-md"},ot={style:{"list-style-type":"disc","padding-inline-start":"20px"}},nt={style:{color:"#757575"}},dt={style:{color:"#007acc"}},ut={style:{color:"orange"}},rt=["onClick"],it={key:0},pt={style:{"list-style-type":"disc","padding-inline-start":"20px"}},ct={style:{color:"#757575"}},mt={style:{color:"#757575"}},vt={style:{color:"#007acc"}},ft={style:{color:"orange"}},yt=["onClick"],pa={__name:"index",props:{userId:{type:String,default:null}},setup(j){const G=j,f=Je(),C=o([]);Ie(async()=>{Se()});const y=qe(),U=o([]),L=o(),T=o(!1),c=o(10),v=o(1),B=o(),z=o(),m=o(""),S=o(null),te=o(null),V=o(null),w=o(null),E=o(!1),M=o(null),H=o(!1),$=o(!1),P=o(""),F=o(!1),q=de({}),ae=o(!1),J=o(null),h=o(null),D=o(null),N=o(null),ge=s=>{q[s]=!q[s]},{can:K}=Re(),A=o(null),_e=[{title:"Actions",key:"actions",sortable:!1},{title:"Lead Country",key:"lead_type"},{title:"Current Status",key:"status"},{title:"Status History",key:"statusHistory"},{title:"Manager's Note",key:"notes"},{title:"Name",key:"name"},{title:"Phone",key:"phone"},{title:"Email",key:"email"},{title:"Interested Course & Country",key:"course_country"},...K("create","lead")?[{title:"Assigned Status",key:"assigned_user"}]:[],...K("edit","lead")?[{title:"Assigned User",key:"assigned_user.name_with_email"}]:[],...K("edit","lead")?[{title:"Assigned Branch",key:"branch.branch_name_with_country"}]:[]];fe([m,S,V,w,J,h,D,N,A],()=>{I()});const Se=async()=>{await f.getLeadStatus("",1,10,"","",null,!0),C.value=f.leadStatus},I=async()=>{T.value=!0;try{const s=await y.getLeads(G.userId,v.value,c.value,m.value,B.value,z.value,S.value,V.value,w.value,J.value,h.value,D.value,N.value,A.value);U.value=s.data,L.value=s.total}catch(s){console.error("Error fetching leads:",s)}finally{T.value=!1}},Ve=s=>{var t,p;I(),B.value=(t=s.sortBy[0])==null?void 0:t.key,z.value=(p=s.sortBy[0])==null?void 0:p.order},le=(s,t,p)=>{M.value=s,te.value=t,E.value=!0,ae.value=p},we=async({leadId:s,statusId:t,statusNote:p})=>{console.log("convertToStudent",ae.value);const Q={status:t,status_note:p};await y.updateLeadStatus(s,Q),await I(),E.value=!1},ke=s=>{const t=C.value.find(p=>p.id===s);return t?t.name:"Unknown Status"},be=s=>{const t=C.value.find(p=>p.id===s);return t?t.color_code:"#000"},se=async s=>{if(!s){console.error("Lead ID is required to add a note.");return}try{F.value=!0;const t={note:P.value};await y.addNoteToLead(s,t.note),P.value="",$.value=!1,await I()}catch(t){console.error("Error adding note:",t)}finally{F.value=!1}},O=de({}),Ce=s=>{O[s]=!O[s]},Ue=s=>{M.value=s,$.value=!0},Le=()=>{H.value=!H.value};return(s,t)=>{const p=Pe,Q=me,he=He,De=Me,Ne=Ee,Ae=Ye;return r(),b("section",null,[l(Y,{class:"mb-6"},{default:a(()=>[s.$can("create","lead")?(r(),_($e,{key:0,class:"pb-4"},{default:a(()=>[l(Z,null,{default:a(()=>[d("Filter")]),_:1})]),_:1})):g("",!0),s.$can("read","lead")?(r(),_(R,{key:1},{default:a(()=>[l(je,null,{default:a(()=>[s.$can("read","lead")&&!s.$can("edit","lead")?(r(),_(p,{key:0,"selected-lead-status":S.value,"selected-dateFrom":V.value,"selected-dateTo":w.value,onUpdateLeadStatus:t[0]||(t[0]=e=>S.value=e),onUpdateDateFrom:t[1]||(t[1]=e=>V.value=e),onUpdateDateTo:t[2]||(t[2]=e=>w.value=e)},null,8,["selected-lead-status","selected-dateFrom","selected-dateTo"])):g("",!0),s.$can("read","lead")&&s.$can("edit","lead")?(r(),_(p,{key:1,"selected-lead-status":S.value,"selected-dateFrom":V.value,"selected-dateTo":w.value,onUpdateLeadStatus:t[3]||(t[3]=e=>S.value=e),onUpdateDateFrom:t[4]||(t[4]=e=>V.value=e),onUpdateDateTo:t[5]||(t[5]=e=>w.value=e),"selected-lead-type":h.value,"selected-event":D.value,"selected-country":A.value,"selected-branch":N.value,onUpdateLeadType:t[6]||(t[6]=e=>h.value=e),onUpdateEvent:t[7]||(t[7]=e=>D.value=e),onUpdateCountry:t[8]||(t[8]=e=>A.value=e),onUpdateBranch:t[9]||(t[9]=e=>N.value=e),"country-label":"Lead Country"},null,8,["selected-lead-status","selected-dateFrom","selected-dateTo","selected-lead-type","selected-event","selected-country","selected-branch"])):g("",!0),s.$can("create","lead")&&s.$can("edit","lead")?(r(),_(p,{key:2,"selected-assigned-status":J.value,"selected-lead-status":S.value,"selected-dateFrom":V.value,"selected-dateTo":w.value,"selected-lead-type":h.value,"selected-event":D.value,"selected-country":A.value,"selected-branch":N.value,onUpdateAssignedStatus:t[10]||(t[10]=e=>J.value=e),onUpdateLeadStatus:t[11]||(t[11]=e=>S.value=e),onUpdateDateFrom:t[12]||(t[12]=e=>V.value=e),onUpdateDateTo:t[13]||(t[13]=e=>w.value=e),onUpdateLeadType:t[14]||(t[14]=e=>h.value=e),onUpdateEvent:t[15]||(t[15]=e=>D.value=e),onUpdateCountry:t[16]||(t[16]=e=>A.value=e),onUpdateBranch:t[17]||(t[17]=e=>N.value=e),"country-label":"Lead Country"},null,8,["selected-assigned-status","selected-lead-status","selected-dateFrom","selected-dateTo","selected-lead-type","selected-event","selected-country","selected-branch"])):g("",!0)]),_:1}),l(ye,{modelValue:$.value,"onUpdate:modelValue":t[21]||(t[21]=e=>$.value=e),"max-width":"500px"},{default:a(()=>[l(Y,null,{default:a(()=>[l(Z,null,{default:a(()=>[d("Add a New Note")]),_:1}),l(R,null,{default:a(()=>[l(Ge,{onSubmit:Be(se,["prevent"])},{default:a(()=>[l(Ke,{class:"mt-2"},{default:a(()=>[d(" New Note ")]),_:1}),l(Q,{modelValue:P.value,"onUpdate:modelValue":t[18]||(t[18]=e=>P.value=e),placeholder:"Add a new note",class:"mt-2"},null,8,["modelValue"])]),_:1})]),_:1}),l(ve,null,{default:a(()=>[l(ee),l(x,{color:"primary",loading:F.value,disabled:F.value,onClick:t[19]||(t[19]=()=>se(M.value))},{default:a(()=>[d(" Submit Note ")]),_:1},8,["loading","disabled"]),l(x,{disabled:F.value,onClick:t[20]||(t[20]=e=>$.value=!1)},{default:a(()=>[d(" Cancel ")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})):g("",!0),l(ie),l(R,{class:"d-flex flex-wrap gap-4"},{default:a(()=>[u("div",Ze,[l(he,{"model-value":c.value,items:[{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:100},{value:-1,title:"All"}],style:{"inline-size":"6.25rem"},"onUpdate:modelValue":t[22]||(t[22]=e=>c.value=parseInt(e,10))},null,8,["model-value"])]),l(ee),u("div",et,[u("div",tt,[l(De,{modelValue:m.value,"onUpdate:modelValue":t[23]||(t[23]=e=>m.value=e),placeholder:"Search ...","append-inner-icon":"tabler-search","single-line":"","hide-details":"",dense:"",outlined:""},null,8,["modelValue"])]),s.$can("create","lead")?(r(),_(x,{key:0,"prepend-icon":"tabler-plus",onClick:Le},{default:a(()=>[d(" Upload Lead ")]),_:1})):g("",!0)]),l(Oe,{showUploadCard:H.value,"onUpdate:showUploadCard":t[24]||(t[24]=e=>H.value=e),onLeadsUploaded:I},null,8,["showUploadCard"])]),_:1}),l(ie),l(Qe,{"items-per-page":c.value,"onUpdate:itemsPerPage":t[26]||(t[26]=e=>c.value=e),page:v.value,"onUpdate:page":t[27]||(t[27]=e=>v.value=e),loading:T.value,"onUpdate:options":Ve,"items-length":L.value,headers:_e,items:U.value,"item-value":"total",class:"text-no-wrap text-sm rounded-0"},{"item.lead_type":a(({item:e})=>{var n,k;return[u("span",null,i(e.lead_type==="social"?(n=e.lead_country)==null?void 0:n.name:(k=e.lead_event)==null?void 0:k.name),1)]}),"item.assigned_user":a(({item:e})=>[l(X,{color:e.assigned_user?"success":"error",size:"small",class:"font-weight-medium",style:{color:"#000",cursor:"pointer"}},{default:a(()=>[d(i(e.assigned_user?"Assigned":"Unassigned"),1)]),_:2},1032,["color"])]),"item.course_country":a(({item:e})=>[u("div",at,[u("span",lt,i(e.interested_course),1),u("span",st,i(e.interested_country),1)])]),"item.notes":a(({item:e})=>[u("ul",ot,[(r(!0),b(ue,null,re(q[e.id]?e.notes:e.notes.slice(0,2),(n,k)=>(r(),b("li",{key:n.id,class:"note",style:{"font-size":"1.1em","margin-block-end":"8px"}},[d(i(n.note)+" ( ",1),u("small",nt,[u("span",dt,i(n.created_by),1),d(", "),u("span",ut,i(n.created_at?new Date(n.created_at).toLocaleDateString():"N/A"),1)]),d(" ) ")]))),128))]),e.notes.length>2?(r(),b("p",{key:0,onClick:n=>ge(e.id),style:{color:"blue",cursor:"pointer","font-weight":"bold","padding-inline-start":"10px","text-decoration":"underline"}},i(q[e.id]?"Show Less":"Show More"),9,rt)):g("",!0)]),"item.status":a(({item:e})=>{var n;return[l(X,{color:((n=e.status)==null?void 0:n.color_code)||"#D3D3D3",size:"small",class:"font-weight-medium",style:{cursor:"pointer"},onClick:k=>{var oe,ne;return le(e.id,(oe=e.status)==null?void 0:oe.id,(ne=e.status)==null?void 0:ne.convert_to_student)}},{default:a(()=>{var k;return[d(i(((k=e.status)==null?void 0:k.name)||"Unknown Status"),1)]}),_:2},1032,["color","onClick"])]}),"item.assigned_branch":a(({item:e})=>[e.assigned_branch?(r(),b("span",it,i(e.assigned_branch),1)):(r(),_(X,{key:1,color:"error",size:"small",variant:"flat"},{default:a(()=>[d("Not Assigned")]),_:1}))]),"item.actions":a(({item:e})=>[l(x,{icon:"",variant:"text",color:"medium-emphasis",class:"action-button"},{default:a(()=>[l(W,{icon:"tabler-dots-vertical"}),l(We,{activator:"parent","open-on-hover":""},{default:a(()=>[l(Xe,null,{default:a(()=>[l(pe,{onClick:n=>le(e.id,e.status),class:"change-status-option"},{prepend:a(()=>[l(W,{icon:"tabler-analyze"})]),default:a(()=>[l(ce,null,{default:a(()=>[d("Change Status")]),_:1})]),_:2},1032,["onClick"]),s.$can("edit","lead")?(r(),_(pe,{key:0,onClick:n=>Ue(e.id),class:"add-note-option"},{prepend:a(()=>[l(W,{icon:"tabler-clipboard-text"})]),default:a(()=>[l(ce,null,{default:a(()=>[d("Add Note")]),_:1})]),_:2},1032,["onClick"])):g("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),"item.statusHistory":a(({item:e})=>[u("ul",pt,[(r(!0),b(ue,null,re(O[e.id]?e.status_history:e.status_history.slice(0,2),(n,k)=>(r(),b("li",{key:n.id,class:"status-history",style:{"font-size":"1.1em","margin-block-end":"8px"}},[u("span",{style:ze({color:be(n.status_id)})},i(n.status_name),5),d(" - "),u("span",ct,i(n.status_note),1),d(" ( "),u("small",mt,[u("span",vt,i(n.user_name),1),d(", "),u("span",ft,i(n.created_at),1)]),d(" ) ")]))),128))]),e.status_history.length>2?(r(),b("p",{key:0,onClick:n=>Ce(e.id),style:{color:"blue",cursor:"pointer","font-weight":"bold","padding-inline-start":"10px","text-decoration":"underline"}},i(O[e.id]?"Show Less":"Show More"),9,yt)):g("",!0)]),bottom:a(()=>[l(Ne,{page:v.value,"onUpdate:page":t[25]||(t[25]=e=>v.value=e),"items-per-page":c.value,"total-items":L.value},null,8,["page","items-per-page","total-items"])]),_:1},8,["items-per-page","page","loading","items-length","items"])]),_:1}),l(Ae,{showDialog:E.value,leadId:M.value,statusId:te.value,leadStatuses:C.value,resolveLeadStatusName:ke,onUpdateStatus:we,onCloseDialog:t[28]||(t[28]=e=>E.value=!1)},null,8,["showDialog","leadId","statusId","leadStatuses"])])}}};export{pa as default};
