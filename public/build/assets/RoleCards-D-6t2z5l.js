import{_ as G}from"./AppTextField-BuwY3xun.js";import{_ as J}from"./DialogCloseBtn-hOUlbjOF.js";import{u as H}from"./rolePermission-DHIcApvq.js";import{f as B}from"./helpers-BP7Yvknc.js";import{V as F}from"./VCard-SyZzayOh.js";import{V as $}from"./VCardText-D3cp6OXL.js";import{V as W}from"./VForm-Bh-R_-Sp.js";import{V as K}from"./VTable-C52H44W-.js";import{V as w}from"./VCheckbox-CaSWxK3W.js";import{r as f,H as L,a5 as q,w as j,o as c,f as Q,e as t,b as e,d as l,x as R,n as p,c as _,F as g,i as A,z,a7 as O,v as P,a as Y,a1 as Z,a3 as N}from"./main-DfnAMXlJ.js";import{V as ee}from"./VDialog-ChxiTvHd.js";import{a as E,V as M}from"./VRow-Dp8c7nXR.js";import{V as le}from"./VSpacer-CEMXC9aU.js";const se={class:"text-h4 text-center mb-2"},te=l("p",{class:"text-body-1 text-center mb-6"}," Set Role Permissions ",-1),oe=l("h5",{class:"text-h5 my-6"}," Role Permissions ",-1),ae={key:0},ne={class:"text-h6"},ie={class:"d-flex justify-end"},de={class:"d-flex justify-end"},re={class:"d-flex justify-end"},ue={class:"d-flex justify-end"},ce=l("h5",{class:"text-h5 my-6"}," Custom Permissions ",-1),me={class:"text-h6"},fe={colspan:"4"},_e={class:"d-flex justify-end"},pe={class:"d-flex align-center justify-center gap-4"},ve={__name:"AddEditRoleDialog",props:{rolePermissions:{type:Object,required:!1,default:()=>({id:"",name:"",permissions:[]})},isDialogVisible:{type:Boolean,required:!0}},emits:["update:isDialogVisible","update:rolePermissions"],setup(I,{emit:D}){const x=H(),a=f([]),m=f([]);L(async()=>{await x.getAllPermission(),a.value=x.permissions,console.log(a.value),a.value.forEach(s=>{m.value=[...new Set([...m.value,...Object.keys(s.custom_permissions||{})])]})});const d=I,v=D,h=f(!1),b=f(""),r=f(null),C=f(),y=q(()=>{let s=0;return a.value.forEach(i=>{Object.entries(i).forEach(([u,k])=>{u!=="name"&&k&&s++}),Object.values(i.custom_permissions||{}).forEach(u=>{u&&s++})}),s}),n=q(()=>y.value>0&&y.value<a.value.length*(4+m.value.length));j(h,s=>{a.value=a.value.map(i=>({...i,read:s,edit:s,create:s,delete:s,custom_permissions:Object.fromEntries(Object.entries(i.custom_permissions||{}).map(([u])=>[u,s]))}))}),j(n,()=>{n.value||(h.value=!1)}),j(a,()=>{y.value===a.value.length*(4+m.value.length)&&(h.value=!0)},{deep:!0}),j(d,()=>{d.rolePermissions&&d.rolePermissions.permissions.length&&(b.value=d.rolePermissions.name,r.value=d.rolePermissions.id,a.value=a.value.map(s=>{var u;const i=(u=d.rolePermissions)==null?void 0:u.permissions.find(k=>k.name===s.name);return i?{...s,...i,custom_permissions:{...s.custom_permissions,...i.custom_permissions||{}}}:s}))});const T=async()=>{var i;const s={id:r.value,name:b.value,permissions:a.value};try{await x.setRolePermission(s),v("update:rolePermissions",s),v("update:isDialogVisible",!1),v("roleSubmitted"),h.value=!1,(i=C.value)==null||i.reset()}catch(u){console.error("Failed to save role permissions:",u)}},S=()=>{var s;v("update:isDialogVisible",!1),h.value=!1,(s=C.value)==null||s.reset()};return(s,i)=>{const u=J,k=G;return c(),Q(ee,{width:s.$vuetify.display.smAndDown?"auto":900,"model-value":d.isDialogVisible,"onUpdate:modelValue":S},{default:t(()=>[e(u,{onClick:S}),e(F,{class:"pa-sm-10 pa-2"},{default:t(()=>[e($,null,{default:t(()=>[l("h4",se,R(d.rolePermissions.name?"Edit":"Add New")+" Role ",1),te,e(p(W),{ref_key:"refPermissionForm",ref:C},{default:t(()=>[e(k,{modelValue:b.value,"onUpdate:modelValue":i[0]||(i[0]=o=>b.value=o),label:"Role Name",placeholder:"Enter Role Name"},null,8,["modelValue"]),oe,e(K,{class:"permission-table text-no-wrap mb-6"},{default:t(()=>[(c(!0),_(g,null,A(a.value,o=>(c(),_(g,{key:o.name},[o.custom?z("",!0):(c(),_("tr",ae,[l("td",null,[l("h6",ne,R(p(B)(o.name)),1)]),l("td",null,[l("div",ie,[e(w,{modelValue:o.read,"onUpdate:modelValue":V=>o.read=V,label:"Read"},null,8,["modelValue","onUpdate:modelValue"])])]),l("td",null,[l("div",de,[e(w,{modelValue:o.create,"onUpdate:modelValue":V=>o.create=V,label:"Create"},null,8,["modelValue","onUpdate:modelValue"])])]),l("td",null,[l("div",re,[e(w,{modelValue:o.edit,"onUpdate:modelValue":V=>o.edit=V,label:"Edit"},null,8,["modelValue","onUpdate:modelValue"])])]),l("td",null,[l("div",ue,[e(w,{modelValue:o.delete,"onUpdate:modelValue":V=>o.delete=V,label:"Delete"},null,8,["modelValue","onUpdate:modelValue"])])])]))],64))),128))]),_:1}),ce,e(K,{class:"permission-table text-no-wrap mb-6"},{default:t(()=>[(c(!0),_(g,null,A(a.value,o=>(c(),_(g,{key:o.name},[o.custom?(c(!0),_(g,{key:0},A(o.custom_permissions,(V,U)=>(c(),_("tr",{key:U},[l("td",null,[l("h6",me,R(p(B)(o.name))+" "+R(p(B)(U)),1)]),l("td",fe,[l("div",_e,[e(w,{modelValue:o.custom_permissions[U],"onUpdate:modelValue":X=>o.custom_permissions[U]=X},null,8,["modelValue","onUpdate:modelValue"])])])]))),128)):z("",!0)],64))),128))]),_:1}),l("div",pe,[e(O,{onClick:T},{default:t(()=>[P(" Submit ")]),_:1}),e(O,{color:"secondary",variant:"tonal",onClick:S},{default:t(()=>[P(" Cancel ")]),_:1})])]),_:1},512)]),_:1})]),_:1})]),_:1},8,["width","model-value"])}}},Ve="/build/assets/girl-using-mobile-CKXBkoEQ.png",he={class:"text-body-1"},be={class:"d-flex justify-space-between align-center"},ge={class:"text-h5"},xe={class:"d-flex align-center"},ye=["onClick"],Re=["src"],Ce=l("div",{class:"text-end"},[P(" Add new role,"),l("br"),P(" if it doesn't exist. ")],-1),Oe={__name:"RoleCards",setup(I){const D=f([]),x=H(),a=f(!1),m=f(),d=f(!1);L(async()=>{await v()});const v=async()=>{await x.getAllRoles(),D.value=x.roles},h=(b,r)=>{a.value=!0,m.value=b,m.value.id=r};return(b,r)=>{const C=Y("IconBtn"),y=ve;return c(),_(g,null,[e(M,null,{default:t(()=>[(c(!0),_(g,null,A(p(D),n=>(c(),Q(E,{key:n.role,cols:"12",sm:"6",lg:"4"},{default:t(()=>[e(F,null,{default:t(()=>[e($,{class:"d-flex align-center pb-4"},{default:t(()=>[l("div",he," Total "+R(n.details.user_count)+" users ",1),e(le)]),_:2},1024),e($,null,{default:t(()=>[l("div",be,[l("div",null,[l("h5",ge,R(n.role.toUpperCase()),1),l("div",xe,[l("a",{href:"javascript:void(0)",onClick:T=>h(n.details,n.id)}," Edit Role ",8,ye)])]),e(C,null,{default:t(()=>[e(Z,{icon:"tabler-copy",class:"text-high-emphasis"})]),_:1})])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),e(E,{cols:"12",sm:"6",lg:"4"},{default:t(()=>[e(F,{class:"h-100",ripple:!1},{default:t(()=>[e(M,{"no-gutters":"",class:"h-100"},{default:t(()=>[e(E,{cols:"5",class:"d-flex flex-column justify-end align-center mt-5"},{default:t(()=>[l("img",{width:"85",src:p(Ve)},null,8,Re)]),_:1}),e(E,{cols:"7"},{default:t(()=>[e($,{class:"d-flex flex-column align-end justify-end gap-4"},{default:t(()=>[e(O,{size:"small",onClick:r[0]||(r[0]=n=>d.value=!0)},{default:t(()=>[P(" Add New Role ")]),_:1}),Ce]),_:1})]),_:1})]),_:1})]),_:1}),e(y,{"is-dialog-visible":p(d),"onUpdate:isDialogVisible":r[1]||(r[1]=n=>N(d)?d.value=n:null),onRoleSubmitted:v},null,8,["is-dialog-visible"])]),_:1})]),_:1}),e(y,{"is-dialog-visible":p(a),"onUpdate:isDialogVisible":r[2]||(r[2]=n=>N(a)?a.value=n:null),"role-permissions":p(m),"onUpdate:rolePermissions":r[3]||(r[3]=n=>N(m)?m.value=n:null),onRoleSubmitted:v},null,8,["is-dialog-visible","role-permissions"])],64)}}};export{Oe as _};
