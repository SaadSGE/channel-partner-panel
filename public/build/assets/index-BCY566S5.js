import{r as ae}from"./validators-IgT9dpV5.js";import{r as o,H as re,w as oe,o as n,c as se,b as t,d as k,e as r,v as i,a6 as ie,n as B,a7 as C,f as d,z as p,a1 as w,F as ne}from"./main-BUwFH-IW.js";import{_ as ue}from"./TablePagination-kOJsQXIq.js";import{_ as me}from"./AppTextField-kyHBGVCd.js";import{_ as de}from"./AppSelect-DEmM5NBO.js";import{_ as pe}from"./AppAutocomplete-CQxuHtKy.js";import{u as ce}from"./rolePermission-qnaLQrpR.js";import{u as fe}from"./user-W3wAqb_T.js";import ve from"./AddNewUserDrawer-B8_aZQ8R.js";import Ve from"./EditNewUserDrawer-CpvnQg09.js";import{S as u}from"./sweetalert2-z6gKu1nJ.js";import{V as L,b as q,d as _e,a as we}from"./VCard-n2tGOuNf.js";import{V as A}from"./VCardText-DMJhMCE1.js";import{V as Ue}from"./VForm-tETb2nEn.js";import{V as z}from"./VSpacer-CNddTHUU.js";import{V as ge}from"./VDialog-Bq4-iHzW.js";import{V as ye,a as M}from"./VRow-DVBzrVLg.js";import{V as H}from"./VDivider-CUvgZn5R.js";import{V as be}from"./VDataTableServer-BonUlI2F.js";import{V as ke}from"./VMenu-Dj4al0iu.js";import{V as Ce,a as S,b as P}from"./VList-CzdFuF3Q.js";import"./helpers-CK0esMst.js";import"./VPagination-DRIa8S-m.js";import"./form-DfMMDErX.js";import"./VTextField-C6o7EM9Q.js";/* empty css                   */import"./VCounter-BNCHe3gR.js";import"./index-DywLX5oQ.js";import"./index-BegM2TGh.js";import"./VField-DftNSFc2.js";import"./easing-CjukEv2V.js";import"./VInput-Bx2mHMpx.js";import"./forwardRefs-C-GTDzx5.js";import"./VSelect-h-bhp9ce.js";import"./dialog-transition-CVFN8D3w.js";import"./VOverlay-CMkg7e6X.js";import"./lazy-Vd1g1j7V.js";import"./scopeId-D6r54s6r.js";import"./VCheckboxBtn-CJommczL.js";import"./VSelectionControl-D8hSJo82.js";import"./VAvatar--ClCf7Gt.js";import"./VImg-CqNukB2R.js";import"./VChip-GJkNF4Cd.js";import"./VSlideGroup-BdprTICZ.js";import"./filter-DgCVmfYx.js";import"./api-C_jhLkFj.js";import"./index-B3bPRkoL.js";import"./AppDrawerHeaderSection-zOVqErgH.js";import"./auth-DmB5gQnn.js";import"./vue3-perfect-scrollbar.esm-7kQlB9ml.js";import"./VNavigationDrawer-_zxLySVh.js";import"./ssrBoot-Cesu3CdV.js";import"./VCheckbox-Cclft83s.js";/* empty css              */import"./VDataTable-B9gfZdug.js";import"./VTable-6-VSUSHo.js";const Se={class:"me-3 d-flex gap-3"},Pe={class:"app-user-search-filter d-flex align-center flex-wrap gap-4"},De={style:{"inline-size":"15.625rem"}},At={__name:"index",setup($e){const m=fe(),E=ce(),D=o(!1),U=o([]),$=o(0),c=o(10),f=o(1),Q=o(),Y=o(),g=o(""),y=o(),b=o(null);o(),o();const T=o(!1),I=o([]),x=o(!1),N=o(null),v=o(!1),V=o(null),O=o(null),j=a=>{O.value=a,V.value=a.parent_id||"",v.value=!0},R=async()=>{if(!V.value)return;const a=await m.setParent(O.value.id,V.value);a.success?(_(),u.fire("Success!",a.message,"success"),v.value=!1):u.fire("Error!",a.message,"error")},G=a=>{console.log(a);const l=U.value.findIndex(s=>s.id===a.id);l!==-1&&U.value.splice(l,1,a)},J=a=>{K(a)},K=a=>{N.value=a,x.value=!0},_=async()=>{T.value=!0;try{const a=await m.fetchUsers(f.value,g.value,y.value,b.value);U.value=a.data,$.value=a.total}catch(a){console.error("Error fetching users:",a)}finally{T.value=!1}},W=async a=>{try{await _(),u.fire("Success!","User added successfully!","success")}catch(l){console.error("Error adding user:",l),u.fire("Error!","Failed to add user.","error")}},X=async a=>{if((await u.fire({title:"Are you sure?",text:"Do you want to delete this user?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel"})).isConfirmed){const s=await m.deleteUser(a);s.success?u.fire("Deleted!",s.message,"success"):u.fire("Error!",s.message,"error")}},Z=a=>{var l,s;Q.value=(l=a.sortBy[0])==null?void 0:l.key,Y.value=(s=a.sortBy[0])==null?void 0:s.order,_()},ee=[{title:"Name",key:"full_name"},{title:"Email",key:"email"},{title:"Role",key:"role"},{title:"Parent",key:"parent.full_name"},{title:"Record Count",key:"record_count"},{title:"Actions",key:"actions",sortable:!1}];return re(async()=>{await E.getAllRoles(),I.value=E.roles,await m.fetchParentUsers(),_()}),oe([g,y,b],()=>{_()}),(a,l)=>{const s=pe,h=de,te=me,le=ue;return n(),se(ne,null,[t(Ve,{isDrawerOpen:x.value,editedUser:N.value,"onUpdate:isDrawerOpen":l[0]||(l[0]=e=>x.value=e),onUserUpdated:G},null,8,["isDrawerOpen","editedUser"]),k("section",null,[t(ge,{modelValue:v.value,"onUpdate:modelValue":l[3]||(l[3]=e=>v.value=e),"max-width":"500px"},{default:r(()=>[t(L,null,{default:r(()=>[t(q,null,{default:r(()=>[i("Set Parent")]),_:1}),t(A,null,{default:r(()=>[t(Ue,{onSubmit:ie(R,["prevent"])},{default:r(()=>[t(s,{modelValue:V.value,"onUpdate:modelValue":l[1]||(l[1]=e=>V.value=e),items:B(m).parentUsers,"item-title":e=>e.full_name,"item-value":e=>e.id,label:"Parent",placeholder:"Select Parent",rules:["requiredValidator"in a?a.requiredValidator:B(ae)]},null,8,["modelValue","items","item-title","item-value","rules"])]),_:1})]),_:1}),t(_e,null,{default:r(()=>[t(z),t(C,{color:"primary",onClick:R},{default:r(()=>[i("Submit")]),_:1}),t(C,{onClick:l[2]||(l[2]=e=>v.value=!1)},{default:r(()=>[i("Cancel")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(L,{class:"mb-6"},{default:r(()=>[a.$can("filter","user")?(n(),d(we,{key:0,class:"pb-4"},{default:r(()=>[t(q,null,{default:r(()=>[i("Filters")]),_:1})]),_:1})):p("",!0),a.$can("filter","user")?(n(),d(A,{key:1},{default:r(()=>[t(ye,null,{default:r(()=>[t(M,{cols:"12",sm:"4"},{default:r(()=>[t(h,{modelValue:y.value,"onUpdate:modelValue":l[4]||(l[4]=e=>y.value=e),placeholder:"Select Role",items:I.value,clearable:"","clear-icon":"tabler-x","item-title":e=>e.role,"item-value":e=>e.role},null,8,["modelValue","items","item-title","item-value"])]),_:1}),t(M,{cols:"12",sm:"4"},{default:r(()=>[t(s,{modelValue:b.value,"onUpdate:modelValue":l[5]||(l[5]=e=>b.value=e),placeholder:"Select Parent",items:B(m).parentUsers,clearable:"","clear-icon":"tabler-x","item-title":e=>e.full_name,"item-value":e=>e.id},null,8,["modelValue","items","item-title","item-value"])]),_:1})]),_:1})]),_:1})):p("",!0),t(H),t(A,{class:"d-flex flex-wrap gap-4"},{default:r(()=>[k("div",Se,[t(h,{"model-value":c.value,items:[{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:100},{value:-1,title:"All"}],style:{"inline-size":"6.25rem"},"onUpdate:modelValue":l[6]||(l[6]=e=>c.value=parseInt(e,10))},null,8,["model-value"])]),t(z),k("div",Pe,[k("div",De,[t(te,{modelValue:g.value,"onUpdate:modelValue":l[7]||(l[7]=e=>g.value=e),placeholder:"Search User"},null,8,["modelValue"])]),a.$can("create","user")?(n(),d(C,{key:0,"prepend-icon":"tabler-plus",onClick:l[8]||(l[8]=e=>D.value=!0)},{default:r(()=>[i(" Add New User ")]),_:1})):p("",!0)])]),_:1}),t(H),t(be,{"items-per-page":c.value,"onUpdate:itemsPerPage":l[10]||(l[10]=e=>c.value=e),page:f.value,"onUpdate:page":l[11]||(l[11]=e=>f.value=e),items:U.value,"items-length":$.value,headers:ee,class:"text-no-wrap","show-select":"","onUpdate:options":Z},{"item.actions":r(({item:e})=>[t(C,{icon:"",variant:"text",color:"medium-emphasis"},{default:r(()=>[t(w,{icon:"tabler-dots-vertical"}),t(ke,{activator:"parent"},{default:r(()=>[t(Ce,null,{default:r(()=>[t(S,{to:{name:"user-view-id",params:{id:e.id}}},{prepend:r(()=>[t(w,{icon:"tabler-eye"})]),default:r(()=>[t(P,null,{default:r(()=>[i("View")]),_:1})]),_:2},1032,["to"]),a.$can("edit","user")?(n(),d(S,{key:0,onClick:F=>J(e)},{prepend:r(()=>[t(w,{icon:"tabler-pencil"})]),default:r(()=>[t(P,null,{default:r(()=>[i("Edit")]),_:1})]),_:2},1032,["onClick"])):p("",!0),a.$can("edit","user")?(n(),d(S,{key:1,onClick:F=>j(e)},{prepend:r(()=>[t(w,{icon:"tabler-pencil"})]),default:r(()=>[t(P,null,{default:r(()=>[i("Set Parent")]),_:1})]),_:2},1032,["onClick"])):p("",!0),a.$can("delete","user")?(n(),d(S,{key:2,onClick:F=>X(e.id)},{prepend:r(()=>[t(w,{icon:"tabler-trash"})]),default:r(()=>[t(P,null,{default:r(()=>[i("Delete")]),_:1})]),_:2},1032,["onClick"])):p("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),bottom:r(()=>[t(le,{page:f.value,"onUpdate:page":l[9]||(l[9]=e=>f.value=e),"items-per-page":c.value,"total-items":$.value},null,8,["page","items-per-page","total-items"])]),_:1},8,["items-per-page","page","items","items-length"])]),_:1}),t(ve,{isDrawerOpen:D.value,"onUpdate:isDrawerOpen":l[12]||(l[12]=e=>D.value=e),onUserData:W},null,8,["isDrawerOpen"])])],64)}}};export{At as default};
