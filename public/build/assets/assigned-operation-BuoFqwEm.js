import{_ as T}from"./Filters-2tHTYVpc.js";import{c as ie}from"./commonFunction-BGzPlocw.js";import{u as de}from"./leadStore-CQK7aSLZ.js";import{u as ue}from"./rolePermission-I9TL5y7t.js";import{u as ce}from"./user-BgykC58T.js";import me from"./EditNewUserDrawer-ClU1hN9e.js";import{S as L}from"./sweetalert2-z6gKu1nJ.js";import{i as E}from"./index-izYISxzY.js";import{a6 as W,r as l,H as pe,w as K,o as i,c as v,b as t,d as c,e as a,v as d,f as A,z as x,a9 as M,F,x as u,i as fe,R as _e,U as ve}from"./main-CDRHw7bU.js";import{g as ge}from"./helpers-BLGpPFsv.js";import{_ as he}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{a as Q,b as q,V as U}from"./VCard-Bp1F490a.js";import{V as g}from"./VCardText-B_F8gT53.js";import{V as y,a as V}from"./VRow-Bl7RUzLP.js";import{V as G}from"./VDivider-C7K7yzHw.js";import{a as ye}from"./VSelect-PVi9L1lC.js";import{V as be}from"./VDataTableServer-BA5WkGkW.js";import{V as J}from"./VChip-BeDB_D3K.js";import{V as xe}from"./VTextField-DUAf_V8h.js";import{V as Ve}from"./VBadge-BHD3mieZ.js";import"./AppDateTimePicker-xuX2jNtv.js";import"./VInput-4qfhZN-a.js";import"./index-CGoY7Wis.js";import"./index-B-VLMSLi.js";import"./forwardRefs-D3j0TLhE.js";import"./AppSelect-hQBo8jkf.js";import"./AppTextField-C2SoKMV6.js";import"./AppAutocomplete-CdiRLxR6.js";import"./filter-BxuKcF0E.js";import"./VList-DB5wUjhk.js";import"./ssrBoot-B0ntlX-d.js";import"./VAvatar-GqYsJ-H2.js";import"./VImg-qiaq65-M.js";import"./VMenu-DUu44HpX.js";import"./dialog-transition-BAb7EMBC.js";import"./scopeId-lvJFtWMb.js";import"./VCheckboxBtn-BNFv_QK0.js";import"./validators-RbSNLLGG.js";import"./AppDrawerHeaderSection-Dte6dAzY.js";import"./VSpacer-CvlDyIFo.js";/* empty css              */import"./auth-BObtcEVZ.js";import"./vue3-perfect-scrollbar.esm-wGkrSSZm.js";import"./VNavigationDrawer-BHWymYsH.js";import"./VForm-DJyPjURZ.js";import"./VFileInput-DHf_g3bW.js";import"./VCheckbox-l7XhSUk8.js";import"./VDataTable-BnuL8bOz.js";import"./VPagination-DXGI6-Hy.js";import"./VTable-CcUYnQYO.js";const I=w=>(_e("data-v-3e5b24f3"),w=w(),ve(),w),we={key:0},Le=I(()=>c("div",{class:"text-h6 text-white mb-1"},"Total Leads Available",-1)),Ue={class:"text-h4 text-white"},Ce=I(()=>c("div",{class:"text-h6 text-white mb-1"},"Total Leads Assigned",-1)),ke={class:"text-h4 text-white"},Be=I(()=>c("div",{class:"text-h6 text-white mb-1"},"Remaining Leads",-1)),Se={class:"text-h4 text-white"},Te={key:0},Ee={class:"d-flex align-center justify-space-between my-1 country-lead-item pa-2"},Ae={key:1,class:"text-grey"},Fe={__name:"assigned-operation",setup(w){const X=W(()=>"calc(100vh - 200px)"),Y=ce();ue();const D=ie();l(!1);const m=l([]),N=l(0),O=l(10),C=l(1);l(),l();const R=l("");l(null),l(null);const h=l(null);l(null),l(),l(),l(null);const n=l(!1);l([]);const P=l(!1),Z=l(null);l(!1),l(null),l(null),l(ge()==="admin");const k=l([]),p=l(null),f=l(null),B=l(1);l([]);const z=de(),_=l(0),b=l(null),S=l(null),$=W(()=>m.value.reduce((s,r)=>s+(parseInt(r.assigned_number_of_leads)||0),0)),ee=s=>{console.log(s);const r=m.value.findIndex(e=>e.id===s.id);r!==-1&&m.value.splice(r,1,s)},te=async()=>{n.value=!0;try{const s=await Y.fetchUsers(C.value,R.value,"Counsellor",null,null,null,null,null,f.value);m.value=s.data,N.value=s.total}catch(s){console.error("Error fetching users:",s)}finally{n.value=!1}},ae=[{title:"Branch",key:"branch.name"},{title:"Name",key:"full_name"},{title:"Email",key:"email"},{title:"Current Lead",key:"current_lead",width:"200px"},{title:"Assigned Number of Leads",key:"assigned_number_of_leads",align:"center"}],le=async(s,r)=>{try{const e=parseInt(r);if(e===0){s.assigned_number_of_leads=0;return}if(m.value.reduce((j,H)=>H.id!==s.id?j+(parseInt(H.assigned_number_of_leads)||0):j,0)+e>_.value){L.fire({title:"Warning!",text:`Total assigned leads cannot exceed ${_.value}`,icon:"warning",confirmButtonText:"OK"}),s.assigned_number_of_leads=0;return}s.assigned_number_of_leads=e}catch(e){console.error("Error updating assigned leads:",e),L.fire("Error!","Failed to update assigned leads","error")}},se=async()=>{n.value=!0;try{const s=await z.fetchLeadCount(h.value,p.value);if(_.value=s.total||0,_.value===0){L.fire("Warning!","No unassigned leads found for the selected country","warning");return}B.value=2}catch(s){console.error("Error fetching leads:",s),L.fire("Error!","Failed to fetch leads","error")}finally{n.value=!1}},re=()=>{setTimeout(()=>{location.reload()},3e3)},oe=async()=>{n.value=!0;try{const s=m.value.map(e=>({user_id:e.id,assigned_leads:e.assigned_number_of_leads||0})).filter(e=>e.assigned_leads>0);(await z.saveAssignedLeads(s,h.value,p.value)).status?(E("Leads assigned successfully",{type:"success",position:"top-right",theme:"colored"}),re()):E("Failed to save assigned leads",{type:"error",position:"top-right",theme:"colored"})}catch(s){console.error("Error saving assigned leads:",s),E("Failed to save assigned leads",{type:"error",position:"top-right",theme:"colored"})}finally{n.value=!1}};pe(async()=>{ne()}),K([R,f],()=>{te()});const ne=async()=>{n.value=!0;try{await D.getBranches(),k.value=D.branches}catch(s){console.error("Error fetching branches:",s)}finally{n.value=!1}};return K([b,S,h,p],()=>{f.value=null,m.value.forEach(s=>{s.assigned_number_of_leads=0}),B.value=1}),(s,r)=>(i(),v(F,null,[t(me,{isDrawerOpen:P.value,editedUser:Z.value,branches:k.value,"onUpdate:isDrawerOpen":r[0]||(r[0]=e=>P.value=e),onUserUpdated:ee},null,8,["isDrawerOpen","editedUser","branches"]),c("section",null,[t(U,{class:"mb-6"},{default:a(()=>[c("div",null,[t(Q,null,{default:a(()=>[t(q,null,{default:a(()=>[d("Select Lead Location")]),_:1})]),_:1}),t(g,null,{default:a(()=>[t(y,null,{default:a(()=>[t(T,{"selected-lead-type":b.value,onUpdateLeadType:r[1]||(r[1]=e=>b.value=e),"country-label":"Lead Country","branch-label":"Lead Branch (Optional)"},null,8,["selected-lead-type"])]),_:1}),b.value==="social"?(i(),A(y,{key:0},{default:a(()=>[t(T,{"selected-country":h.value,"selected-branch":p.value,onUpdateCountry:r[2]||(r[2]=e=>h.value=e),onUpdateBranch:r[3]||(r[3]=e=>p.value=e),"country-label":"Lead Country","branch-label":"Lead Branch"},null,8,["selected-country","selected-branch"])]),_:1})):x("",!0),b.value==="event"?(i(),A(y,{key:1},{default:a(()=>[t(T,{"selected-event":S.value,"selected-branch":p.value,onUpdateEvent:r[4]||(r[4]=e=>S.value=e),onUpdateBranch:r[5]||(r[5]=e=>p.value=e),"branch-label":"Lead Branch"},null,8,["selected-event","selected-branch"])]),_:1})):x("",!0),t(y,{class:"mt-4"},{default:a(()=>[t(V,{cols:"12",class:"text-center"},{default:a(()=>[t(M,{color:"primary",disabled:!h.value,loading:n.value,onClick:se},{default:a(()=>[d(" Continue ")]),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1})]),B.value===2&&_.value>0?(i(),v("div",we,[t(G,{class:"my-4"}),t(Q,null,{default:a(()=>[t(q,null,{default:a(()=>[d("Assign Leads to Counsellors(To complete this step, select a branch)")]),_:1})]),_:1}),t(g,null,{default:a(()=>[t(y,null,{default:a(()=>[t(V,{cols:"12",md:"4"},{default:a(()=>[t(ye,{modelValue:f.value,"onUpdate:modelValue":r[6]||(r[6]=e=>f.value=e),items:k.value,"item-title":"name","item-value":"id",label:"Select Branch"},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1}),f.value?(i(),v(F,{key:0},[t(g,{class:"text-end mb-4"},{default:a(()=>[t(M,{color:"primary",loading:n.value,onClick:oe},{default:a(()=>[d(" Save Assigned Leads ")]),_:1},8,["loading"])]),_:1}),f.value?(i(),A(g,{key:0},{default:a(()=>[t(y,null,{default:a(()=>[t(V,{cols:"12",md:"4"},{default:a(()=>[t(U,{class:"bg-primary"},{default:a(()=>[t(g,{class:"text-center"},{default:a(()=>[Le,c("div",Ue,u(_.value),1)]),_:1})]),_:1})]),_:1}),t(V,{cols:"12",md:"4"},{default:a(()=>[t(U,{class:"bg-success"},{default:a(()=>[t(g,{class:"text-center"},{default:a(()=>[Ce,c("div",ke,u($.value),1)]),_:1})]),_:1})]),_:1}),t(V,{cols:"12",md:"4"},{default:a(()=>[t(U,{class:"bg-info"},{default:a(()=>[t(g,{class:"text-center"},{default:a(()=>[Be,c("div",Se,u(_.value-$.value),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):x("",!0),t(be,{"items-per-page":O.value,"onUpdate:itemsPerPage":r[7]||(r[7]=e=>O.value=e),page:C.value,"onUpdate:page":r[8]||(r[8]=e=>C.value=e),items:m.value,"items-length":N.value,headers:ae,class:"text-no-wrap",height:X.value},{"item.branch.name":a(({item:e})=>{var o;return[d(u(((o=e.branch)==null?void 0:o.branch_name_with_country)||"N/A"),1)]}),"item.full_name":a(({item:e})=>[d(u(e.full_name),1)]),"item.email":a(({item:e})=>[d(u(e.email),1)]),"item.current_lead":a(({item:e})=>[e.lead_counts?(i(),v("div",Te,[c("div",Ee,[t(J,{size:"small",color:"error",variant:"elevated",class:"mr-2"},{default:a(()=>[d(" Total: "+u(e.lead_counts.lead_count_all),1)]),_:2},1024)]),t(G,{class:"my-1"}),(i(!0),v(F,null,fe(e.lead_counts.lead_by_country,o=>(i(),v("div",{key:o.country_id,class:"d-flex align-center justify-space-between my-1 country-lead-item pa-2"},[t(J,{size:"small",color:"primary",variant:"elevated",class:"mr-2"},{default:a(()=>[d(u(o.country_name),1)]),_:2},1024),t(Ve,{content:o.count,color:"success",class:"count-badge"},null,8,["content"])]))),128))])):(i(),v("span",Ae,"0"))]),"item.role":a(({item:e})=>[d(u(e.role),1)]),"item.assigned_number_of_leads":a(({item:e})=>[t(xe,{modelValue:e.assigned_number_of_leads,"onUpdate:modelValue":[o=>e.assigned_number_of_leads=o,o=>le(e,o)],type:"number",min:"0",density:"compact",variant:"outlined","hide-details":"",class:"w-20",placeholder:"Enter number"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["items-per-page","page","items","items-length","height"])],64)):x("",!0)])):x("",!0)]),_:1})])],64))}},Tt=he(Fe,[["__scopeId","data-v-3e5b24f3"]]);export{Tt as default};
