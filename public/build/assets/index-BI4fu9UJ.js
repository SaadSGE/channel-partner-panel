import{r as xe}from"./validators-B3V6vxc3.js";import{_ as pe}from"./AppTextarea-DDJmHz2b.js";import{_ as De}from"./AppAutocomplete-Sfjbz5Jd.js";import{V as X,b as Y,c as me,a as Ae}from"./VCard-BV1M2n13.js";import{V as j}from"./VCardText-BZC4GHLq.js";import{V as Z}from"./VSpacer-DsGM5CTR.js";import{r as o,w as ve,o as i,f as N,e as s,b as a,v as u,n as Ie,a9 as V,H as Te,bL as ne,c as y,z as U,a8 as $e,d,x as r,F as ue,i as de,a2 as Q,J as Be}from"./main-Fnquxq59.js";import{V as fe}from"./VDialog-DJxSFL81.js";import{_ as Fe}from"./TablePagination-DXKRVMHM.js";import{_ as ze}from"./AppSelect-D2Erl3Sx.js";import{_ as Ee}from"./Filters-CjDfwejU.js";import{u as Me}from"./leadStore-DAY5Dx2k.js";/* empty css                         */import{c as He}from"./commonFunction-aHx3jXPa.js";import Pe from"./upload-lead-Bra9EYzw.js";import{V as qe}from"./VRow-CZuh9ehv.js";import{V as Je}from"./VForm-B6K_oZ0i.js";import{V as Oe}from"./VInput-CZub6Zk0.js";import{V as re}from"./VDivider-yXWRSAV-.js";import{V as Re}from"./VDataTableServer-CmoUJ57C.js";import{V as W}from"./VChip-Dt8JHKvn.js";import{V as je}from"./VMenu-Ck1TOVry.js";import{V as Ge,a as ie,b as ce}from"./VList-DRH0Z_ga.js";import"./helpers-D3v8wGNq.js";import"./forwardRefs-D3j0TLhE.js";import"./index-BIh3WpW1.js";import"./VSelect-nUKQwNEk.js";import"./VTextField-CaLyShim.js";import"./dialog-transition-BbDK651E.js";import"./scopeId-B5QIExbG.js";import"./VCheckboxBtn-1CZZxZt9.js";import"./VAvatar-BvpeSpy9.js";import"./VImg-D0Y1lsUC.js";import"./filter-BPg4cofz.js";/* empty css              */import"./VPagination-Bd2r7ZAo.js";import"./AppDateTimePicker-Bs945VZl.js";import"./AppTextField-BObPlpdg.js";import"./rolePermission-BQu99Xml.js";import"./user-BCzbzf1B.js";import"./index-DV7V0mT_.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./VFileInput-BKSzQMMx.js";import"./index-MHNCXv1N.js";import"./VDataTable-BooLTLqu.js";import"./VTable-DGFdxjcr.js";import"./ssrBoot-GPPxPnS1.js";const Ke={__name:"ChangeStatusDialog",props:{showDialog:Boolean,leadId:Number,statusId:Number,leadStatuses:Array,resolveLeadStatusName:Function},emits:["updateStatus","closeDialog"],setup(x,{emit:G}){const _=x,S=G,f=o(null),w=o("");ve(()=>_.showDialog,c=>{c&&(f.value=_.resolveLeadStatusName(_.statusId))});const h=()=>{S("closeDialog")},k=()=>{f.value!==null&&(S("updateStatus",{leadId:_.leadId,statusId:f.value,statusNote:w.value}),w.value="",h())};return(c,m)=>{const D=De,A=pe;return i(),N(fe,{"model-value":_.showDialog,persistent:"",width:c.$vuetify.display.smAndDown?"auto":400,"onClick:outside":h},{default:s(()=>[a(X,null,{default:s(()=>[a(Y,null,{default:s(()=>[u("Select New Status")]),_:1}),a(j,null,{default:s(()=>[a(D,{modelValue:f.value,"onUpdate:modelValue":m[0]||(m[0]=v=>f.value=v),items:x.leadStatuses,"item-title":v=>v.name,"item-value":v=>v.id,label:"Status",placeholder:"Select Status",rules:["requiredValidator"in c?c.requiredValidator:Ie(xe)],clearable:""},null,8,["modelValue","items","item-title","item-value","rules"]),a(A,{modelValue:w.value,"onUpdate:modelValue":m[1]||(m[1]=v=>w.value=v),class:"mt-4",label:"Status Note (optional)",placeholder:"Enter status note",rows:"3"},null,8,["modelValue"])]),_:1}),a(me,null,{default:s(()=>[a(Z),a(V,{color:"primary",onClick:k},{default:s(()=>[u("Update Status")]),_:1}),a(V,{text:"",onClick:h},{default:s(()=>[u("Cancel")]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value","width"])}}},Qe={class:"me-3 d-flex gap-3"},We={class:"app-user-search-filter d-flex align-center flex-wrap gap-4"},Xe={class:"d-flex flex-column ms-3"},Ye={class:"d-block font-weight-medium text-truncate text-high-emphasis"},Ze={class:"text-md"},et={style:{"list-style-type":"disc","padding-inline-start":"20px"}},tt={style:{color:"#757575"}},at={style:{color:"#007acc"}},st={style:{color:"orange"}},lt=["onClick"],ot={key:0},nt={style:{"list-style-type":"disc","padding-inline-start":"20px"}},ut={style:{color:"#757575"}},dt={style:{color:"#757575"}},rt={style:{color:"#007acc"}},it={style:{color:"orange"}},ct=["onClick"],oa={__name:"index",props:{userId:{type:String,default:null}},setup(x){const G=x,_=He(),S=o([]);Te(async()=>{ye()});const f=Me(),w=o([]),h=o(),k=o(!1),c=o(10),m=o(1),D=o(),A=o(),v=o(""),I=o(null),ee=o(null),T=o(null),$=o(null),B=o(!1),F=o(null),z=o(!1),b=o(!1),E=o(""),C=o(!1),M=ne({}),te=o(!1),H=o(null),P=o(null),q=o(null),J=o(null),_e=l=>{M[l]=!M[l]},O=o(null),ge=[{title:"Actions",key:"actions",sortable:!1},{title:"Lead Country",key:"lead_type"},{title:"Name",key:"name"},{title:"Phone",key:"phone"},{title:"Email",key:"email"},{title:"Interested Course & Country",key:"course_country"},{title:"Current Status",key:"status"},{title:"Status History",key:"statusHistory"},{title:"Assigned Status",key:"assigned_user"},{title:"Assigned User",key:"assigned_user.name_with_email"},{title:"Manager's Note",key:"notes"},{title:"Assigned Branch",key:"branch.branch_name_with_country"}];ve([v,I,T,$,H,P,q,J,O],()=>{L()});const ye=async()=>{await _.getLeadStatus(),S.value=_.leadStatus},L=async()=>{k.value=!0;try{const l=await f.getLeads(G.userId,m.value,c.value,v.value,D.value,A.value,I.value,T.value,$.value,H.value,P.value,q.value,J.value,O.value);w.value=l.data,h.value=l.total}catch(l){console.error("Error fetching leads:",l)}finally{k.value=!1}},Se=l=>{var t,p;L(),D.value=(t=l.sortBy[0])==null?void 0:t.key,A.value=(p=l.sortBy[0])==null?void 0:p.order},ae=(l,t,p)=>{F.value=l,ee.value=t,B.value=!0,te.value=p},we=async({leadId:l,statusId:t,statusNote:p})=>{console.log("convertToStudent",te.value);const K={status:t,status_note:p};await f.updateLeadStatus(l,K),await L(),B.value=!1},he=l=>{const t=S.value.find(p=>p.id===l);return t?t.name:"Unknown Status"},Ve=l=>{const t=S.value.find(p=>p.id===l);return t?t.color_code:"#000"},se=async l=>{if(!l){console.error("Lead ID is required to add a note.");return}try{C.value=!0;const t={note:E.value};await f.addNoteToLead(l,t.note),E.value="",b.value=!1,await L()}catch(t){console.error("Error adding note:",t)}finally{C.value=!1}},R=ne({}),ke=l=>{R[l]=!R[l]},be=l=>{F.value=l,b.value=!0},Ce=()=>{z.value=!z.value};return(l,t)=>{const p=Ee,K=pe,Le=ze,Ue=Fe,Ne=Ke;return i(),y("section",null,[a(X,{class:"mb-6"},{default:s(()=>[l.$can("create","lead")?(i(),N(Ae,{key:0,class:"pb-4"},{default:s(()=>[a(Y,null,{default:s(()=>[u("Filter")]),_:1})]),_:1})):U("",!0),l.$can("create","lead")?(i(),N(j,{key:1},{default:s(()=>[a(qe,null,{default:s(()=>[a(p,{"selected-assigned-status":H.value,"selected-lead-status":I.value,"selected-dateFrom":T.value,"selected-dateTo":$.value,"selected-lead-type":P.value,"selected-event":q.value,"selected-country":O.value,"selected-branch":J.value,onUpdateAssignedStatus:t[0]||(t[0]=e=>H.value=e),onUpdateLeadStatus:t[1]||(t[1]=e=>I.value=e),onUpdateDateFrom:t[2]||(t[2]=e=>T.value=e),onUpdateDateTo:t[3]||(t[3]=e=>$.value=e),onUpdateLeadType:t[4]||(t[4]=e=>P.value=e),onUpdateEvent:t[5]||(t[5]=e=>q.value=e),onUpdateCountry:t[6]||(t[6]=e=>O.value=e),onUpdateBranch:t[7]||(t[7]=e=>J.value=e),"country-label":"Lead Country"},null,8,["selected-assigned-status","selected-lead-status","selected-dateFrom","selected-dateTo","selected-lead-type","selected-event","selected-country","selected-branch"])]),_:1}),a(fe,{modelValue:b.value,"onUpdate:modelValue":t[11]||(t[11]=e=>b.value=e),"max-width":"500px"},{default:s(()=>[a(X,null,{default:s(()=>[a(Y,null,{default:s(()=>[u("Add a New Note")]),_:1}),a(j,null,{default:s(()=>[a(Je,{onSubmit:$e(se,["prevent"])},{default:s(()=>[a(Oe,{class:"mt-2"},{default:s(()=>[u(" New Note ")]),_:1}),a(K,{modelValue:E.value,"onUpdate:modelValue":t[8]||(t[8]=e=>E.value=e),placeholder:"Add a new note",class:"mt-2"},null,8,["modelValue"])]),_:1})]),_:1}),a(me,null,{default:s(()=>[a(Z),a(V,{color:"primary",loading:C.value,disabled:C.value,onClick:t[9]||(t[9]=()=>se(F.value))},{default:s(()=>[u(" Submit Note ")]),_:1},8,["loading","disabled"]),a(V,{disabled:C.value,onClick:t[10]||(t[10]=e=>b.value=!1)},{default:s(()=>[u(" Cancel ")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})):U("",!0),a(re),a(j,{class:"d-flex flex-wrap gap-4"},{default:s(()=>[d("div",Qe,[a(Le,{"model-value":c.value,items:[{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:100},{value:-1,title:"All"}],style:{"inline-size":"6.25rem"},"onUpdate:modelValue":t[12]||(t[12]=e=>c.value=parseInt(e,10))},null,8,["model-value"])]),a(Z),d("div",We,[l.$can("create","lead")?(i(),N(V,{key:0,"prepend-icon":"tabler-plus",onClick:Ce},{default:s(()=>[u(" Upload Lead ")]),_:1})):U("",!0)]),a(Pe,{showUploadCard:z.value,"onUpdate:showUploadCard":t[13]||(t[13]=e=>z.value=e),onLeadsUploaded:L},null,8,["showUploadCard"])]),_:1}),a(re),a(Re,{"items-per-page":c.value,"onUpdate:itemsPerPage":t[15]||(t[15]=e=>c.value=e),page:m.value,"onUpdate:page":t[16]||(t[16]=e=>m.value=e),loading:k.value,"onUpdate:options":Se,"items-length":h.value,headers:ge,items:w.value,"item-value":"total",class:"text-no-wrap text-sm rounded-0"},{"item.lead_type":s(({item:e})=>{var n,g;return[d("span",null,r(e.lead_type==="social"?(n=e.lead_country)==null?void 0:n.name:(g=e.lead_event)==null?void 0:g.name),1)]}),"item.assigned_user":s(({item:e})=>[a(W,{color:e.assigned_user?"success":"error",size:"small",class:"font-weight-medium",style:{color:"#000",cursor:"pointer"}},{default:s(()=>[u(r(e.assigned_user?"Assigned":"Unassigned"),1)]),_:2},1032,["color"])]),"item.course_country":s(({item:e})=>[d("div",Xe,[d("span",Ye,r(e.interested_course),1),d("span",Ze,r(e.interested_country),1)])]),"item.notes":s(({item:e})=>[d("ul",et,[(i(!0),y(ue,null,de(M[e.id]?e.notes:e.notes.slice(0,2),(n,g)=>(i(),y("li",{key:n.id,class:"note",style:{"font-size":"1.1em","margin-block-end":"8px"}},[u(r(n.note)+" ( ",1),d("small",tt,[d("span",at,r(n.created_by),1),u(", "),d("span",st,r(n.created_at?new Date(n.created_at).toLocaleDateString():"N/A"),1)]),u(" ) ")]))),128))]),e.notes.length>2?(i(),y("p",{key:0,onClick:n=>_e(e.id),style:{color:"blue",cursor:"pointer","font-weight":"bold","padding-inline-start":"10px","text-decoration":"underline"}},r(M[e.id]?"Show Less":"Show More"),9,lt)):U("",!0)]),"item.status":s(({item:e})=>{var n;return[a(W,{color:((n=e.status)==null?void 0:n.color_code)||"#D3D3D3",size:"small",class:"font-weight-medium",style:{cursor:"pointer"},onClick:g=>{var le,oe;return ae(e.id,(le=e.status)==null?void 0:le.id,(oe=e.status)==null?void 0:oe.convert_to_student)}},{default:s(()=>{var g;return[u(r(((g=e.status)==null?void 0:g.name)||"Unknown Status"),1)]}),_:2},1032,["color","onClick"])]}),"item.assigned_branch":s(({item:e})=>[e.assigned_branch?(i(),y("span",ot,r(e.assigned_branch),1)):(i(),N(W,{key:1,color:"error",size:"small",variant:"flat"},{default:s(()=>[u("Not Assigned")]),_:1}))]),"item.actions":s(({item:e})=>[a(V,{icon:"",variant:"text",color:"medium-emphasis",class:"action-button"},{default:s(()=>[a(Q,{icon:"tabler-dots-vertical"}),a(je,{activator:"parent","open-on-hover":""},{default:s(()=>[a(Ge,null,{default:s(()=>[a(ie,{onClick:n=>ae(e.id,e.status),class:"change-status-option"},{prepend:s(()=>[a(Q,{icon:"tabler-analyze"})]),default:s(()=>[a(ce,null,{default:s(()=>[u("Change Status")]),_:1})]),_:2},1032,["onClick"]),a(ie,{onClick:n=>be(e.id),class:"add-note-option"},{prepend:s(()=>[a(Q,{icon:"tabler-clipboard-text"})]),default:s(()=>[a(ce,null,{default:s(()=>[u("Add Note")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),"item.statusHistory":s(({item:e})=>[d("ul",nt,[(i(!0),y(ue,null,de(R[e.id]?e.status_history:e.status_history.slice(0,2),(n,g)=>(i(),y("li",{key:n.id,class:"status-history",style:{"font-size":"1.1em","margin-block-end":"8px"}},[d("span",{style:Be({color:Ve(n.status_id)})},r(n.status_name),5),u(" - "),d("span",ut,r(n.status_note),1),u(" ( "),d("small",dt,[d("span",rt,r(n.user_name),1),u(", "),d("span",it,r(n.created_at),1)]),u(" ) ")]))),128))]),e.status_history.length>2?(i(),y("p",{key:0,onClick:n=>ke(e.id),style:{color:"blue",cursor:"pointer","font-weight":"bold","padding-inline-start":"10px","text-decoration":"underline"}},r(R[e.id]?"Show Less":"Show More"),9,ct)):U("",!0)]),bottom:s(()=>[a(Ue,{page:m.value,"onUpdate:page":t[14]||(t[14]=e=>m.value=e),"items-per-page":c.value,"total-items":h.value},null,8,["page","items-per-page","total-items"])]),_:1},8,["items-per-page","page","loading","items-length","items"])]),_:1}),a(Ne,{showDialog:B.value,leadId:F.value,statusId:ee.value,leadStatuses:S.value,resolveLeadStatusName:he,onUpdateStatus:we,onCloseDialog:t[17]||(t[17]=e=>B.value=!1)},null,8,["showDialog","leadId","statusId","leadStatuses"])])}}};export{oa as default};
