import{r as xe}from"./validators-Bsurfno4.js";import{_ as pe}from"./AppTextarea-7jqCPunx.js";import{_ as De}from"./AppAutocomplete-DcuGBntI.js";import{V as X,b as Y,c as me,a as Ae}from"./VCard-Dx0fWyCR.js";import{V as R}from"./VCardText-CFE2SkFu.js";import{V as Z}from"./VSpacer-AY_zzHkS.js";import{r as o,w as ve,o as i,f as k,e as a,b as s,v as u,n as Ie,a9 as b,H as $e,bL as ne,c as y,z as V,a8 as Te,d,x as r,F as ue,i as de,a2 as Q,J as Be}from"./main-Dtxc__9d.js";import{V as fe}from"./VDialog-Tqi85a98.js";import{_ as Fe}from"./TablePagination-CqjkzURO.js";import{_ as ze}from"./AppSelect-DYMVwnxG.js";import{_ as Ee}from"./Filters-u008DWio.js";import{u as Me}from"./leadStore-DwmWKmwm.js";/* empty css                         */import{c as He}from"./commonFunction-WWe2zECN.js";import Pe from"./upload-lead-rnvSBL8d.js";import{V as qe}from"./VRow-54hNHl-r.js";import{V as Je}from"./VForm-D58aYPcG.js";import{V as Oe}from"./VInput-CBBhEiqS.js";import{V as re}from"./VDivider-CDUEaea3.js";import{V as Re}from"./VDataTableServer-q5fv6EmF.js";import{V as W}from"./VChip-BHTfnBby.js";import{V as je}from"./VMenu-D2iFB8Sc.js";import{V as Ge,a as ie,b as ce}from"./VList-xiAginTe.js";import"./helpers-DXs-9wm2.js";import"./forwardRefs-D3j0TLhE.js";import"./index-wIE8rx2D.js";import"./VSelect-gW8Z8kzj.js";import"./VTextField-Bq1APYZH.js";import"./dialog-transition-CdtSAVQs.js";import"./scopeId-C1UCymLm.js";import"./VCheckboxBtn-T6n0A6bB.js";import"./VAvatar-qTJcbkfh.js";import"./VImg-DboyZ-Zz.js";import"./filter-C8NHW-NI.js";/* empty css              */import"./VPagination-Du4iYR3x.js";import"./AppDateTimePicker-DvOryahd.js";import"./AppTextField-W13NJ0Y0.js";import"./rolePermission-Ck1_W8wO.js";import"./user-BaD1eqYf.js";import"./index-49Rkel8Z.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./VFileInput-xkubF7MP.js";import"./index-DLrHlTKy.js";import"./VDataTable-BIyk_F-1.js";import"./VTable-D2GxbLZw.js";import"./ssrBoot-BoLZlmlm.js";const Ke={__name:"ChangeStatusDialog",props:{showDialog:Boolean,leadId:Number,statusId:Number,leadStatuses:Array,resolveLeadStatusName:Function},emits:["updateStatus","closeDialog"],setup(j,{emit:G}){const f=j,S=G,_=o(null),w=o("");ve(()=>f.showDialog,c=>{c&&(_.value=f.resolveLeadStatusName(f.statusId))});const h=()=>{S("closeDialog")},C=()=>{_.value!==null&&(S("updateStatus",{leadId:f.leadId,statusId:_.value,statusNote:w.value}),w.value="",h())};return(c,m)=>{const x=De,D=pe;return i(),k(fe,{"model-value":f.showDialog,persistent:"",width:c.$vuetify.display.smAndDown?"auto":400,"onClick:outside":h},{default:a(()=>[s(X,null,{default:a(()=>[s(Y,null,{default:a(()=>[u("Select New Status")]),_:1}),s(R,null,{default:a(()=>[s(x,{modelValue:_.value,"onUpdate:modelValue":m[0]||(m[0]=v=>_.value=v),items:f.leadStatuses,"item-title":v=>v.name,"item-value":v=>v.id,label:"Status",placeholder:"Select Status",rules:["requiredValidator"in c?c.requiredValidator:Ie(xe)],clearable:""},null,8,["modelValue","items","item-title","item-value","rules"]),s(D,{modelValue:w.value,"onUpdate:modelValue":m[1]||(m[1]=v=>w.value=v),class:"mt-4",label:"Status Note (optional)",placeholder:"Enter status note",rows:"3"},null,8,["modelValue"])]),_:1}),s(me,null,{default:a(()=>[s(Z),s(b,{color:"primary",onClick:C},{default:a(()=>[u("Update Status")]),_:1}),s(b,{text:"",onClick:h},{default:a(()=>[u("Cancel")]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value","width"])}}},Qe={class:"me-3 d-flex gap-3"},We={class:"app-user-search-filter d-flex align-center flex-wrap gap-4"},Xe={class:"d-flex flex-column ms-3"},Ye={class:"d-block font-weight-medium text-truncate text-high-emphasis"},Ze={class:"text-md"},et={style:{"list-style-type":"disc","padding-inline-start":"20px"}},tt={style:{color:"#757575"}},at={style:{color:"#007acc"}},st={style:{color:"orange"}},lt=["onClick"],ot={key:0},nt={style:{"list-style-type":"disc","padding-inline-start":"20px"}},ut={style:{color:"#757575"}},dt={style:{color:"#757575"}},rt={style:{color:"#007acc"}},it={style:{color:"orange"}},ct=["onClick"],oa={__name:"index",props:{userId:{type:String,default:null}},setup(j){const G=j,f=He(),S=o([]);$e(async()=>{ye()});const _=Me(),w=o([]),h=o(),C=o(!1),c=o(10),m=o(1),x=o(),D=o(),v=o(""),A=o(null),ee=o(null),I=o(null),$=o(null),T=o(!1),B=o(null),F=o(!1),L=o(!1),z=o(""),U=o(!1),E=ne({}),te=o(!1),M=o(null),H=o(null),P=o(null),q=o(null),_e=l=>{E[l]=!E[l]},J=o(null),ge=[{title:"Actions",key:"actions",sortable:!1},{title:"Lead Country",key:"lead_type"},{title:"Name",key:"name"},{title:"Phone",key:"phone"},{title:"Email",key:"email"},{title:"Interested Course & Country",key:"course_country"},{title:"Current Status",key:"status"},{title:"Status History",key:"statusHistory"},{title:"Assigned Status",key:"assigned_user"},{title:"Assigned User",key:"assigned_user.name_with_email"},{title:"Manager's Note",key:"notes"},{title:"Assigned Branch",key:"branch.branch_name_with_country"}];ve([v,A,I,$,M,H,P,q,J],()=>{N()});const ye=async()=>{await f.getLeadStatus(),S.value=f.leadStatus},N=async()=>{C.value=!0;try{const l=await _.getLeads(G.userId,m.value,c.value,v.value,x.value,D.value,A.value,I.value,$.value,M.value,H.value,P.value,q.value,J.value);w.value=l.data,h.value=l.total}catch(l){console.error("Error fetching leads:",l)}finally{C.value=!1}},Se=l=>{var t,p;N(),x.value=(t=l.sortBy[0])==null?void 0:t.key,D.value=(p=l.sortBy[0])==null?void 0:p.order},ae=(l,t,p)=>{B.value=l,ee.value=t,T.value=!0,te.value=p},we=async({leadId:l,statusId:t,statusNote:p})=>{console.log("convertToStudent",te.value);const K={status:t,status_note:p};await _.updateLeadStatus(l,K),await N(),T.value=!1},he=l=>{const t=S.value.find(p=>p.id===l);return t?t.name:"Unknown Status"},Ve=l=>{const t=S.value.find(p=>p.id===l);return t?t.color_code:"#000"},se=async l=>{if(!l){console.error("Lead ID is required to add a note.");return}try{U.value=!0;const t={note:z.value};await _.addNoteToLead(l,t.note),z.value="",L.value=!1,await N()}catch(t){console.error("Error adding note:",t)}finally{U.value=!1}},O=ne({}),ke=l=>{O[l]=!O[l]},be=l=>{B.value=l,L.value=!0},Ce=()=>{F.value=!F.value};return(l,t)=>{const p=Ee,K=pe,Le=ze,Ue=Fe,Ne=Ke;return i(),y("section",null,[s(X,{class:"mb-6"},{default:a(()=>[l.$can("create","lead")?(i(),k(Ae,{key:0,class:"pb-4"},{default:a(()=>[s(Y,null,{default:a(()=>[u("Filter")]),_:1})]),_:1})):V("",!0),l.$can("create","lead")?(i(),k(R,{key:1},{default:a(()=>[s(qe,null,{default:a(()=>[s(p,{"selected-assigned-status":M.value,"selected-lead-status":A.value,"selected-dateFrom":I.value,"selected-dateTo":$.value,"selected-lead-type":H.value,"selected-event":P.value,"selected-country":J.value,"selected-branch":q.value,onUpdateAssignedStatus:t[0]||(t[0]=e=>M.value=e),onUpdateLeadStatus:t[1]||(t[1]=e=>A.value=e),onUpdateDateFrom:t[2]||(t[2]=e=>I.value=e),onUpdateDateTo:t[3]||(t[3]=e=>$.value=e),onUpdateLeadType:t[4]||(t[4]=e=>H.value=e),onUpdateEvent:t[5]||(t[5]=e=>P.value=e),onUpdateCountry:t[6]||(t[6]=e=>J.value=e),onUpdateBranch:t[7]||(t[7]=e=>q.value=e),"country-label":"Lead Country"},null,8,["selected-assigned-status","selected-lead-status","selected-dateFrom","selected-dateTo","selected-lead-type","selected-event","selected-country","selected-branch"])]),_:1}),s(fe,{modelValue:L.value,"onUpdate:modelValue":t[11]||(t[11]=e=>L.value=e),"max-width":"500px"},{default:a(()=>[s(X,null,{default:a(()=>[s(Y,null,{default:a(()=>[u("Add a New Note")]),_:1}),s(R,null,{default:a(()=>[s(Je,{onSubmit:Te(se,["prevent"])},{default:a(()=>[s(Oe,{class:"mt-2"},{default:a(()=>[u(" New Note ")]),_:1}),s(K,{modelValue:z.value,"onUpdate:modelValue":t[8]||(t[8]=e=>z.value=e),placeholder:"Add a new note",class:"mt-2"},null,8,["modelValue"])]),_:1})]),_:1}),s(me,null,{default:a(()=>[s(Z),s(b,{color:"primary",loading:U.value,disabled:U.value,onClick:t[9]||(t[9]=()=>se(B.value))},{default:a(()=>[u(" Submit Note ")]),_:1},8,["loading","disabled"]),s(b,{disabled:U.value,onClick:t[10]||(t[10]=e=>L.value=!1)},{default:a(()=>[u(" Cancel ")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})):V("",!0),s(re),s(R,{class:"d-flex flex-wrap gap-4"},{default:a(()=>[d("div",Qe,[s(Le,{"model-value":c.value,items:[{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:100},{value:-1,title:"All"}],style:{"inline-size":"6.25rem"},"onUpdate:modelValue":t[12]||(t[12]=e=>c.value=parseInt(e,10))},null,8,["model-value"])]),s(Z),d("div",We,[l.$can("create","lead")?(i(),k(b,{key:0,"prepend-icon":"tabler-plus",onClick:Ce},{default:a(()=>[u(" Upload Lead ")]),_:1})):V("",!0)]),s(Pe,{showUploadCard:F.value,"onUpdate:showUploadCard":t[13]||(t[13]=e=>F.value=e),onLeadsUploaded:N},null,8,["showUploadCard"])]),_:1}),s(re),s(Re,{"items-per-page":c.value,"onUpdate:itemsPerPage":t[15]||(t[15]=e=>c.value=e),page:m.value,"onUpdate:page":t[16]||(t[16]=e=>m.value=e),loading:C.value,"onUpdate:options":Se,"items-length":h.value,headers:ge,items:w.value,"item-value":"total",class:"text-no-wrap text-sm rounded-0"},{"item.lead_type":a(({item:e})=>{var n,g;return[d("span",null,r(e.lead_type==="social"?(n=e.lead_country)==null?void 0:n.name:(g=e.lead_event)==null?void 0:g.name),1)]}),"item.assigned_user":a(({item:e})=>[s(W,{color:e.assigned_user?"success":"error",size:"small",class:"font-weight-medium",style:{color:"#000",cursor:"pointer"}},{default:a(()=>[u(r(e.assigned_user?"Assigned":"Unassigned"),1)]),_:2},1032,["color"])]),"item.course_country":a(({item:e})=>[d("div",Xe,[d("span",Ye,r(e.interested_course),1),d("span",Ze,r(e.interested_country),1)])]),"item.notes":a(({item:e})=>[d("ul",et,[(i(!0),y(ue,null,de(E[e.id]?e.notes:e.notes.slice(0,2),(n,g)=>(i(),y("li",{key:n.id,class:"note",style:{"font-size":"1.1em","margin-block-end":"8px"}},[u(r(n.note)+" ( ",1),d("small",tt,[d("span",at,r(n.created_by),1),u(", "),d("span",st,r(n.created_at?new Date(n.created_at).toLocaleDateString():"N/A"),1)]),u(" ) ")]))),128))]),e.notes.length>2?(i(),y("p",{key:0,onClick:n=>_e(e.id),style:{color:"blue",cursor:"pointer","font-weight":"bold","padding-inline-start":"10px","text-decoration":"underline"}},r(E[e.id]?"Show Less":"Show More"),9,lt)):V("",!0)]),"item.status":a(({item:e})=>{var n;return[s(W,{color:((n=e.status)==null?void 0:n.color_code)||"#D3D3D3",size:"small",class:"font-weight-medium",style:{cursor:"pointer"},onClick:g=>{var le,oe;return ae(e.id,(le=e.status)==null?void 0:le.id,(oe=e.status)==null?void 0:oe.convert_to_student)}},{default:a(()=>{var g;return[u(r(((g=e.status)==null?void 0:g.name)||"Unknown Status"),1)]}),_:2},1032,["color","onClick"])]}),"item.assigned_branch":a(({item:e})=>[e.assigned_branch?(i(),y("span",ot,r(e.assigned_branch),1)):(i(),k(W,{key:1,color:"error",size:"small",variant:"flat"},{default:a(()=>[u("Not Assigned")]),_:1}))]),"item.actions":a(({item:e})=>[s(b,{icon:"",variant:"text",color:"medium-emphasis",class:"action-button"},{default:a(()=>[s(Q,{icon:"tabler-dots-vertical"}),s(je,{activator:"parent","open-on-hover":""},{default:a(()=>[s(Ge,null,{default:a(()=>[s(ie,{onClick:n=>ae(e.id,e.status),class:"change-status-option"},{prepend:a(()=>[s(Q,{icon:"tabler-analyze"})]),default:a(()=>[s(ce,null,{default:a(()=>[u("Change Status")]),_:1})]),_:2},1032,["onClick"]),l.$can("add","manager lead note")?(i(),k(ie,{key:0,onClick:n=>be(e.id),class:"add-note-option"},{prepend:a(()=>[s(Q,{icon:"tabler-clipboard-text"})]),default:a(()=>[s(ce,null,{default:a(()=>[u("Add Note")]),_:1})]),_:2},1032,["onClick"])):V("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),"item.statusHistory":a(({item:e})=>[d("ul",nt,[(i(!0),y(ue,null,de(O[e.id]?e.status_history:e.status_history.slice(0,2),(n,g)=>(i(),y("li",{key:n.id,class:"status-history",style:{"font-size":"1.1em","margin-block-end":"8px"}},[d("span",{style:Be({color:Ve(n.status_id)})},r(n.status_name),5),u(" - "),d("span",ut,r(n.status_note),1),u(" ( "),d("small",dt,[d("span",rt,r(n.user_name),1),u(", "),d("span",it,r(n.created_at),1)]),u(" ) ")]))),128))]),e.status_history.length>2?(i(),y("p",{key:0,onClick:n=>ke(e.id),style:{color:"blue",cursor:"pointer","font-weight":"bold","padding-inline-start":"10px","text-decoration":"underline"}},r(O[e.id]?"Show Less":"Show More"),9,ct)):V("",!0)]),bottom:a(()=>[s(Ue,{page:m.value,"onUpdate:page":t[14]||(t[14]=e=>m.value=e),"items-per-page":c.value,"total-items":h.value},null,8,["page","items-per-page","total-items"])]),_:1},8,["items-per-page","page","loading","items-length","items"])]),_:1}),s(Ne,{showDialog:T.value,leadId:B.value,statusId:ee.value,leadStatuses:S.value,resolveLeadStatusName:he,onUpdateStatus:we,onCloseDialog:t[17]||(t[17]=e=>T.value=!1)},null,8,["showDialog","leadId","statusId","leadStatuses"])])}}};export{oa as default};
