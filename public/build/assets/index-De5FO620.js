import{r as De}from"./validators-DWUnnSEU.js";import{_ as pe}from"./AppTextarea-BRBdH7rF.js";import{_ as Ae}from"./AppAutocomplete-BDfhtnif.js";import{V as X,b as Y,c as me,a as $e}from"./VCard-C_Z_oM4w.js";import{V as R}from"./VCardText-DsjHODQx.js";import{V as Z}from"./VSpacer-CpDGaEat.js";import{r as o,w as ve,o as i,f as k,e as l,b as a,v as d,n as Ie,a9 as b,H as Te,bL as ne,c as y,z as w,a8 as Be,d as u,x as r,F as de,i as ue,a2 as Q,J as Fe}from"./main-C5AJLtfR.js";import{V as fe}from"./VDialog-CQafC8Py.js";import{_ as ze}from"./TablePagination-B0wN2FBM.js";import{_ as Ee}from"./AppTextField-D0Wa61d_.js";import{_ as Me}from"./AppSelect-DN1f9EbK.js";import{_ as He}from"./Filters-f6tt5j5B.js";import{u as Pe}from"./leadStore-VfYCHYLj.js";/* empty css                         */import{c as qe}from"./commonFunction-B_njanZQ.js";import Je from"./upload-lead-DsQwgeU4.js";import{V as Oe}from"./VRow-8KanaPXi.js";import{V as Re}from"./VForm-BYSHdyM4.js";import{V as je}from"./VInput-Bi-eBupe.js";import{V as re}from"./VDivider-BTLHMisk.js";import{V as Ge}from"./VDataTableServer-DP1_aSwm.js";import{V as W}from"./VChip-BF1RZUyL.js";import{V as Ke}from"./VMenu-BL4ZCYc3.js";import{V as Qe,a as ie,b as ce}from"./VList-yl64xJxf.js";import"./helpers-C26BdP0T.js";import"./forwardRefs-D3j0TLhE.js";import"./index-BC_lDaUs.js";import"./VSelect-Oj6G8zvg.js";import"./VTextField-OC2MD-h5.js";import"./dialog-transition-CW3GHZoY.js";import"./scopeId-B52bk7to.js";import"./VCheckboxBtn-ChBmt2YH.js";import"./VAvatar-DiBZBgNe.js";import"./VImg-D3d_wE_O.js";import"./filter-hXr9DD7N.js";/* empty css              */import"./VPagination-cQoCeFZs.js";import"./AppDateTimePicker-CaNZhCzC.js";import"./rolePermission-CcGIXM2T.js";import"./user-CoUKCDGb.js";import"./index-CQWNJAFP.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./VFileInput-Di64Ez34.js";import"./index-DrMag9BS.js";import"./VDataTable-B58b718v.js";import"./VTable-DXtFM8cn.js";import"./ssrBoot-BVmTJnWd.js";const We={__name:"ChangeStatusDialog",props:{showDialog:Boolean,leadId:Number,statusId:Number,leadStatuses:Array,resolveLeadStatusName:Function},emits:["updateStatus","closeDialog"],setup(j,{emit:G}){const f=j,S=G,_=o(null),h=o("");ve(()=>f.showDialog,c=>{c&&(_.value=f.resolveLeadStatusName(f.statusId))});const V=()=>{S("closeDialog")},C=()=>{_.value!==null&&(S("updateStatus",{leadId:f.leadId,statusId:_.value,statusNote:h.value}),h.value="",V())};return(c,v)=>{const x=Ae,D=pe;return i(),k(fe,{"model-value":f.showDialog,persistent:"",width:c.$vuetify.display.smAndDown?"auto":400,"onClick:outside":V},{default:l(()=>[a(X,null,{default:l(()=>[a(Y,null,{default:l(()=>[d("Select New Status")]),_:1}),a(R,null,{default:l(()=>[a(x,{modelValue:_.value,"onUpdate:modelValue":v[0]||(v[0]=p=>_.value=p),items:f.leadStatuses,"item-title":p=>p.name,"item-value":p=>p.id,label:"Status",placeholder:"Select Status",rules:["requiredValidator"in c?c.requiredValidator:Ie(De)],clearable:""},null,8,["modelValue","items","item-title","item-value","rules"]),a(D,{modelValue:h.value,"onUpdate:modelValue":v[1]||(v[1]=p=>h.value=p),class:"mt-4",label:"Status Note (optional)",placeholder:"Enter status note",rows:"3"},null,8,["modelValue"])]),_:1}),a(me,null,{default:l(()=>[a(Z),a(b,{color:"primary",onClick:C},{default:l(()=>[d("Update Status")]),_:1}),a(b,{text:"",onClick:V},{default:l(()=>[d("Cancel")]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value","width"])}}},Xe={class:"me-3 d-flex gap-3"},Ye={class:"app-user-search-filter d-flex align-center flex-wrap gap-4"},Ze={style:{"inline-size":"15.625rem"}},et={class:"d-flex flex-column ms-3"},tt={class:"d-block font-weight-medium text-truncate text-high-emphasis"},at={class:"text-md"},lt={style:{"list-style-type":"disc","padding-inline-start":"20px"}},st={style:{color:"#757575"}},ot={style:{color:"#007acc"}},nt={style:{color:"orange"}},dt=["onClick"],ut={key:0},rt={style:{"list-style-type":"disc","padding-inline-start":"20px"}},it={style:{color:"#757575"}},ct={style:{color:"#757575"}},pt={style:{color:"#007acc"}},mt={style:{color:"orange"}},vt=["onClick"],ua={__name:"index",props:{userId:{type:String,default:null}},setup(j){const G=j,f=qe(),S=o([]);Te(async()=>{ye()});const _=Pe(),h=o([]),V=o(),C=o(!1),c=o(10),v=o(1),x=o(),D=o(),p=o(""),A=o(null),ee=o(null),$=o(null),I=o(null),T=o(!1),B=o(null),F=o(!1),L=o(!1),z=o(""),U=o(!1),E=ne({}),te=o(!1),M=o(null),H=o(null),P=o(null),q=o(null),_e=s=>{E[s]=!E[s]},J=o(null),ge=[{title:"Actions",key:"actions",sortable:!1},{title:"Lead Country",key:"lead_type"},{title:"Name",key:"name"},{title:"Phone",key:"phone"},{title:"Email",key:"email"},{title:"Interested Course & Country",key:"course_country"},{title:"Current Status",key:"status"},{title:"Status History",key:"statusHistory"},{title:"Assigned Status",key:"assigned_user"},{title:"Assigned User",key:"assigned_user.name_with_email"},{title:"Manager's Note",key:"notes"},{title:"Assigned Branch",key:"branch.branch_name_with_country"}];ve([p,A,$,I,M,H,P,q,J],()=>{N()});const ye=async()=>{await f.getLeadStatus("",1,10,"","",null,!0),S.value=f.leadStatus},N=async()=>{C.value=!0;try{const s=await _.getLeads(G.userId,v.value,c.value,p.value,x.value,D.value,A.value,$.value,I.value,M.value,H.value,P.value,q.value,J.value);h.value=s.data,V.value=s.total}catch(s){console.error("Error fetching leads:",s)}finally{C.value=!1}},Se=s=>{var t,m;N(),x.value=(t=s.sortBy[0])==null?void 0:t.key,D.value=(m=s.sortBy[0])==null?void 0:m.order},ae=(s,t,m)=>{B.value=s,ee.value=t,T.value=!0,te.value=m},he=async({leadId:s,statusId:t,statusNote:m})=>{console.log("convertToStudent",te.value);const K={status:t,status_note:m};await _.updateLeadStatus(s,K),await N(),T.value=!1},Ve=s=>{const t=S.value.find(m=>m.id===s);return t?t.name:"Unknown Status"},we=s=>{const t=S.value.find(m=>m.id===s);return t?t.color_code:"#000"},le=async s=>{if(!s){console.error("Lead ID is required to add a note.");return}try{U.value=!0;const t={note:z.value};await _.addNoteToLead(s,t.note),z.value="",L.value=!1,await N()}catch(t){console.error("Error adding note:",t)}finally{U.value=!1}},O=ne({}),ke=s=>{O[s]=!O[s]},be=s=>{B.value=s,L.value=!0},Ce=()=>{F.value=!F.value};return(s,t)=>{const m=He,K=pe,Le=Me,Ue=Ee,Ne=ze,xe=We;return i(),y("section",null,[a(X,{class:"mb-6"},{default:l(()=>[s.$can("create","lead")?(i(),k($e,{key:0,class:"pb-4"},{default:l(()=>[a(Y,null,{default:l(()=>[d("Filter")]),_:1})]),_:1})):w("",!0),s.$can("create","lead")?(i(),k(R,{key:1},{default:l(()=>[a(Oe,null,{default:l(()=>[a(m,{"selected-assigned-status":M.value,"selected-lead-status":A.value,"selected-dateFrom":$.value,"selected-dateTo":I.value,"selected-lead-type":H.value,"selected-event":P.value,"selected-country":J.value,"selected-branch":q.value,onUpdateAssignedStatus:t[0]||(t[0]=e=>M.value=e),onUpdateLeadStatus:t[1]||(t[1]=e=>A.value=e),onUpdateDateFrom:t[2]||(t[2]=e=>$.value=e),onUpdateDateTo:t[3]||(t[3]=e=>I.value=e),onUpdateLeadType:t[4]||(t[4]=e=>H.value=e),onUpdateEvent:t[5]||(t[5]=e=>P.value=e),onUpdateCountry:t[6]||(t[6]=e=>J.value=e),onUpdateBranch:t[7]||(t[7]=e=>q.value=e),"country-label":"Lead Country"},null,8,["selected-assigned-status","selected-lead-status","selected-dateFrom","selected-dateTo","selected-lead-type","selected-event","selected-country","selected-branch"])]),_:1}),a(fe,{modelValue:L.value,"onUpdate:modelValue":t[11]||(t[11]=e=>L.value=e),"max-width":"500px"},{default:l(()=>[a(X,null,{default:l(()=>[a(Y,null,{default:l(()=>[d("Add a New Note")]),_:1}),a(R,null,{default:l(()=>[a(Re,{onSubmit:Be(le,["prevent"])},{default:l(()=>[a(je,{class:"mt-2"},{default:l(()=>[d(" New Note ")]),_:1}),a(K,{modelValue:z.value,"onUpdate:modelValue":t[8]||(t[8]=e=>z.value=e),placeholder:"Add a new note",class:"mt-2"},null,8,["modelValue"])]),_:1})]),_:1}),a(me,null,{default:l(()=>[a(Z),a(b,{color:"primary",loading:U.value,disabled:U.value,onClick:t[9]||(t[9]=()=>le(B.value))},{default:l(()=>[d(" Submit Note ")]),_:1},8,["loading","disabled"]),a(b,{disabled:U.value,onClick:t[10]||(t[10]=e=>L.value=!1)},{default:l(()=>[d(" Cancel ")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})):w("",!0),a(re),a(R,{class:"d-flex flex-wrap gap-4"},{default:l(()=>[u("div",Xe,[a(Le,{"model-value":c.value,items:[{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:100},{value:-1,title:"All"}],style:{"inline-size":"6.25rem"},"onUpdate:modelValue":t[12]||(t[12]=e=>c.value=parseInt(e,10))},null,8,["model-value"])]),a(Z),u("div",Ye,[u("div",Ze,[a(Ue,{modelValue:p.value,"onUpdate:modelValue":t[13]||(t[13]=e=>p.value=e),placeholder:"Search ...","append-inner-icon":"tabler-search","single-line":"","hide-details":"",dense:"",outlined:""},null,8,["modelValue"])]),s.$can("create","lead")?(i(),k(b,{key:0,"prepend-icon":"tabler-plus",onClick:Ce},{default:l(()=>[d(" Upload Lead ")]),_:1})):w("",!0)]),a(Je,{showUploadCard:F.value,"onUpdate:showUploadCard":t[14]||(t[14]=e=>F.value=e),onLeadsUploaded:N},null,8,["showUploadCard"])]),_:1}),a(re),a(Ge,{"items-per-page":c.value,"onUpdate:itemsPerPage":t[16]||(t[16]=e=>c.value=e),page:v.value,"onUpdate:page":t[17]||(t[17]=e=>v.value=e),loading:C.value,"onUpdate:options":Se,"items-length":V.value,headers:ge,items:h.value,"item-value":"total",class:"text-no-wrap text-sm rounded-0"},{"item.lead_type":l(({item:e})=>{var n,g;return[u("span",null,r(e.lead_type==="social"?(n=e.lead_country)==null?void 0:n.name:(g=e.lead_event)==null?void 0:g.name),1)]}),"item.assigned_user":l(({item:e})=>[a(W,{color:e.assigned_user?"success":"error",size:"small",class:"font-weight-medium",style:{color:"#000",cursor:"pointer"}},{default:l(()=>[d(r(e.assigned_user?"Assigned":"Unassigned"),1)]),_:2},1032,["color"])]),"item.course_country":l(({item:e})=>[u("div",et,[u("span",tt,r(e.interested_course),1),u("span",at,r(e.interested_country),1)])]),"item.notes":l(({item:e})=>[u("ul",lt,[(i(!0),y(de,null,ue(E[e.id]?e.notes:e.notes.slice(0,2),(n,g)=>(i(),y("li",{key:n.id,class:"note",style:{"font-size":"1.1em","margin-block-end":"8px"}},[d(r(n.note)+" ( ",1),u("small",st,[u("span",ot,r(n.created_by),1),d(", "),u("span",nt,r(n.created_at?new Date(n.created_at).toLocaleDateString():"N/A"),1)]),d(" ) ")]))),128))]),e.notes.length>2?(i(),y("p",{key:0,onClick:n=>_e(e.id),style:{color:"blue",cursor:"pointer","font-weight":"bold","padding-inline-start":"10px","text-decoration":"underline"}},r(E[e.id]?"Show Less":"Show More"),9,dt)):w("",!0)]),"item.status":l(({item:e})=>{var n;return[a(W,{color:((n=e.status)==null?void 0:n.color_code)||"#D3D3D3",size:"small",class:"font-weight-medium",style:{cursor:"pointer"},onClick:g=>{var se,oe;return ae(e.id,(se=e.status)==null?void 0:se.id,(oe=e.status)==null?void 0:oe.convert_to_student)}},{default:l(()=>{var g;return[d(r(((g=e.status)==null?void 0:g.name)||"Unknown Status"),1)]}),_:2},1032,["color","onClick"])]}),"item.assigned_branch":l(({item:e})=>[e.assigned_branch?(i(),y("span",ut,r(e.assigned_branch),1)):(i(),k(W,{key:1,color:"error",size:"small",variant:"flat"},{default:l(()=>[d("Not Assigned")]),_:1}))]),"item.actions":l(({item:e})=>[a(b,{icon:"",variant:"text",color:"medium-emphasis",class:"action-button"},{default:l(()=>[a(Q,{icon:"tabler-dots-vertical"}),a(Ke,{activator:"parent","open-on-hover":""},{default:l(()=>[a(Qe,null,{default:l(()=>[a(ie,{onClick:n=>ae(e.id,e.status),class:"change-status-option"},{prepend:l(()=>[a(Q,{icon:"tabler-analyze"})]),default:l(()=>[a(ce,null,{default:l(()=>[d("Change Status")]),_:1})]),_:2},1032,["onClick"]),s.$can("add","manager lead note")?(i(),k(ie,{key:0,onClick:n=>be(e.id),class:"add-note-option"},{prepend:l(()=>[a(Q,{icon:"tabler-clipboard-text"})]),default:l(()=>[a(ce,null,{default:l(()=>[d("Add Note")]),_:1})]),_:2},1032,["onClick"])):w("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),"item.statusHistory":l(({item:e})=>[u("ul",rt,[(i(!0),y(de,null,ue(O[e.id]?e.status_history:e.status_history.slice(0,2),(n,g)=>(i(),y("li",{key:n.id,class:"status-history",style:{"font-size":"1.1em","margin-block-end":"8px"}},[u("span",{style:Fe({color:we(n.status_id)})},r(n.status_name),5),d(" - "),u("span",it,r(n.status_note),1),d(" ( "),u("small",ct,[u("span",pt,r(n.user_name),1),d(", "),u("span",mt,r(n.created_at),1)]),d(" ) ")]))),128))]),e.status_history.length>2?(i(),y("p",{key:0,onClick:n=>ke(e.id),style:{color:"blue",cursor:"pointer","font-weight":"bold","padding-inline-start":"10px","text-decoration":"underline"}},r(O[e.id]?"Show Less":"Show More"),9,vt)):w("",!0)]),bottom:l(()=>[a(Ne,{page:v.value,"onUpdate:page":t[15]||(t[15]=e=>v.value=e),"items-per-page":c.value,"total-items":V.value},null,8,["page","items-per-page","total-items"])]),_:1},8,["items-per-page","page","loading","items-length","items"])]),_:1}),a(xe,{showDialog:T.value,leadId:B.value,statusId:ee.value,leadStatuses:S.value,resolveLeadStatusName:Ve,onUpdateStatus:he,onCloseDialog:t[18]||(t[18]=e=>T.value=!1)},null,8,["showDialog","leadId","statusId","leadStatuses"])])}}};export{ua as default};
