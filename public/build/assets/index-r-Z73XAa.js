import{ao as X,r as _,a5 as k,H as Y,w as Z,a as j,o as f,f as U,e as r,b as e,d as t,c as y,F as I,i as M,n as D,z as N,a7 as q,v as H,y as R,a1 as T,x as $,ad as ee,a3 as te,a6 as se,K as ae,L as le}from"./main-ofHzgIAY.js";import{$ as L}from"./api-BvrX7M5n.js";import{_ as oe}from"./TiptapEditor-Df3Gra1A.js";import{_ as ie}from"./AppAutocomplete-5GD2ryV-.js";import{u as ne}from"./rolePermission-Btf_hpNq.js";import{u as re}from"./user-5TalWUBX.js";import{g as ce,f as me}from"./helpers-BcZI4T5C.js";import{a as de,V as P}from"./VCard-Dcfg7l83.js";import{V as O}from"./VSpacer-DJOSrz1J.js";import{V as G}from"./VCheckbox-CqvXFK26.js";import{V as E}from"./VDivider-DuvArqZJ.js";import{V as K}from"./VTextField-xb93RgJj.js";import{P as J}from"./vue3-perfect-scrollbar.esm-DBqBnj1h.js";import{V as ue}from"./VAvatar-tRwKVM80.js";import{V as pe}from"./VImg-2bZ6XQLP.js";import{V as ve}from"./VCardText-BfSV67Nj.js";import{V as Q}from"./VNavigationDrawer-CIKXPyJ7.js";import{u as fe,a as _e,V as he}from"./VMain-CIUA2av8.js";import"./index-B3bPRkoL.js";import"./index-DMhJU3s8.js";import"./index-dLlCEu5s.js";import"./form-CosX4zmS.js";import"./VSelect-6arwgXOc.js";import"./forwardRefs-C-GTDzx5.js";import"./VList-Chc-hTfA.js";import"./index-B9Ps0IRj.js";import"./ssrBoot-CIGOgPPG.js";import"./index-kQF1U3eN.js";import"./dialog-transition-Cy9-7ZDO.js";import"./easing-CjukEv2V.js";import"./VMenu-CWgYdbXL.js";import"./VOverlay-D6YSy_Pa.js";import"./lazy-BFXR_E98.js";import"./scopeId-BX1eUjKx.js";import"./VCheckboxBtn-C1PsweD_.js";import"./VSelectionControl-Bdfhjnto.js";import"./VChip-DRKWAif9.js";import"./VSlideGroup-DDsmIB84.js";import"./filter-D2fhUCr4.js";/* empty css              */import"./VInput-XIWcCdwi.js";/* empty css                   */import"./VCounter-DcoedzX4.js";import"./VField-CDlTq_pO.js";const W=X({id:"email",state:()=>({receivedEmails:[],sentEmails:[]}),actions:{async fetchReceivedEmails(){try{const d=await L("/emails/received",{method:"GET",headers:{"Content-Type":"application/json"}});this.receivedEmails=d.data}catch(d){console.error("Error fetching received emails:",d)}},async fetchSentEmails(){try{const d=await L("/emails/sent",{method:"GET",headers:{"Content-Type":"application/json"}});this.sentEmails=d.data}catch(d){console.error("Error fetching sent emails:",d)}},async sendEmail({recipients:d,subject:g,body:n}){console.log(d),console.log(g),console.log(n);try{const l=await L("/emails/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({recipients:d,subject:g,body:n})});return this.sentEmails.unshift(l.data),{success:!0,message:"Email sent successfully!"}}catch(l){return console.error("Error sending email:",l),this.errors=l.response?l.response.data.errors:["An unexpected error occurred"],{success:!1,message:"Failed to send email."}}}}}),ge={class:"d-flex align-center"},xe=t("h5",{class:"text-h5"},"Compose Mail",-1),ye={class:"d-flex align-center gap-x-2"},Ve={key:0,class:"px-1 pe-6 py-1"},be={class:"px-1 pe-6 py-1"},$e=t("div",{class:"text-base font-weight-medium text-disabled"}," To: ",-1),we={class:"px-1 pe-6 py-1"},Ce=t("div",{class:"text-base font-weight-medium text-disabled"},"Subject:",-1),Ee={class:"d-flex align-center px-6 py-4"},Se={__name:"ComposeDialog",emits:["close"],setup(d,{emit:g}){const n=g,l=_(""),c=_([]),p=_(""),m=_(""),h=_([]),u=ne(),V=re(),w=W(),B=k(()=>V.allUsers),S=_([]),F=_(ce()==="admin");Y(async()=>{await V.fetcAllhUser(),await v()});const v=async()=>{try{await u.getAllRoles(),S.value=u.roles}catch(s){console.error("Error fetching roles:",s)}};Z(h,(s,a)=>{const C=s.filter(x=>!a.includes(x)),z=a.filter(x=>!s.includes(x));C.forEach(x=>{const i=V.allUsers.filter(b=>b.role===x).map(b=>b.id);c.value=[...new Set([...c.value,...i])]}),z.forEach(x=>{c.value=c.value.filter(i=>!V.allUsers.some(b=>b.id===i&&b.role===x))})});const o=()=>{c.value=[],p.value="",m.value="",l.value="",h.value=[]},A=async()=>{const a={recipients:c.value,subject:p.value,body:l.value},C=await w.sendEmail(a);C.success?(o(),n("close")):console.error(C.message)};return(s,a)=>{const C=j("IconBtn"),z=ie,x=oe;return f(),U(P,{class:"email-compose-dialog",elevation:"10","max-width":"35vw"},{default:r(()=>[e(de,{class:"py-3 px-6"},{default:r(()=>[t("div",ge,[xe,e(O),t("div",ye,[e(C,{size:"small",icon:"tabler-minus",onClick:a[0]||(a[0]=i=>s.$emit("close"))}),e(C,{size:"small",icon:"tabler-x",onClick:a[1]||(a[1]=i=>{s.$emit("close"),o()})})])])]),_:1}),F.value?(f(),y("div",Ve,[(f(!0),y(I,null,M(S.value,i=>(f(),U(G,{key:i.id,label:D(me)(i.role),value:i.role,modelValue:h.value,"onUpdate:modelValue":a[2]||(a[2]=b=>h.value=b),class:"cursor-pointer"},null,8,["label","value","modelValue"]))),128))])):N("",!0),t("div",be,[e(z,{modelValue:c.value,"onUpdate:modelValue":a[3]||(a[3]=i=>c.value=i),items:B.value,"item-title":i=>i.name_with_email,"item-value":i=>i.id,multiple:"",chips:"","closable-chips":""},{"prepend-inner":r(()=>[$e]),_:1},8,["modelValue","items","item-title","item-value"])]),e(E),t("div",we,[e(K,{modelValue:p.value,"onUpdate:modelValue":a[4]||(a[4]=i=>p.value=i),density:"compact"},{"prepend-inner":r(()=>[Ce]),_:1},8,["modelValue"])]),e(E),e(x,{modelValue:l.value,"onUpdate:modelValue":a[5]||(a[5]=i=>l.value=i),placeholder:"Message"},null,8,["modelValue"]),e(E),t("div",Ee,[e(q,{color:"primary",class:"me-4","append-icon":"tabler-send",onClick:a[6]||(a[6]=i=>A())},{default:r(()=>[H(" Send ")]),_:1})])]),_:1})}}},ke={class:"d-flex flex-column h-100"},Ue={key:0,class:"px-6 pb-5 pt-6"},De={class:"email-filters py-4"},Te=["onClick"],Ie={class:"text-base"},Be={__name:"EmailLeftSidebarContent",emits:["toggleComposeDialogVisibility","changeFolder"],setup(d,{emit:g}){const n=g,l=_("inbox"),c=[{title:"Inbox",prependIcon:"tabler-mail",filter:"inbox"},{title:"Sent",prependIcon:"tabler-send",filter:"sent"}],p=m=>{l.value=m,n("changeFolder",m)};return(m,h)=>(f(),y("div",ke,[m.$can("create","email")?(f(),y("div",Ue,[e(q,{block:"",onClick:h[0]||(h[0]=u=>m.$emit("toggleComposeDialogVisibility"))},{default:r(()=>[H(" Compose ")]),_:1})])):N("",!0),t("ul",De,[(f(),y(I,null,M(c,u=>t("li",{key:u.title,class:R(["d-flex align-center cursor-pointer",{"email-filter-active text-primary":l.value===u.filter}]),onClick:V=>p(u.filter)},[e(T,{icon:u.prependIcon,class:"me-2",size:"20"},null,8,["icon"]),t("div",Ie,$(u.title),1)],10,Te)),64))])]))}},Fe={class:"email-view-header d-flex align-center px-5 py-3"},Ae={class:"d-flex align-center flex-wrap flex-grow-1 overflow-hidden gap-2"},ze={class:"text-body-1 text-high-emphasis text-truncate"},Le={class:"d-flex align-start align-sm-center pa-6 gap-x-4"},Re={class:"d-flex flex-wrap flex-grow-1 overflow-hidden"},je={class:"text-truncate"},Me={class:"text-body-1 text-high-emphasis text-truncate"},Ne={class:"text-sm"},Pe={class:"text-disabled text-base"},Oe=["innerHTML"],qe={__name:"EmailView",props:{email:{type:Object,required:!0}},emits:["close"],setup(d,{emit:g}){const n=d;return(l,c)=>{const p=j("IconBtn");return f(),U(Q,{temporary:"","model-value":!!n.email,location:"right",scrim:!1,floating:"",class:"email-view"},{default:r(()=>[n.email?(f(),y(I,{key:0},[t("div",Fe,[e(p,{class:"me-2",onClick:c[0]||(c[0]=m=>l.$emit("close"))},{default:r(()=>[e(T,{size:"22",icon:"tabler-chevron-left",class:"flip-in-rtl"})]),_:1}),t("div",Ae,[t("div",ze,$(n.email.data.subject),1)])]),e(E),e(D(J),{tag:"div",class:"mail-content-container flex-grow-1 pa-sm-12 pa-6",options:{wheelPropagation:!1}},{default:r(()=>[e(P,{class:"mb-4"},{default:r(()=>[t("div",Le,[e(ue,{size:"38"},{default:r(()=>[e(pe,{src:n.email.data.sender_avatar,alt:n.email.data.sender_name},null,8,["src","alt"])]),_:1}),t("div",Re,[t("div",je,[t("div",Me,$(n.email.data.sender_name),1),t("div",Ne,$(n.email.data.sender_email),1)]),e(O),t("div",Pe,$(new Date(n.email.created_at).toDateString()),1)])]),e(E),e(ve,null,{default:r(()=>[t("div",{class:"text-base",innerHTML:n.email.data.body},null,8,Oe)]),_:1})]),_:1})]),_:1})],64)):N("",!0)]),_:1},8,["model-value"])}}},He={class:"d-flex align-center"},Ge=["onClick"],Ke={class:"text-h6"},Je={class:"text-body-2 truncate"},Qe={class:"text-sm text-disabled"},We={key:1,class:"py-4 px-5 text-center"},Xe=t("span",{class:"text-high-emphasis"},"No emails found.",-1),Ye=[Xe],Ot={__name:"index",async setup(d){let g,n;const{isLeftSidebarOpen:l}=fe(),c=W(),p=_(!1),m=_([]),h=_(null),u=_("inbox"),V=async()=>{u.value==="inbox"?await c.fetchReceivedEmails():u.value==="sent"&&await c.fetchSentEmails()};[g,n]=ee(()=>V()),await g,n();const w=k(()=>u.value==="inbox"?c.receivedEmails||[]:u.value==="sent"?c.sentEmails||[]:[]),B=v=>{const o=m.value.indexOf(v);o===-1?m.value.push(v):m.value.splice(o,1)};k(()=>w.value.length>0&&w.value.length===m.value.length),k(()=>!!m.value.length&&w.value.length!==m.value.length);const S=async v=>{u.value=v,await V()},F=v=>{h.value=v};return(v,o)=>{const A=j("IconBtn");return f(),U(he,{style:{"min-block-size":"100%"},class:"email-app-layout"},{default:r(()=>[e(Q,{modelValue:D(l),"onUpdate:modelValue":o[1]||(o[1]=s=>te(l)?l.value=s:null),absolute:"",touchless:"",location:"start",temporary:v.$vuetify.display.mdAndDown},{default:r(()=>[e(Be,{onToggleComposeDialogVisibility:o[0]||(o[0]=s=>p.value=!p.value),onChangeFolder:S})]),_:1},8,["modelValue","temporary"]),e(qe,{email:h.value,onClose:o[2]||(o[2]=s=>h.value=null)},null,8,["email"]),e(_e,null,{default:r(()=>[e(P,{flat:"",class:"email-content-list h-100 d-flex flex-column"},{default:r(()=>[t("div",He,[e(A,{class:"d-lg-none ms-3",onClick:o[3]||(o[3]=s=>l.value=!0)},{default:r(()=>[e(T,{icon:"tabler-menu-2"})]),_:1}),e(K,{modelValue:v.q,"onUpdate:modelValue":o[4]||(o[4]=s=>v.q=s),density:"default",class:"email-search px-sm-2 flex-grow-1 py-1",placeholder:"Search mail"},{"prepend-inner":r(()=>[e(T,{icon:"tabler-search",size:"24",class:"me-1 text-medium-emphasis"})]),_:1},8,["modelValue"])]),e(E),e(D(J),{tag:"ul",options:{wheelPropagation:!1},class:"email-list"},{default:r(()=>[w.value.length>0?(f(!0),y(I,{key:0},M(w.value,s=>(f(),y("li",{key:s.id,class:R(["email-item d-flex align-center pa-4 gap-2 cursor-pointer",[{"email-read":s.read_at}]]),onClick:a=>F(s)},[e(G,{"model-value":m.value.includes(s.id),class:"flex-shrink-0","onUpdate:modelValue":a=>B(s.id),onClick:o[5]||(o[5]=se(()=>{},["stop"]))},null,8,["model-value","onUpdate:modelValue"]),t("h6",Ke,$(s.data.sender_name),1),t("span",Je,$(s.data.subject),1),e(O),t("div",{class:R(["email-meta align-center gap-2",v.$vuetify.display.xs?"d-none":""])},[t("span",Qe,$(new Date(s.created_at).toLocaleString()),1)],2)],10,Ge))),128)):(f(),y("li",We,Ye))]),_:1})]),_:1}),ae(e(Se,{onClose:o[6]||(o[6]=s=>p.value=!1)},null,512),[[le,p.value]])]),_:1})]),_:1})}}};export{Ot as default};
