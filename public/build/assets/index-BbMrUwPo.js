import{an as W,r as _,a5 as k,H as X,w as Y,a as j,o as v,f as D,e as n,b as e,d as s,c as w,F as I,i as R,n as T,a7 as P,v as O,z as q,y as L,a1 as U,x as $,ad as Z,a3 as ee,a6 as te,K as se,L as ae}from"./main-DYSjY2V3.js";import{$ as A}from"./api-Bx79Vctl.js";import{_ as le}from"./TiptapEditor-DJj-BBPs.js";import{_ as oe}from"./AppAutocomplete-nNayl4M1.js";import{u as ie}from"./rolePermission-CsfI9I49.js";import{u as ne}from"./user-BVgqoFCF.js";import{f as re}from"./helpers-D1bXR6is.js";import{a as ce,V as M}from"./VCard-CiYH5VQe.js";import{V as N}from"./VSpacer-C69Csaoq.js";import{V as H}from"./VCheckbox-UHFV0pje.js";import{V as E}from"./VDivider-CH8Yhyyw.js";import{V as G}from"./VTextField-BVjexeS2.js";import{P as K}from"./vue3-perfect-scrollbar.esm-BSSP1m45.js";import{V as me}from"./VAvatar-QvG5RvO1.js";import{V as de}from"./VImg-Bfl9zub6.js";import{V as ue}from"./VCardText-BxWv1fYU.js";import{V as J}from"./VNavigationDrawer-Bl3RKCKN.js";import{u as pe,a as ve,V as fe}from"./VMain-Etpp3MO7.js";import"./index-B3bPRkoL.js";import"./index-BAtoe-vw.js";import"./index-Bujm0REJ.js";import"./form-KXPpmlAe.js";import"./VSelect-DhcjVjRG.js";import"./forwardRefs-C-GTDzx5.js";import"./VList-2j7MyfA6.js";import"./index-BWzO9ddJ.js";import"./ssrBoot-BYPlKdcr.js";import"./index-5A8LiR52.js";import"./dialog-transition-w05nU5OS.js";import"./easing-CjukEv2V.js";import"./VMenu-eeOjuncG.js";import"./VOverlay-Yt9LwXsZ.js";import"./lazy-V0kpBqvY.js";import"./scopeId-DW_WIG5W.js";import"./VCheckboxBtn-DWuf6daV.js";import"./VSelectionControl-BlKyXb78.js";import"./VChip-DOF_MDg3.js";import"./VSlideGroup--tDWDzDB.js";import"./filter-CkQZNv4t.js";/* empty css              */import"./VInput-B3yaOjYZ.js";/* empty css                   */import"./VCounter-j5sdlGNz.js";import"./VField-BAih5TUr.js";const Q=W({id:"email",state:()=>({receivedEmails:[],sentEmails:[]}),actions:{async fetchReceivedEmails(){try{const m=await A("/emails/received",{method:"GET",headers:{"Content-Type":"application/json"}});this.receivedEmails=m.data}catch(m){console.error("Error fetching received emails:",m)}},async fetchSentEmails(){try{const m=await A("/emails/sent",{method:"GET",headers:{"Content-Type":"application/json"}});this.sentEmails=m.data}catch(m){console.error("Error fetching sent emails:",m)}},async sendEmail({recipients:m,subject:h,body:o}){console.log(m),console.log(h),console.log(o);try{const a=await A("/emails/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({recipients:m,subject:h,body:o})});return this.sentEmails.unshift(a.data),{success:!0,message:"Email sent successfully!"}}catch(a){return console.error("Error sending email:",a),this.errors=a.response?a.response.data.errors:["An unexpected error occurred"],{success:!1,message:"Failed to send email."}}}}}),_e={class:"d-flex align-center"},he=s("h5",{class:"text-h5"},"Compose Mail",-1),ge={class:"d-flex align-center gap-x-2"},xe={class:"px-1 pe-6 py-1"},ye={class:"px-1 pe-6 py-1"},Ve=s("div",{class:"text-base font-weight-medium text-disabled"}," To: ",-1),be={class:"px-1 pe-6 py-1"},$e=s("div",{class:"text-base font-weight-medium text-disabled"},"Subject:",-1),we={class:"d-flex align-center px-6 py-4"},Ce={__name:"ComposeDialog",emits:["close"],setup(m,{emit:h}){const o=h,a=_(""),r=_([]),p=_(""),c=_(""),f=_([]),d=ie(),V=ne(),C=Q(),B=k(()=>V.allUsers),S=_([]);X(async()=>{await V.fetcAllhUser(),await F()});const F=async()=>{try{await d.getAllRoles(),S.value=d.roles}catch(g){console.error("Error fetching roles:",g)}};Y(f,(g,t)=>{const x=g.filter(y=>!t.includes(y)),z=t.filter(y=>!g.includes(y));x.forEach(y=>{const l=V.allUsers.filter(b=>b.role===y).map(b=>b.id);r.value=[...new Set([...r.value,...l])]}),z.forEach(y=>{r.value=r.value.filter(l=>!V.allUsers.some(b=>b.id===l&&b.role===y))})});const u=()=>{r.value=[],p.value="",c.value="",a.value="",f.value=[]},i=async()=>{const t={recipients:r.value,subject:p.value,body:a.value},x=await C.sendEmail(t);x.success?(u(),o("close")):console.error(x.message)};return(g,t)=>{const x=j("IconBtn"),z=oe,y=le;return v(),D(M,{class:"email-compose-dialog",elevation:"10","max-width":"35vw"},{default:n(()=>[e(ce,{class:"py-3 px-6"},{default:n(()=>[s("div",_e,[he,e(N),s("div",ge,[e(x,{size:"small",icon:"tabler-minus",onClick:t[0]||(t[0]=l=>g.$emit("close"))}),e(x,{size:"small",icon:"tabler-x",onClick:t[1]||(t[1]=l=>{g.$emit("close"),u()})})])])]),_:1}),s("div",xe,[(v(!0),w(I,null,R(S.value,l=>(v(),D(H,{key:l.id,label:T(re)(l.role),value:l.role,modelValue:f.value,"onUpdate:modelValue":t[2]||(t[2]=b=>f.value=b),class:"cursor-pointer"},null,8,["label","value","modelValue"]))),128))]),s("div",ye,[e(z,{modelValue:r.value,"onUpdate:modelValue":t[3]||(t[3]=l=>r.value=l),items:B.value,"item-title":l=>l.name_with_email,"item-value":l=>l.id,multiple:"",chips:"","closable-chips":""},{"prepend-inner":n(()=>[Ve]),_:1},8,["modelValue","items","item-title","item-value"])]),e(E),s("div",be,[e(G,{modelValue:p.value,"onUpdate:modelValue":t[4]||(t[4]=l=>p.value=l),density:"compact"},{"prepend-inner":n(()=>[$e]),_:1},8,["modelValue"])]),e(E),e(y,{modelValue:a.value,"onUpdate:modelValue":t[5]||(t[5]=l=>a.value=l),placeholder:"Message"},null,8,["modelValue"]),e(E),s("div",we,[e(P,{color:"primary",class:"me-4","append-icon":"tabler-send",onClick:t[6]||(t[6]=l=>i())},{default:n(()=>[O(" Send ")]),_:1})])]),_:1})}}},Ee={class:"d-flex flex-column h-100"},Se={key:0,class:"px-6 pb-5 pt-6"},ke={class:"email-filters py-4"},De=["onClick"],Te={class:"text-base"},Ue={__name:"EmailLeftSidebarContent",emits:["toggleComposeDialogVisibility","changeFolder"],setup(m,{emit:h}){const o=h,a=_("inbox"),r=[{title:"Inbox",prependIcon:"tabler-mail",filter:"inbox"},{title:"Sent",prependIcon:"tabler-send",filter:"sent"}],p=c=>{a.value=c,o("changeFolder",c)};return(c,f)=>(v(),w("div",Ee,[c.$can("create","email")?(v(),w("div",Se,[e(P,{block:"",onClick:f[0]||(f[0]=d=>c.$emit("toggleComposeDialogVisibility"))},{default:n(()=>[O(" Compose ")]),_:1})])):q("",!0),s("ul",ke,[(v(),w(I,null,R(r,d=>s("li",{key:d.title,class:L(["d-flex align-center cursor-pointer",{"email-filter-active text-primary":a.value===d.filter}]),onClick:V=>p(d.filter)},[e(U,{icon:d.prependIcon,class:"me-2",size:"20"},null,8,["icon"]),s("div",Te,$(d.title),1)],10,De)),64))])]))}},Ie={class:"email-view-header d-flex align-center px-5 py-3"},Be={class:"d-flex align-center flex-wrap flex-grow-1 overflow-hidden gap-2"},Fe={class:"text-body-1 text-high-emphasis text-truncate"},ze={class:"d-flex align-start align-sm-center pa-6 gap-x-4"},Ae={class:"d-flex flex-wrap flex-grow-1 overflow-hidden"},Le={class:"text-truncate"},je={class:"text-body-1 text-high-emphasis text-truncate"},Re={class:"text-sm"},Me={class:"text-disabled text-base"},Ne=["innerHTML"],Pe={__name:"EmailView",props:{email:{type:Object,required:!0}},emits:["close"],setup(m,{emit:h}){const o=m;return(a,r)=>{const p=j("IconBtn");return v(),D(J,{temporary:"","model-value":!!o.email,location:"right",scrim:!1,floating:"",class:"email-view"},{default:n(()=>[o.email?(v(),w(I,{key:0},[s("div",Ie,[e(p,{class:"me-2",onClick:r[0]||(r[0]=c=>a.$emit("close"))},{default:n(()=>[e(U,{size:"22",icon:"tabler-chevron-left",class:"flip-in-rtl"})]),_:1}),s("div",Be,[s("div",Fe,$(o.email.data.subject),1)])]),e(E),e(T(K),{tag:"div",class:"mail-content-container flex-grow-1 pa-sm-12 pa-6",options:{wheelPropagation:!1}},{default:n(()=>[e(M,{class:"mb-4"},{default:n(()=>[s("div",ze,[e(me,{size:"38"},{default:n(()=>[e(de,{src:o.email.data.sender_avatar,alt:o.email.data.sender_name},null,8,["src","alt"])]),_:1}),s("div",Ae,[s("div",Le,[s("div",je,$(o.email.data.sender_name),1),s("div",Re,$(o.email.data.sender_email),1)]),e(N),s("div",Me,$(new Date(o.email.created_at).toDateString()),1)])]),e(E),e(ue,null,{default:n(()=>[s("div",{class:"text-base",innerHTML:o.email.data.body},null,8,Ne)]),_:1})]),_:1})]),_:1})],64)):q("",!0)]),_:1},8,["model-value"])}}},Oe={class:"d-flex align-center"},qe=["onClick"],He={class:"text-h6"},Ge={class:"text-body-2 truncate"},Ke={class:"text-sm text-disabled"},Je={key:1,class:"py-4 px-5 text-center"},Qe=s("span",{class:"text-high-emphasis"},"No emails found.",-1),We=[Qe],Nt={__name:"index",async setup(m){let h,o;const{isLeftSidebarOpen:a}=pe(),r=Q(),p=_(!1),c=_([]),f=_(null),d=_("inbox"),V=async()=>{d.value==="inbox"?await r.fetchReceivedEmails():d.value==="sent"&&await r.fetchSentEmails()};[h,o]=Z(()=>V()),await h,o();const C=k(()=>d.value==="inbox"?r.receivedEmails||[]:d.value==="sent"?r.sentEmails||[]:[]),B=u=>{const i=c.value.indexOf(u);i===-1?c.value.push(u):c.value.splice(i,1)};k(()=>C.value.length>0&&C.value.length===c.value.length),k(()=>!!c.value.length&&C.value.length!==c.value.length);const S=async u=>{d.value=u,await V()},F=u=>{f.value=u};return(u,i)=>{const g=j("IconBtn");return v(),D(fe,{style:{"min-block-size":"100%"},class:"email-app-layout"},{default:n(()=>[e(J,{modelValue:T(a),"onUpdate:modelValue":i[1]||(i[1]=t=>ee(a)?a.value=t:null),absolute:"",touchless:"",location:"start",temporary:u.$vuetify.display.mdAndDown},{default:n(()=>[e(Ue,{onToggleComposeDialogVisibility:i[0]||(i[0]=t=>p.value=!p.value),onChangeFolder:S})]),_:1},8,["modelValue","temporary"]),e(Pe,{email:f.value,onClose:i[2]||(i[2]=t=>f.value=null)},null,8,["email"]),e(ve,null,{default:n(()=>[e(M,{flat:"",class:"email-content-list h-100 d-flex flex-column"},{default:n(()=>[s("div",Oe,[e(g,{class:"d-lg-none ms-3",onClick:i[3]||(i[3]=t=>a.value=!0)},{default:n(()=>[e(U,{icon:"tabler-menu-2"})]),_:1}),e(G,{modelValue:u.q,"onUpdate:modelValue":i[4]||(i[4]=t=>u.q=t),density:"default",class:"email-search px-sm-2 flex-grow-1 py-1",placeholder:"Search mail"},{"prepend-inner":n(()=>[e(U,{icon:"tabler-search",size:"24",class:"me-1 text-medium-emphasis"})]),_:1},8,["modelValue"])]),e(E),e(T(K),{tag:"ul",options:{wheelPropagation:!1},class:"email-list"},{default:n(()=>[C.value.length>0?(v(!0),w(I,{key:0},R(C.value,t=>(v(),w("li",{key:t.id,class:L(["email-item d-flex align-center pa-4 gap-2 cursor-pointer",[{"email-read":t.read_at}]]),onClick:x=>F(t)},[e(H,{"model-value":c.value.includes(t.id),class:"flex-shrink-0","onUpdate:modelValue":x=>B(t.id),onClick:i[5]||(i[5]=te(()=>{},["stop"]))},null,8,["model-value","onUpdate:modelValue"]),s("h6",He,$(t.data.sender_name),1),s("span",Ge,$(t.data.subject),1),e(N),s("div",{class:L(["email-meta align-center gap-2",u.$vuetify.display.xs?"d-none":""])},[s("span",Ke,$(new Date(t.created_at).toLocaleString()),1)],2)],10,qe))),128)):(v(),w("li",Je,We))]),_:1})]),_:1}),se(e(Ce,{onClose:i[6]||(i[6]=t=>p.value=!1)},null,512),[[ae,p.value]])]),_:1})]),_:1})}}};export{Nt as default};
