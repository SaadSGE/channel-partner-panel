import{_ as de}from"./AppAutocomplete-BGhT2gC-.js";import{_ as H}from"./Filters-YHBREwHi.js";import{c as ue}from"./commonFunction-DmABFiwz.js";import{u as ce}from"./leadStore-DeE1-9Ev.js";import{u as me}from"./rolePermission-D0rRr6if.js";import{u as pe}from"./user-VsMhEKD5.js";import fe from"./EditNewUserDrawer-B38nbJOA.js";import{S as C}from"./sweetalert2-z6gKu1nJ.js";import{i as E}from"./index-3l3OcLC-.js";import{a6 as W,r as l,H as _e,w as K,o as d,c as g,b as t,d as m,e as a,v as u,f as F,n as M,z as U,a9 as Q,F as I,x as c,i as ve,R as ge,U as he}from"./main-DQ8imrPL.js";import{g as ye}from"./helpers-BLqcuQdp.js";import{_ as be}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{a as q,b as G,V as S}from"./VCard-hsXFQPdP.js";import{V as h}from"./VCardText-DwMGks7Y.js";import{V,a as y}from"./VRow-BtvOnLOs.js";import{V as J}from"./VDivider-CvW0055Y.js";import{a as Ve}from"./VSelect-DYijDQRO.js";import{V as xe}from"./VDataTableServer-AWwyQ-Xy.js";import{V as X}from"./VChip-DUUEoPog.js";import{V as we}from"./VTextField-C4eJPcCU.js";import{V as Ue}from"./VBadge-DA1mleJD.js";import"./VInput-D_HU0RMb.js";import"./index-D9ALrzhC.js";import"./index-Ci0ccYTD.js";import"./forwardRefs-D3j0TLhE.js";import"./filter-COhOmeq5.js";import"./VList-RF2L5Xq6.js";import"./ssrBoot-Ro4gLBC4.js";import"./VAvatar-DCQwUvNc.js";import"./VImg-Dg1P7Eon.js";import"./VMenu-KPe6oNs9.js";import"./dialog-transition-CO4rE-4B.js";import"./scopeId-DsV7-D64.js";import"./VCheckboxBtn-BeEIBr2s.js";import"./AppDateTimePicker-Bsic6V2w.js";import"./AppSelect-BZQ1fS2B.js";import"./AppTextField-C0AnWscM.js";import"./validators-G0zz44T_.js";import"./AppDrawerHeaderSection-BOPNUi-V.js";import"./VSpacer-Bf33O4Gs.js";/* empty css              */import"./auth-nrGPX5OC.js";import"./vue3-perfect-scrollbar.esm-CooR391H.js";import"./VNavigationDrawer-DIZ3kdnX.js";import"./VForm-CI54WUGc.js";import"./VFileInput-DnDJbYmn.js";import"./VCheckbox-DzSKbrFb.js";import"./VDataTable-B_BBZhTl.js";import"./VPagination-BWTDkjND.js";import"./VTable-X2ruhouG.js";const D=L=>(ge("data-v-9ef701fe"),L=L(),he(),L),Le={key:0},Ce=D(()=>m("div",{class:"text-h6 text-white mb-1"},"Total Leads Available",-1)),Se={class:"text-h4 text-white"},ke=D(()=>m("div",{class:"text-h6 text-white mb-1"},"Total Leads Assigned",-1)),Be={class:"text-h4 text-white"},Te=D(()=>m("div",{class:"text-h6 text-white mb-1"},"Remaining Leads",-1)),Ae={class:"text-h4 text-white"},Ee={key:0},Fe={class:"d-flex align-center justify-space-between my-1 country-lead-item pa-2"},Ie={key:1,class:"text-grey"},De={__name:"assigned-operation",setup(L){const Y=W(()=>"calc(100vh - 200px)"),Z=pe();me();const x=ue();l(!1);const p=l([]),N=l(0),O=l(10),k=l(1);l(),l();const R=l("");l(null),l(null);const b=l(null);l(null),l(),l(),l(null);const i=l(!1);l([]);const P=l(!1),ee=l(null);l(!1),l(null),l(null),l(ye()==="admin");const B=l([]),f=l(null),_=l(null),T=l(1);l([]);const $=ce(),v=l(0),w=l(null),A=l(null),z=W(()=>p.value.reduce((s,o)=>s+(parseInt(o.assigned_number_of_leads)||0),0)),te=s=>{console.log(s);const o=p.value.findIndex(r=>r.id===s.id);o!==-1&&p.value.splice(o,1,s)},ae=async()=>{i.value=!0;try{const s=await Z.fetchUsers(k.value,R.value,"Counsellor",null,null,null,null,null,_.value);p.value=s.data,N.value=s.total}catch(s){console.error("Error fetching users:",s)}finally{i.value=!1}},le=[{title:"Branch",key:"branch.name"},{title:"Name",key:"full_name"},{title:"Email",key:"email"},{title:"Current Lead",key:"current_lead",width:"200px"},{title:"Assigned Number of Leads",key:"assigned_number_of_leads",align:"center"}],se=async(s,o)=>{try{const r=parseInt(o);if(r===0){s.assigned_number_of_leads=0;return}if(p.value.reduce((n,j)=>j.id!==s.id?n+(parseInt(j.assigned_number_of_leads)||0):n,0)+r>v.value){C.fire({title:"Warning!",text:`Total assigned leads cannot exceed ${v.value}`,icon:"warning",confirmButtonText:"OK"}),s.assigned_number_of_leads=0;return}s.assigned_number_of_leads=r}catch(r){console.error("Error updating assigned leads:",r),C.fire("Error!","Failed to update assigned leads","error")}},oe=async()=>{i.value=!0;try{const s=await $.fetchLeadCount(b.value,f.value);if(v.value=s.total||0,v.value===0){C.fire("Warning!","No unassigned leads found for the selected country","warning");return}T.value=2}catch(s){console.error("Error fetching leads:",s),C.fire("Error!","Failed to fetch leads","error")}finally{i.value=!1}},re=()=>{setTimeout(()=>{location.reload()},3e3)},ne=async()=>{i.value=!0;try{const s=p.value.map(r=>({user_id:r.id,assigned_leads:r.assigned_number_of_leads||0})).filter(r=>r.assigned_leads>0);(await $.saveAssignedLeads(s,b.value,f.value)).status?(E("Leads assigned successfully",{type:"success",position:"top-right",theme:"colored"}),re()):E("Failed to save assigned leads",{type:"error",position:"top-right",theme:"colored"})}catch(s){console.error("Error saving assigned leads:",s),E("Failed to save assigned leads",{type:"error",position:"top-right",theme:"colored"})}finally{i.value=!1}};_e(async()=>{await x.getAllCountries(),await ie()}),K([R,_],()=>{ae()});const ie=async()=>{i.value=!0;try{await x.getBranches(),B.value=x.branches}catch(s){console.error("Error fetching branches:",s)}finally{i.value=!1}};return K([w,A,b,f],()=>{_.value=null,p.value.forEach(s=>{s.assigned_number_of_leads=0}),T.value=1}),(s,o)=>{const r=de;return d(),g(I,null,[t(fe,{isDrawerOpen:P.value,editedUser:ee.value,branches:B.value,"onUpdate:isDrawerOpen":o[0]||(o[0]=e=>P.value=e),onUserUpdated:te},null,8,["isDrawerOpen","editedUser","branches"]),m("section",null,[t(S,{class:"mb-6"},{default:a(()=>[m("div",null,[t(q,null,{default:a(()=>[t(G,null,{default:a(()=>[u("Select Lead Location")]),_:1})]),_:1}),t(h,null,{default:a(()=>[t(V,null,{default:a(()=>[t(H,{"selected-lead-type":w.value,onUpdateLeadType:o[1]||(o[1]=e=>w.value=e),"country-label":"Lead Country","branch-label":"Lead Branch (Optional)"},null,8,["selected-lead-type"])]),_:1}),w.value==="social"?(d(),F(V,{key:0},{default:a(()=>[t(y,{cols:"12",md:"4"},{default:a(()=>[t(r,{modelValue:b.value,"onUpdate:modelValue":o[2]||(o[2]=e=>b.value=e),items:M(x).allCountries,"item-title":e=>e.name,"item-value":e=>e.id,label:"Select Country",placeholder:"Select Country",clearable:"",class:"slide-in"},null,8,["modelValue","items","item-title","item-value"])]),_:1}),t(y,{cols:"12",md:"4"},{default:a(()=>[t(r,{modelValue:f.value,"onUpdate:modelValue":o[3]||(o[3]=e=>f.value=e),items:M(x).branches,"item-title":e=>e.name,"item-value":e=>e.id,label:"Select Branch",placeholder:"Select Branch",clearable:"",class:"slide-in"},null,8,["modelValue","items","item-title","item-value"])]),_:1})]),_:1})):U("",!0),w.value==="event"?(d(),F(V,{key:1},{default:a(()=>[t(H,{"selected-event":A.value,"selected-branch":f.value,onUpdateEvent:o[4]||(o[4]=e=>A.value=e),onUpdateBranch:o[5]||(o[5]=e=>f.value=e),"branch-label":"Lead Branch"},null,8,["selected-event","selected-branch"])]),_:1})):U("",!0),t(V,{class:"mt-4"},{default:a(()=>[t(y,{cols:"12",class:"text-center"},{default:a(()=>[t(Q,{color:"primary",disabled:!b.value,loading:i.value,onClick:oe},{default:a(()=>[u(" Continue ")]),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1})]),T.value===2&&v.value>0?(d(),g("div",Le,[t(J,{class:"my-4"}),t(q,null,{default:a(()=>[t(G,null,{default:a(()=>[u("Assign Leads to Counsellors(To complete this step, select a branch)")]),_:1})]),_:1}),t(h,null,{default:a(()=>[t(V,null,{default:a(()=>[t(y,{cols:"12",md:"4"},{default:a(()=>[t(Ve,{modelValue:_.value,"onUpdate:modelValue":o[6]||(o[6]=e=>_.value=e),items:B.value,"item-title":"name","item-value":"id",label:"Select Branch"},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1}),_.value?(d(),g(I,{key:0},[t(h,{class:"text-end mb-4"},{default:a(()=>[t(Q,{color:"primary",loading:i.value,onClick:ne},{default:a(()=>[u(" Save Assigned Leads ")]),_:1},8,["loading"])]),_:1}),_.value?(d(),F(h,{key:0},{default:a(()=>[t(V,null,{default:a(()=>[t(y,{cols:"12",md:"4"},{default:a(()=>[t(S,{class:"bg-primary"},{default:a(()=>[t(h,{class:"text-center"},{default:a(()=>[Ce,m("div",Se,c(v.value),1)]),_:1})]),_:1})]),_:1}),t(y,{cols:"12",md:"4"},{default:a(()=>[t(S,{class:"bg-success"},{default:a(()=>[t(h,{class:"text-center"},{default:a(()=>[ke,m("div",Be,c(z.value),1)]),_:1})]),_:1})]),_:1}),t(y,{cols:"12",md:"4"},{default:a(()=>[t(S,{class:"bg-info"},{default:a(()=>[t(h,{class:"text-center"},{default:a(()=>[Te,m("div",Ae,c(v.value-z.value),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):U("",!0),t(xe,{"items-per-page":O.value,"onUpdate:itemsPerPage":o[7]||(o[7]=e=>O.value=e),page:k.value,"onUpdate:page":o[8]||(o[8]=e=>k.value=e),items:p.value,"items-length":N.value,headers:le,class:"text-no-wrap",height:Y.value},{"item.branch.name":a(({item:e})=>{var n;return[u(c(((n=e.branch)==null?void 0:n.branch_name_with_country)||"N/A"),1)]}),"item.full_name":a(({item:e})=>[u(c(e.full_name),1)]),"item.email":a(({item:e})=>[u(c(e.email),1)]),"item.current_lead":a(({item:e})=>[e.lead_counts?(d(),g("div",Ee,[m("div",Fe,[t(X,{size:"small",color:"error",variant:"elevated",class:"mr-2"},{default:a(()=>[u(" Total: "+c(e.lead_counts.lead_count_all),1)]),_:2},1024)]),t(J,{class:"my-1"}),(d(!0),g(I,null,ve(e.lead_counts.lead_by_country,n=>(d(),g("div",{key:n.country_id,class:"d-flex align-center justify-space-between my-1 country-lead-item pa-2"},[t(X,{size:"small",color:"primary",variant:"elevated",class:"mr-2"},{default:a(()=>[u(c(n.country_name),1)]),_:2},1024),t(Ue,{content:n.count,color:"success",class:"count-badge"},null,8,["content"])]))),128))])):(d(),g("span",Ie,"0"))]),"item.role":a(({item:e})=>[u(c(e.role),1)]),"item.assigned_number_of_leads":a(({item:e})=>[t(we,{modelValue:e.assigned_number_of_leads,"onUpdate:modelValue":[n=>e.assigned_number_of_leads=n,n=>se(e,n)],type:"number",min:"0",density:"compact",variant:"outlined","hide-details":"",class:"w-20",placeholder:"Enter number"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["items-per-page","page","items","items-length","height"])],64)):U("",!0)])):U("",!0)]),_:1})])],64)}}},Et=be(De,[["__scopeId","data-v-9ef701fe"]]);export{Et as default};
