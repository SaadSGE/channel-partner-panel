import{_ as X}from"./AppTextField-DvNF0h3r.js";import{_ as G}from"./DialogCloseBtn-x-JZmyaY.js";import{u as z}from"./rolePermission-ICGceqAs.js";import{f as B}from"./helpers-CK0esMst.js";import{V as N}from"./VCard-Bvr6JzHJ.js";import{V as $}from"./VCardText-BZRdhyJL.js";import{V as J}from"./VForm-CDQsog1Y.js";import{V as K}from"./VTable-jJCx2jRJ.js";import{V as P}from"./VCheckbox-DiysMeg0.js";import{r as f,H,a5 as q,w as j,o as m,f as L,e as t,b as e,d as l,x as y,n as _,c as V,F as R,i as A,a7 as O,v as k,a as W,a1 as Y,a3 as F}from"./main-Bu07ZU8n.js";import{V as Z}from"./VDialog-CTvqhvK8.js";import{a as E,V as M}from"./VRow-CcJHtXmu.js";import{V as ee}from"./VSpacer-BKjvkR1x.js";const le={class:"text-h4 text-center mb-2"},se=l("p",{class:"text-body-1 text-center mb-6"}," Set Role Permissions ",-1),te=l("h5",{class:"text-h5 my-6"}," Role Permissions ",-1),oe={class:"text-h6"},ae={class:"d-flex justify-end"},ne={class:"d-flex justify-end"},ie={class:"d-flex justify-end"},de={class:"d-flex justify-end"},re=l("h5",{class:"text-h5 my-6"}," Custom Permissions ",-1),ue={class:"text-h6"},ce={colspan:"4"},me={class:"d-flex justify-end"},fe={class:"d-flex align-center justify-center gap-4"},_e={__name:"AddEditRoleDialog",props:{rolePermissions:{type:Object,required:!1,default:()=>({id:"",name:"",permissions:[]})},isDialogVisible:{type:Boolean,required:!0}},emits:["update:isDialogVisible","update:rolePermissions"],setup(I,{emit:D}){const g=z(),o=f([]),c=f([]);H(async()=>{await g.getAllPermission(),o.value=g.permissions,o.value.forEach(s=>{c.value=[...new Set([...c.value,...Object.keys(s.custom_permissions||{})])]})});const d=I,p=D,h=f(!1),b=f(""),r=f(null),C=f(),x=q(()=>{let s=0;return o.value.forEach(i=>{Object.entries(i).forEach(([u,w])=>{u!=="name"&&w&&s++}),Object.values(i.custom_permissions||{}).forEach(u=>{u&&s++})}),s}),n=q(()=>x.value>0&&x.value<o.value.length*(4+c.value.length));j(h,s=>{o.value=o.value.map(i=>({...i,read:s,edit:s,create:s,delete:s,custom_permissions:Object.fromEntries(Object.entries(i.custom_permissions||{}).map(([u])=>[u,s]))}))}),j(n,()=>{n.value||(h.value=!1)}),j(o,()=>{x.value===o.value.length*(4+c.value.length)&&(h.value=!0)},{deep:!0}),j(d,()=>{d.rolePermissions&&d.rolePermissions.permissions.length&&(b.value=d.rolePermissions.name,r.value=d.rolePermissions.id,o.value=o.value.map(s=>{var u;const i=(u=d.rolePermissions)==null?void 0:u.permissions.find(w=>w.name===s.name);return i?{...s,...i,custom_permissions:{...s.custom_permissions,...i.custom_permissions||{}}}:s}))});const T=async()=>{var i;const s={id:r.value,name:b.value,permissions:o.value};try{await g.setRolePermission(s),p("update:rolePermissions",s),p("update:isDialogVisible",!1),p("roleSubmitted"),h.value=!1,(i=C.value)==null||i.reset()}catch(u){console.error("Failed to save role permissions:",u)}},S=()=>{var s;p("update:isDialogVisible",!1),h.value=!1,(s=C.value)==null||s.reset()};return(s,i)=>{const u=G,w=X;return m(),L(Z,{width:s.$vuetify.display.smAndDown?"auto":900,"model-value":d.isDialogVisible,"onUpdate:modelValue":S},{default:t(()=>[e(u,{onClick:S}),e(N,{class:"pa-sm-10 pa-2"},{default:t(()=>[e($,null,{default:t(()=>[l("h4",le,y(d.rolePermissions.name?"Edit":"Add New")+" Role ",1),se,e(_(J),{ref_key:"refPermissionForm",ref:C},{default:t(()=>[e(w,{modelValue:b.value,"onUpdate:modelValue":i[0]||(i[0]=a=>b.value=a),label:"Role Name",placeholder:"Enter Role Name"},null,8,["modelValue"]),te,e(K,{class:"permission-table text-no-wrap mb-6"},{default:t(()=>[(m(!0),V(R,null,A(o.value,a=>(m(),V("tr",{key:a.name},[l("td",null,[l("h6",oe,y(_(B)(a.name)),1)]),l("td",null,[l("div",ae,[e(P,{modelValue:a.read,"onUpdate:modelValue":v=>a.read=v,label:"Read"},null,8,["modelValue","onUpdate:modelValue"])])]),l("td",null,[l("div",ne,[e(P,{modelValue:a.create,"onUpdate:modelValue":v=>a.create=v,label:"Create"},null,8,["modelValue","onUpdate:modelValue"])])]),l("td",null,[l("div",ie,[e(P,{modelValue:a.edit,"onUpdate:modelValue":v=>a.edit=v,label:"Edit"},null,8,["modelValue","onUpdate:modelValue"])])]),l("td",null,[l("div",de,[e(P,{modelValue:a.delete,"onUpdate:modelValue":v=>a.delete=v,label:"Delete"},null,8,["modelValue","onUpdate:modelValue"])])])]))),128))]),_:1}),re,e(K,{class:"permission-table text-no-wrap mb-6"},{default:t(()=>[(m(!0),V(R,null,A(o.value,a=>(m(),V(R,{key:a.name},[(m(!0),V(R,null,A(a.custom_permissions,(v,U)=>(m(),V("tr",{key:U},[l("td",null,[l("h6",ue,y(_(B)(a.name))+" "+y(_(B)(U)),1)]),l("td",ce,[l("div",me,[e(P,{modelValue:a.custom_permissions[U],"onUpdate:modelValue":Q=>a.custom_permissions[U]=Q},null,8,["modelValue","onUpdate:modelValue"])])])]))),128))],64))),128))]),_:1}),l("div",fe,[e(O,{onClick:T},{default:t(()=>[k(" Submit ")]),_:1}),e(O,{color:"secondary",variant:"tonal",onClick:S},{default:t(()=>[k(" Cancel ")]),_:1})])]),_:1},512)]),_:1})]),_:1})]),_:1},8,["width","model-value"])}}},pe="/build/assets/girl-using-mobile-CKXBkoEQ.png",ve={class:"text-body-1"},Ve={class:"d-flex justify-space-between align-center"},he={class:"text-h5"},be={class:"d-flex align-center"},ge=["onClick"],xe=["src"],ye=l("div",{class:"text-end"},[k(" Add new role,"),l("br"),k(" if it doesn't exist. ")],-1),Fe={__name:"RoleCards",setup(I){const D=f([]),g=z(),o=f(!1),c=f(),d=f(!1);H(async()=>{await p()});const p=async()=>{await g.getAllRoles(),D.value=g.roles},h=(b,r)=>{o.value=!0,c.value=b,c.value.id=r};return(b,r)=>{const C=W("IconBtn"),x=_e;return m(),V(R,null,[e(M,null,{default:t(()=>[(m(!0),V(R,null,A(_(D),n=>(m(),L(E,{key:n.role,cols:"12",sm:"6",lg:"4"},{default:t(()=>[e(N,null,{default:t(()=>[e($,{class:"d-flex align-center pb-4"},{default:t(()=>[l("div",ve," Total "+y(n.details.user_count)+" users ",1),e(ee)]),_:2},1024),e($,null,{default:t(()=>[l("div",Ve,[l("div",null,[l("h5",he,y(n.role.toUpperCase()),1),l("div",be,[l("a",{href:"javascript:void(0)",onClick:T=>h(n.details,n.id)}," Edit Role ",8,ge)])]),e(C,null,{default:t(()=>[e(Y,{icon:"tabler-copy",class:"text-high-emphasis"})]),_:1})])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),e(E,{cols:"12",sm:"6",lg:"4"},{default:t(()=>[e(N,{class:"h-100",ripple:!1},{default:t(()=>[e(M,{"no-gutters":"",class:"h-100"},{default:t(()=>[e(E,{cols:"5",class:"d-flex flex-column justify-end align-center mt-5"},{default:t(()=>[l("img",{width:"85",src:_(pe)},null,8,xe)]),_:1}),e(E,{cols:"7"},{default:t(()=>[e($,{class:"d-flex flex-column align-end justify-end gap-4"},{default:t(()=>[e(O,{size:"small",onClick:r[0]||(r[0]=n=>d.value=!0)},{default:t(()=>[k(" Add New Role ")]),_:1}),ye]),_:1})]),_:1})]),_:1})]),_:1}),e(x,{"is-dialog-visible":_(d),"onUpdate:isDialogVisible":r[1]||(r[1]=n=>F(d)?d.value=n:null),onRoleSubmitted:p},null,8,["is-dialog-visible"])]),_:1})]),_:1}),e(x,{"is-dialog-visible":_(o),"onUpdate:isDialogVisible":r[2]||(r[2]=n=>F(o)?o.value=n:null),"role-permissions":_(c),"onUpdate:rolePermissions":r[3]||(r[3]=n=>F(c)?c.value=n:null),onRoleSubmitted:p},null,8,["is-dialog-visible","role-permissions"])],64)}}};export{Fe as _};
